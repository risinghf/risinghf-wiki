---
title: 使用说明书
date: 2021-09-14 15:44:01
permalink: /01/02/02/04/
---
## 1. 快速上手

本章将对RHF2S208网关做一个简单介绍，并展现如何建立网关并连接到一个LoRaWAN云服务器。

### 1.1. 认识你的网关

RisingHF RHF2S208 LoRaWAN网关内部集成了高性能高可靠性内核ARM cortexA53，并且根据不同的版本配备了1或者2 x SX1301 LoRa核心处理芯片，1个LTE模组，1个GPS模组，1个WiFi模组，温度传感器，RTC，以及稳定可靠的电源管理单元。RHF2S208根据不同的功能组件配置分成RHF2S208Exx和RHF2S208Bxx系列。其中RHF2S208Exx是普通无备电系列，RHF2S208Bxx是内置3200mAh电池系列。RHF2S208Bxx系列网关支持5hr待机。除了可以登录网关内置的linux系统使用指令对网关进行操作之外，用户也可以使用内置的web控制界面更加直观和方便地操作设备。

网关总共有4个天线端口，1个外部电源接入端口，1个RJ45端口，1个USB调试端口。

>ANT1：LoRa天线端口。
>
>ANT2：暂时预留，未安装射频接头。
>
>ANT3：GPS天线端口。
>
>ANT4：WiFi天线端口。
>
>ANT5：LTE天线端口。
>
>Power：外部电源输入接口，电源输入范围DC12V 到 28V。
>
>RJ45：RJ45网络端口，支持PoE电源接入和10/100m以太网接入。
>
>USB：USB调试接口。

![image-20210910162604120](https://wiki.risinghf.com/upload/img/c5ca2fc1f93094fa7a184dcb76217d84.png)

### 1.2. 建立网关连接

按照下图所示连接RHF2S208网关。

![image-20210910162705492](https://wiki.risinghf.com/upload/img/8e292345323f82e8d86faa5252a139ca.png)

#### 1.2.1. 电源

RHF2S208可以使用标配的AC/DC工业电源进行供电，也可以通过PoE供电。RHF2S208出厂均配备一个高可靠性工业级IP67防水AC/DC电源。另外，针对RHF2S208Bxx系列网关，同时还内置了一个3.2Ah的磷酸铁锂可充电电池作为备用电源。所有电源均可接入设备，设备自身能够智能地按照AC/DC工业电源>PoE>电池的优先级顺序选择工作电源。

#### 1.2.2. 回传网络

RHF2S208支持多种回传网络方式。如果需要配置网关通过LTE网络连接到云服务器，请打开网关上盖，并插入SIM卡后重新上电启动系统即可。使用网线将网关的WAN口连接到上一级路由器的LAN口则可以实现10/100m以太网络连接到云服务器。你可以登录内置web界面来配置回传网络的优先级。

#### 1.2.3. 调试和配置

RHF2S208提供了多种调试接口：

1.  USB调试接口（虚拟串口）

2.  在局域网用DHCP的方式登录

3.  通过WiFi登录设备

请使用**ExtraPutty**工具登录和配置设备。

### 1.3. 登录网关

你可以通过虚拟串口、局域网DHCP方式或作者WiFi等做种方式登录设备。

默认的用户名和密码如下：

User: rxhf

Password: risinghf

#### 1.3.1. 通过虚拟串口的方式登录设备

在连接你的网关和电脑之前，请先安装FTDT USB转UART的驱动。使用一根type A母头转type A母头的USB线连接网关到电脑的USB端口，之后在你的电脑上会发现到一个COM端口。在ExtraPutty上选择“Serial”并填入正确的COM端口号和波特率115200，就可以成功连接到该网关设备上。

![image-20210910162938010](https://wiki.risinghf.com/upload/img/9f07832acf3a9318caa97060a4fd69d5.png)

然后输入账户“rxhf”和密码“risinghf”即可登录设备。

![image-20210910163002332](https://wiki.risinghf.com/upload/img/9c6bdc7e7aa27861b2e441fc3555b1c9.png)

#### 1.3.2. 通过局域网DHCP方式登录设备

使用DHCP的方式将设备连接到局域网当中，登录路由器查询得到RHF2S208在局域网的ip地址。得到设备ip地址之后，即可使用SSH工具登录设备。

下面我们举例说明分别在Windows系统和Linux系统下如何登录设备。

例如网关设备ip地址为192.168.0.182，SSH端口号为22。

Windows：

![image-20210910164456952](https://wiki.risinghf.com/upload/img/0f68889ea38831c99268da6a50140eb9.png)

Linux：

```shell
ssh rxhf@192.168.0.182
```

#### 1.3.3. 通过WiFi登录设备

在电脑上扫描WiFi信号，找到SSID为RHF2S208_XXXXXX的设备并连接。电脑连接上设备后，同样使用Putty工具连接默认ip 192.168.8.1和端口号22即可登录设备。

WiFi默认的SSID和密码：

SSID：RHF2S208_XXXXXX

密码：RisingHF_XXXXXX

::: warning

注意：“XXXXXX”是以设备的MAC地址后3bytes结尾，若有字母则使用大写字母。

:::

![image-20210910164607928](https://wiki.risinghf.com/upload/img/b092e075367d7700598ffde7238a4fd9.png)

![image-20210910164644555](https://wiki.risinghf.com/upload/img/fbee7ae126865e43e506a0205f2c455c.png)

### 1.4. 连接到LoRaWAN服务器

RHF2S208在web界面集成了常用的连接LoRa服务器的程序，用户可以通过web UI来启动相应的LoRa服务。

1.  通过以下方式打开内置web UI配置界面

    1.  如果电脑和网关设备在同一个局域网下，可以使用 DHCP ip (以192.168.xxx.xxx为例) 打开浏览器来登录内置web配置界面
        
    2.  如果电脑通过WiFi连接到网关设备，可以使用默认ip 192.168.8.1打开浏览器来登录内置web配置界面
    
2. 登录网关web界面

   User name: admin

   Password: admin

#### 1.4.1. 连接到支持标准packet forwarder模式的服务器

RHF2S208网关支持标准Packet Forwarder转发服务。你可以通过该Packet forwarder接口连接到任何一个支持该标准接口的LoRaWAN服务器。请按照以下步骤操作：

1. 选择“LoRaWAN 相关-> Packet forwarder”菜单。

   ![image-20210910164819762](https://wiki.risinghf.com/upload/img/c460c1b55fb6af372e7fc798a31263b6.png)

2.  输入网关ID（注意不同的服务器会使用不同的网关ID命名规则）。

3.  输入服务器地址。

4.  输入上行和下行服务器端口号。

5.  选择频率配置文件。

6.  点击“启动”按钮。

7.  在服务器上确认网关是否上线。

#### 1.4.2. 连接到IoTSquare服务器

IoTSquare（<https://iotsquare.xyz>） 物联网平台是由瑞兴恒方开发的专用LoRa设备管理平台，具有创建用户，注册节点，网关，以及多播组管理等功能，目前IoTSquare物联网平台仅支持lorawan1.0.2版本的LoRa设备接入，IoTSquare现支持cn470、cn470prequel、eu868、as923、us915、au915等频段。用户想使用该服务器，可以发送邮件（support@risinghf.com）申请测试账号。

在使用前，请先注意浏[IoTSquare物联网平台使用手册](https://wiki.risinghf.com/zh/03/02/01/) ，假设用户已经有该服务器账号，请按照以下步骤操作：

1. 获取网关的Gateway ID

   登陆网关的web界面，进入“服务器相关->IoTSquare Bridge”菜单，页面的“网关ID”文本框就是该网关的Gateway ID。若bridge未启动，需要用户手动点击“启动”按钮启动。
   ![image-20210910164943616](https://wiki.risinghf.com/upload/img/bff0f14ae726deea8e9d4711a431c6df.png)

2. [注册网关](https://wiki.risinghf.com/en/03/01/01/#_6-1-add-gateway)

   进入IoTSquare服务器，进入“网关管理->添加网关”菜单，把刚才获取的Gateway ID填写到网关ID并点击“确认添加”进行注册，服务器添加网关的相关信息可以查阅服务器文档，本文档不逐一展开描述。

   ![image-20210910165008002](https://wiki.risinghf.com/upload/img/32416d62e82201b2f208bf95167c71bf.png)

3. 确认网关是否在线

   注册网关成功后，可以在“网关管理->网关列表”菜单下看到该网关显示在线。

   ![image-20210910165040720](https://wiki.risinghf.com/upload/img/fd8ff60a415e15c50fa2f72262865bfb.png)

4. 启动LoRa服务

   进入“LoRaWAN 相关-> IoTSquare”菜单点击启动按钮启动LoRa服务。

   ![image-20210910165100955](https://wiki.risinghf.com/upload/img/6519ca62c4156e849a340462b67a0195.png)

#### 1.4.3. 连接到loriot服务器

loriot（<https://www.loriot.io>）是瑞士一家提供LoRaWAN服务器的网络服务器运营商，提供免费账户供用户测试使用，用户可以自行前往注册。

在使用前，请先注意浏览loriot的在线文档<https://cn1.loriot.io/documentation>（根据所选区域不同,子域名前缀会有所不同，本文档使用cn1.loriot.io服务器地址作例子讲解）。

1. 获取MAC地址

   设备侧面会粘贴一张带有MAC地址的标签。或者通过连接到设备的WiFi并登录设备的内置web界面查询MAC地址信息。

   ![image-20210910165207609](https://wiki.risinghf.com/upload/img/2b246516d8d139d500f41543e91de854.png)

2. 登陆 http://cn1.loriot.io 注册账户，如果您已经注册账户请直接登录账户。

3. 点击Dashboard -> Networks->Name（网络名称） -> Add Gateway，选择网关型号RHF2S008/ RHF2S208。

   ![image-20210910165252550](https://wiki.risinghf.com/upload/img/cda074f5d0af76a3c23db621ba2544ec.png)

4.  注册网关时，请选择正确的射频前端：

    1. 868/915 MHz (SX1257)

    2. 434/470/780 MHz (SX1255)
    
       ![image-20210910165321555](https://wiki.risinghf.com/upload/img/f07254ecc2aaef1d6ef5579ed549dc0b.png)

5. 填入MAC地址和网关的安装位置信息。

   ![image-20210910165349545](https://wiki.risinghf.com/upload/img/0bf97619af2a3702e3d28ba52ec4cf18.png)

   ![image-20210910165405846](https://wiki.risinghf.com/upload/img/6c30b47c61e276dc9cd57de3b2597d1e.png)

6. 点击“Register RisingHF RHF2S208 gateway”完成网关的注册。

7. 点击“Gateways”列表进入网关配置界面。

   ![image-20210910165422839](https://wiki.risinghf.com/upload/img/a770c65b3ba5704a31a467464b00518d.png)

8. 根据网关型号选择正确的频段和频率计划。如果需要更多的协助请联系<support@risinghf.com>

9. 完成网关注册和配置。

10. 在设备的web界面启动loriot LoRa服务。

    ![image-20210910165448817](https://wiki.risinghf.com/upload/img/0c16e7b35f832ded982e85bcc1936c92.png)

11. 刷新网关界面，确认该网关是否在线。

    ![image-20210910165514501](https://wiki.risinghf.com/upload/img/4631906b95d7c17c9c30391ab56591f8.png)

## 2. 文件系统

RHF2S208内部固件使用systemd文件系统架构。用户可以使用systemctl和journalctl 等指令管理所有服务和日志。

### 2.1. 登录系统

User name: rxhf

Password: risinghf

### 2.2. 文件系统

/usr/local和/opt文件夹下面存放了大量重要的文件。

#### 2.2.1. /opt

/opt包含了众多服务器启动文件，并且会随着设备支持的服务器越来越多进行更新。

![image-20210910165655785](C:/Users/lingtaoluo/AppData/Roaming/Typora/typora-user-images/image-20210910165655785.png)

#### 2.2.2. /usr/local

/usr/local 包含了大量的内部服务启动文件。

![image-20210910165727194](https://wiki.risinghf.com/upload/img/9ee211e1bb73a9bff5f10adad36a7682.png)

## 3. 内置web配置界面

使用内置web配置界面可以方便快捷地配置和管理网关。

user name: admin

password: admin

可以通过以下两种方式打开内置web配置界面：

1. 如果电脑通过WiFi连接到网关设备，可以使用默认ip 192.168.8.1打开浏览器来登录内置web配置界面。

   ![image-20210910165812050](https://wiki.risinghf.com/upload/img/1556973de383973b2871a1dee0bfb5d8.png)

2. 如果电脑和网关设备在同一个局域网下，可以使用 DHCP ip (以192.168.0.218为例) 打开浏览器来登录内置web配置界面。

   ![image-20210910165831372](https://wiki.risinghf.com/upload/img/29c7f7a7d9bf3bd5b3024b4bd713864d.png)

![](https://wiki.risinghf.com/upload/img/77f6eca37c90dc29549ca59db0de60ed.png)

![image-20210910165929255](https://wiki.risinghf.com/upload/img/987d5d73a76988480a663d457c71bee4.png)

### 3.1. 状态指示栏

状态指示栏将会显示设备关键组件的状态。用户可以通过该栏快速确认设备的硬件组件状态。状态栏上每个组件默认都包含三种状态：

**蓝色** 指示该组件运行正常；

**红色** 指示该组件异常或者报警；

**灰色** 指示当前设备型号不支持该组件。

指示栏包含总共9个组件的状态指示，包括外部电源状态，内部电池供电状态，LTE连接状态，以太网连接状态，GPS状态，WiFi状态，设备内部温度，LoRa组件0，LoRa组件1。

![image-20210910170011023](https://wiki.risinghf.com/upload/img/36b0b037f49b162c5fb6946e7b41ddc4.png)

下面以外部电源状态为例说明不同的状态显示：

![image-20210910170025800](https://wiki.risinghf.com/upload/img/5af7ae50b6a9ed8b63115e5848f11890.png)
表明外部电源接入（外部工业电源接入或者PoE接入)。

![image-20210910170041424](https://wiki.risinghf.com/upload/img/4433bacf3a4372a46791153cf1b937a5.png)
表明外部电源断开，当前由电池供电。

::: warning

注意：

对于RHF2S208Exx系列网关设备，电池供电状态栏将显示灰色。

对于RHF2S208xxx系列网关设备，网关只支持8信道，内部只支持LoRa组件0，而LoRa组件1将显示灰色。

:::

### 3.2. 导航栏

导航栏包含RHF2S208网关设备的主要配置和管理项目：

设备信息：网关的基本信息。

LoRaWAN相关：扫描环境底噪和配置连接LoRaWAN服务器。

服务器相关：连接IoTSquare服务器管理。

网络配置：网络功能配置。

日志下载：下载网关日志。

固件升级：网关应用程序升级。

![image-20210910170404636](https://wiki.risinghf.com/upload/img/fd827c02a151ba7700f97de58e5d981e.png)

#### 3.2.1. 设备信息

设备信息栏将主要显示网关设备的基本信息，包括硬件信息，软件版本等。

![image-20210910170443767](https://wiki.risinghf.com/upload/img/7474955766cb5793ceb5c82b83e0de1d.png)

#### 3.2.2. LoRaWAN相关

使用LoRaWAN配置界面，可以实现以下功能：

1. 环境底噪扫描

   RHF2S208网关内部集成底噪扫描分析引擎，这个功能将帮助客户现场部署时提前发现干扰信号和噪声。

   底噪扫描功能操作非常简便，只需要填入起始频点和终止频点，然后点击“开始扫描”即可。如果你只输入起始频点，则默认的扫描带宽2MHz，默认的步进为100kHz。扫描的带宽越宽，需要花费的时间就越长。一般建议只扫描2MHz或者5MHz以覆盖目标工作频段即可。

   ![image-20210910170530352](https://wiki.risinghf.com/upload/img/00f81b60bd3c1713b1c3d95699fe7ced.png)

   当底噪扫描完成时，配置界面将会以两种形式显示扫描结果：底噪热力分布图表示瞬态噪声分布，平均噪声分布图则表示该频点在扫描时获得的平均噪声水平。

   ![image-20210910170550699](https://wiki.risinghf.com/upload/img/244795e8d92ae76c5b9b48ea4b67199d.png)

   ![image-20210910170559668](https://wiki.risinghf.com/upload/img/7ecb8b260175374b18d3784690fb887d.png)

2. Packet forwarder

   网关ID：填入网关 ID（注意不同的服务器会使用不同的网关ID命名规则）。

   服务器地址： 填入目标服务器地址。

   服务器端口：分别填入连接目标服务器的上行端口号和下行端口号。

   全局配置：选择网关支持的频率配置文件。不同的型号支持不同的频率计划。请在使用该设备前查找规格书《【DS11828】RHF2S208规格书》确认该信息。

   点击“启动”按钮启动程序。如果设备启动了其他LoRa相关的服务，系统会关闭其他LoRa服务，启动该程序。

   ![image-20210910170654116](https://wiki.risinghf.com/upload/img/e608d29a504ce5770ed5c2fc850cc138.png)

3. IoTSquare

   IoTSquare（[https://IoTSquare.xyz](https://iotsquare.xyz/)）是用于连接IoTSquare服务器的程序，用户需要把“服务器相关->IoTSquare
   Bridge”菜单的“网关ID”注册到IoTSquare服务器，并点击“启动”按钮启动程序。如果设备启动了其他LoRa相关的服务，系统会关闭其他LoRa服务，启动该程序。

   ![image-20210910170717718](https://wiki.risinghf.com/upload/img/00295ad97400e4f34c0f8234c5f93672.png)

   ![image-20210910170726474](https://wiki.risinghf.com/upload/img/d37a47a2dd2c3d8499632dc47278002c.png)

4. Orbiwise

   Orbiwise是印度一家提供LoRaWAN服务器的网络服务器运营商，该服务器不用注册网关，只需要联系服务器厂家权限验证就可以连接到服务器。用户只需要点击“启动”按钮程序。如果设备启动了其他LoRa相关的服务，系统会关闭其他LoRa服务，启动该程序。

   ![image-20210910170741291](https://wiki.risinghf.com/upload/img/49a1b9fca4d41b9b09540102ec797c01.png)

5. loriot

   loriot（<https://loriot.io>）是瑞士一家提供LoRaWAN服务器的网络服务器运营商，用户只需要把MAC地址注册到服务器，根据注册网关的服务器地址不一样，需要填写相应的服务器地址，网关默认是cn1.loriot.io服务器地址，并点击“启动”按钮启动程序。如果设备启动了其他LoRa相关的服务，系统会关闭其他LoRa服务，启动该程序。

   ![image-20210910170809725](https://wiki.risinghf.com/upload/img/0d5a7e3e3e5018c074d5e58ce69974f8.png)

6. Aliot LinkWAN

   LinkWAN（<https://linkwan.aliyun.com>）是阿里云平台旗下的一个LoRaWAN服务器，用户需要向阿里申请网关三元组注册到LinkWAN服务器上，并且把网关三元组的信息填写到网关。

   product_key：网关三元组的product_key。

   device_name：网关三元组的device_name。

   device_secret：网关三元组的device_secret。

   网关 ID：一般与网关三元组的device_name保存一致。

   全局配置：选择网关支持的频率配置文件。

   点击“启动”按钮启动程序。如果设备启动了其他LoRa相关的服务，系统会关闭其他LoRa服务，启动该程序。

   ![image-20210910170834931](https://wiki.risinghf.com/upload/img/c9558d47a1f2a45755a0b45461168230.png)

#### 3.2.3. 服务器相关

1. IoTSquare Bridge

   连接IoTSquare服务器进行网关管理和数据转发，默认是开启状态。开启后IoTSquare服务器定期查询网关的状态信息和方便远程调试网关等等。如果网关启动了IoTSquare SDK连接了IoTSquare服务器进行LoRaWAN数据交互，则IoTSquare Bridge是必须启动的；如果网关是启动的第三方服务器进行LoRaWAN的数据交互服务，也可以启动IoTSquare Bridge进行设备管理，也可以选择关闭并由客户自行管理设备。

   ![image-20210910171303370](https://wiki.risinghf.com/upload/img/b42bfd799a15dc03a1a7bf98f5879bf7.png)

#### 3.2.4. 网络配置

1. WiFi配置

   此处主要是针对网关设备的WiFi进行网络配置。你可以修改默认的ip地址，SSID用户名和密码。

   ![image-20210910171347357](https://wiki.risinghf.com/upload/img/6a576a156aa6e2d972df24c970f3b21f.png)

2. APN配置

   该页面用于查询、增加和删除网关LTE拔号的APN，用户使用的sim卡如果无法正常拔号时，可以使用该页面查询或者增加sim卡对应的APN。

   ![image-20210910171403852](https://wiki.risinghf.com/upload/img/c61680e962d81751aacaccf9a8e26c23.png)

3. RSSH操作

   该页面是管理网关远程调试的端口号，用户网关需要远程协助时，可以开启RSSH功能，把端口号发给本公司的技术支持就可以远程登陆网关。调试完成后记得关闭RSSH，毕竟开启远程调试功能会增加安全风险。

   ![image-20210910171427836](https://wiki.risinghf.com/upload/img/8eb0a931e4d486e5a4bd578d399d3dc7.png)

4. Ping

   该页面用于检测设备是否能正常访问互联网，测试网关是否能直接连接gw.risinghf.com服务器，用户可以自定义自己的服务器地址。

   ![image-20210910171505166](https://wiki.risinghf.com/upload/img/51b270a8e28190cace9d59a106a18846.png)

5. Traceroute

   该页面用于检测设备是否能正常访问互联网，测试网关连接gw.risinghf.com所经过的路由，用户可以自定义自己的服务器地址。

   ![image-20210910171529546](https://wiki.risinghf.com/upload/img/1a43335fb0b2940dc50a8e37277e9d42.png)

6. Host

   该页面用于检测设备是否能正常访问互联网，测试网关使用的DNS服务器，用户可以自定义自己的服务器地址。

   ![image-20210910171556049](https://wiki.risinghf.com/upload/img/a7c1d70ae70874fcf3d3e3b2afb63ed9.png)

#### 3.2.5. 日志下载

在日志下载页面，你可以查看和下载与网关运行相关的多种日志。

1. 系统日志

   系统日志记录了网关内核运行的日志，包含内核运行的状态信息，用户可以用于分析网关系统的运行状况。

   ![image-20210910171635140](https://wiki.risinghf.com/upload/img/92dbe2f14e1c059161de724a5539381e.png)

2. LTE拨号日志

   LTE拨号日志可以用于分析LTE 4G的拨号历史记录，掉线分析。系统每隔30分钟记录一次当前4G的信号质量。

   ![image-20210910171705109](https://wiki.risinghf.com/upload/img/f336780a7c1a34328316ffcb2b1c7edb.png)

3. 以太网日志

   以太网日志记录了网关与以太网的连接状态和断开历史记录。

   ![image-20210910171721506](https://wiki.risinghf.com/upload/img/bae49425941bbbea39a64a9138cf7962.png)

4. 开机时间日志

   开机时间日志主要用于记录网关系统重新上电开机的事件。我们可用开机时间日志来判断系统是否在运行过程中有断电或者重启等行为。

   ![image-20210910171752482](https://wiki.risinghf.com/upload/img/1af0e9eb72ac459bca5ea794448d8a51.png)

5. LoRa/LoRaWAN相关日志

   LoRa/LoRaWAN相关日志将只记录LoRaWAN运行过程中的异常事件，如果整个运行过程中均正常，则日志为空。

   ![image-20210910171807479](https://wiki.risinghf.com/upload/img/097923408389c854f9f920f3c0136b73.png)

6. 温度日志

   网关内温度日志主要记录网关壳体内的环境温度，温度将按照每15分钟一次的频次进行记录。

   ![image-20210910171831873](https://wiki.risinghf.com/upload/img/e3a09c023647d7b2b9957361ff1f0e5b.png)

7. 电源管理日志

   电源管理日志记录系统电源开关事件和电池放电等日志。借助该日志，用户可以分析设备由于掉电导致的异常复位或者重启等问题。

   ![image-20210910171845434](https://wiki.risinghf.com/upload/img/66dd30b880d86559cad2180c90aa6a3a.png)

#### 3.2.6. 固件升级

使用应用程序包升级功能可以实现网关应用程序升级。请联系瑞兴恒方网络（深圳）邮箱公司技术人员进行升级。

![image-20210910171924973](https://wiki.risinghf.com/upload/img/84f970a45e5d19b781698d4253f31b63.png)

### 3.3. 快捷按钮

web配置界面右上角集成了一组快捷按钮，包含一键诊断、系统重启、回传网络优先级选择和退出登录等功能快捷键。

![image-20210910171949543](https://wiki.risinghf.com/upload/img/808a8e930af2842742cbc677e6689742.png)

#### 3.3.1. 一键诊断

使用一键诊断可以快速核查设备硬件故障。现场施工人员可以使用该功能快捷键进行快速诊断设备，以确保设备正确安装。请按照以下步骤进行设备诊断操作：

1.  点击一键诊断按钮，界面弹出“是否诊断设备”。

2.  点击确认开始诊断，界面显示诊断进度条。

3.  诊断完成，界面显示诊断结果。

诊断成功的项目显示**绿色**，诊断失败的项目显示**红色**。

![image-20210910172023978](https://wiki.risinghf.com/upload/img/c455d817e7fdb3c2ce714f1626d93c4a.png)

![image-20210910172040409](https://wiki.risinghf.com/upload/img/c3cf936f53cf3715bedc99032b420a37.png)

![image-20210910172049754](https://wiki.risinghf.com/upload/img/1aa611c757ba1cfe80a6102f010159cd.png)

::: warning

注意：诊断完成，系统将会自动重启。

:::

#### 3.3.2. 系统重启

当点击“系统重启”按钮时，界面会跳出“是否重启设备”提示。点击确认，系统将开始重启，界面将跳出系统重启进度条。系统重启后，原先的WiFi连接将丢失，请将你的电脑重新连接设备的WiFi和登录设备。

![image-20210910172137609](https://wiki.risinghf.com/upload/img/afdbc26101e7c244890c38f99ab0388f.png)

![image-20210910172157172](https://wiki.risinghf.com/upload/img/ed836a4d7628fdadd4ede34082bebd76.png)

#### 3.3.3. 回传网络优先级选择

通过配置回传网络优先级，可以优先选择4G LTE方式或者10/100m以太网优先网络方式作为回传网络。默认网关将以太网作为优先网络，当用户同时使用以太网和4G时，以太网网线被拔时，自动切换成4G。当用户将网关回传网络优先级修改成4G优先时，但4G掉线，网关会自动切换成有线网络。

![image-20210910172323919](https://wiki.risinghf.com/upload/img/9797dfdb815338a315b7454bd510faa1.png)

![image-20210910172345592](https://wiki.risinghf.com/upload/img/83889420cad8d002bc7342db69da0e28.png)

![image-20210910172359961](https://wiki.risinghf.com/upload/img/80a335a8c4b0d3e04bec6651ffc5541e.png)

#### 3.3.4. 退出登录

点击“退出登录”按钮，页面将回到登录界面。

## 4. LoRaWAN服务器

RHF2S208支持连接多个运营商的LoRaWAN服务器，用户可以根据自己的需求开启相关服务。除了特定运营商的自定义接口协议，RHF2S208还集成了标准packet forwarder协议。

除了以上介绍通过web界面启动LoRa服务之外，设备还支持通过命令行的方法启动LoRa服务，可以让二次开发更加便利。下面使用标准的Packet Forwarder、IoTSquare和loriot的LoRa服务作例子：

::: warning

注意：在同一时间，RHF2S208网关只允许连接到一个LoRaWAN服务器。如果需要进行服务器切换，请务必先将先前运行的服务关闭。

:::

### 4.1. Packet Forwarder

Packet Forwarder为RisingHF所提供的LoRaWAN网关与服务器连接所需的程序，它兼容了标准Packet Forwarder所有的功能，提供最基本的LoRa数据包转发功能，本身基本不处理LoRaWAN协议相关的内容。

根据服务器的支持情况,，lora_pkt_fwd支持json配置文件，工作目录下的固定文件名为global_conf.json或者local_conf.json为Packet0
Forwarder的配置文件，global_conf.json和local_conf.json所支持的格式完全一样，local_conf.json有更高的优先级, Packet Forwarder依次读取global_conf.json和local_conf.json，并用local_conf.json中的配置覆盖global_conf.json。

你可以在文件夹/opt/pktfwd/cfg找到所有的服务器配置文件和频率配置文件，包括434MHz, 470MHz, 780MHz, 868MHz, 915MHz等。

**/opt/pktfwd**

==============================================================================

**rxhf@rhf2s208:/opt/pktfwd $ ls -l**

**total 708**

**drwxr-xr-x 7 root root 4096 Jul 23 04:18 cfg**

**-rw-r--r-- 1 root root 6522 Jul 24 02:16 global_conf.json**

**-rw-r--r-- 1 root root 185 Jul 23 06:19 local_conf.json**

**-rwxr-xr-x 1 root root 698940 Jul 23 04:18 lora_pkt_fwd**

**-rw-r--r-- 1 root root 226 Jul 23 04:18 pktfwd.conf**

**-rwxr-xr-x 1 root root 1200 Jul 23 04:18 update_gwid.sh**



**/opt/pktfwd/cfg**

==============================================================================

**rxhf@rhf2s208:/opt/pktfwd/cfg $ ls -l**

**total 20**

**drwxr-xr-x 2 root root 4096 Jul 23 04:18 434**

**drwxr-xr-x 2 root root 4096 Jul 23 04:18 470**

**drwxr-xr-x 2 root root 4096 Jul 23 04:18 780**

**drwxr-xr-x 2 root root 4096 Jul 23 04:18 868**

**drwxr-xr-x 2 root root 4096 Jul 23 04:18 915**



json配置文件的示例如下: (868MHz)

```json
{
  "SX1301_conf": {
  "lorawan_public": true,
  "clksrc": 1,
  "antenna_gain": 0,
  "radio_0": {
  "enable": true,
  "type": "SX1257",
  "freq": 867500000,
  "rssi_offset": -166.0,
  "tx_enable": true,
  "tx_freq_min": 863000000,
  "tx_freq_max": 870000000
  },
  "radio_1": {
  "enable": true,
  "type": "SX1257",
  "freq": 868500000,
  "rssi_offset": -166.0,
  "tx_enable": false
  },
  // SX1301 MultiSF, standard LoRa and FSK channels
  "chan_multiSF_0": { "enable": true, "radio": 1, "if": -400000 },
  "chan_multiSF_1": { "enable": true, "radio": 1, "if": -200000 },
  "chan_multiSF_2": { "enable": true, "radio": 1, "if": 0 },
  "chan_multiSF_3": { "enable": true, "radio": 0, "if": -400000 },
  "chan_multiSF_4": { "enable": true, "radio": 0, "if": -200000 },
  "chan_multiSF_5": { "enable": true, "radio": 0, "if": 0 },
  "chan_multiSF_6": { "enable": true, "radio": 0, "if": 200000 },
  "chan_multiSF_7": { "enable": true, "radio": 0, "if": 400000 },
  "chan_Lora_std": { "enable": true, "radio": 1, "if": -200000, "bandwidth": 250000, "spread_factor": 7 },
  "chan_FSK": { "enable": true, "radio": 1, "if": 300000, "bandwidth": 125000, "datarate": 50000 },
  // RHF0M301-868
  "tx_lut_0": { "rf_power": -1, "dig_gain": 0, "mix_gain": 8, "pa_gain": 1 },
  "tx_lut_1": { "rf_power": 2, "dig_gain": 0, "mix_gain": 10, "pa_gain": 1 },
  "tx_lut_2": { "rf_power": 5, "dig_gain": 0, "mix_gain": 12, "pa_gain": 1 },
  "tx_lut_3": { "rf_power": 6, "dig_gain": 0, "mix_gain": 8, "pa_gain": 2 },
  "tx_lut_4": { "rf_power": 8, "dig_gain": 0, "mix_gain": 9, "pa_gain": 2 },
  "tx_lut_5": { "rf_power": 9, "dig_gain": 0, "mix_gain": 10, "pa_gain": 2 },
  "tx_lut_6": { "rf_power": 11, "dig_gain": 0, "mix_gain": 11, "pa_gain": 2 },
  "tx_lut_7": { "rf_power": 12, "dig_gain": 0, "mix_gain": 12, "pa_gain": 2 },
  "tx_lut_8": { "rf_power": 14, "dig_gain": 0, "mix_gain": 13, "pa_gain": 2 },
  "tx_lut_9": { "rf_power": 15, "dig_gain": 0, "mix_gain": 8, "pa_gain": 3 },
  "tx_lut_10": { "rf_power": 17, "dig_gain": 0, "mix_gain": 9, "pa_gain": 3 },
  "tx_lut_11": { "rf_power": 18, "dig_gain": 0, "mix_gain": 10, "pa_gain": 3 },
  "tx_lut_12": { "rf_power": 20, "dig_gain": 0, "mix_gain": 11, "pa_gain": 3 },
  "tx_lut_13": { "rf_power": 22, "dig_gain": 0, "mix_gain": 12, "pa_gain": 3 },
  "tx_lut_14": { "rf_power": 23, "dig_gain": 0, "mix_gain": 13, "pa_gain": 3 },
  "tx_lut_15": { "rf_power": 25, "dig_gain": 0, "mix_gain": 15, "pa_gain": 3 }
  },
  "gateway_conf": {
  "gateway_ID": "AA555A0000000000",
  /* change with default server address/ports, or overwrite in local_conf.json */
  "server_address": "localhost",
  "serv_port_up": 1680,
  "serv_port_down": 1680,
  /* adjust the following parameters for your network */
  "keepalive_interval": 10,
  "stat_interval": 3600,
  "push_timeout_ms": 100,
  "autoquit_threshold": 5,
  /* forward only valid packets */
  "forward_crc_valid": true,
  "forward_crc_error": false,
  "forward_crc_disabled": false,
  /* GPS reference coordinates */
  "ref_latitude": 0.0,
  "ref_longitude": 0.0,
  "ref_altitude": 0,
  /* Beaconing parameters */
  //"gps_tty_path": "/dev/ttyAMA0",
  "beacon_period": 128,
  "beacon_freq_hz": 869525000
  }
}
```

Packet Forwarder的配置文件本身为一个json对象( 由'{' '}' 括起)，根对象包含了两个子对象，分别为SX1301_conf和gateway_conf.SX1301_conf对象是对LoRa射频部分的配置，gateway_conf为对网络通讯层的配置(包含服务器,网关ID等等)。

由于global_conf.json文件已经包含了全部Packet Forwarder的配置，一般情况下local_conf.json仅用于包含需要经常变动项(例如gateway_ID)，如下所示：

```json
{
  "gateway_conf": {
  "gateway_ID": "AA555A0000000000",
  /* change with default server address/ports, or overwrite in local_conf.json */
  "server_address": "localhost",
  "serv_port_up": 1680,
  "serv_port_down": 1680
  }
}
```

结合配置文件可以分析考虑SX1301具有如下特性：

1.  SX1301芯片配合支持2个Radio使用，根据频率不同其可能为SX1255或者SX1257。

2.  SX1301可以支持至多10个信道，其中8个Multi-SF信道，1个普通LoRa信道，1个FSK信道。

3.  单片SX125x射频前端有如下配置限制。

<table>
<colgroup>
<col style="width: 34%" />
<col style="width: 32%" />
<col style="width: 32%" />
</colgroup>
<thead>
<tr class="header">
<th><p>Lower Side Channel</p>
<p>Bandwidth</p></th>
<th><p>Upper Side Channel</p>
<p>Bandwidth</p></th>
<th>SX125x Bandwidth</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>125KHz</td>
<td><strong>125KHz</strong></td>
<td>925KHz</td>
</tr>
<tr class="even">
<td>250KHz</td>
<td><strong>250KHz</strong></td>
<td>1MHz</td>
</tr>
<tr class="odd">
<td>500KHz</td>
<td><strong>500KHz</strong></td>
<td>1.1MHz</td>
</tr>
<tr class="even">
<td>125KHz</td>
<td><strong>250KHz</strong></td>
<td>962.5KHz</td>
</tr>
<tr class="odd">
<td>250KHz</td>
<td><strong>125KHz</strong></td>
<td>962.5KHz</td>
</tr>
<tr class="even">
<td>500KHz</td>
<td><strong>250KHz</strong></td>
<td>1.05MHz</td>
</tr>
<tr class="odd">
<td>250KHz</td>
<td><strong>500KHz</strong></td>
<td>1.05MHz</td>
</tr>
<tr class="even">
<td>500KHz</td>
<td><strong>125KHz</strong></td>
<td>1.0125MHz</td>
</tr>
<tr class="odd">
<td>125KHz</td>
<td><strong>500KHz</strong></td>
<td>1.0125MHz</td>
</tr>
</tbody>
</table>


LoRa硬件框图如下:

![image-20210910175328931](https://wiki.risinghf.com/upload/img/2afbca410b3ad4da0c01b4787992cf8d.png)

#### 4.1.1. 自定义信道

当用户需要自定义json文件选择不同频段时, 请遵循如下规律做修改。

1.  根据所得SX1301_conf.radio_0.type和SX1301_conf.radio_1.type由中心频率而定，频率大于520MHz填入SX1257，小于520MHz填入SX1255。(注意:设备具体合法工作频率范围请查阅相应设备的硬件说明手册)
    
2.  根据网关频段信息查阅RHF-DS01603手册获取相应的设备配置参数，包括RSSI校准值和射频发射功率表。根据所得参数更改SX1301_conf.radio_0.rssi_offset和SX1301_conf.radio_1.rssi_offset的值，以及tx_lut_xxx表。

3.  根据所计划的频率方案计算出中心频率以及各个IF信道的偏移值。并修改SX1301_conf.radio_0.freq和SX1301_conf.radio_1.freq的值确定中心频率，然后修改SX1301_conf.chan_multiSF_xxx，SX1301_conf.chan_Lora_std和SX1301_conf.chan_FSK对象的offset值确定信道频率.
    信道配置需遵循如下约束。

    1.  每个IF信道可以自由软件配置其关联radio0或者radio1。

    2.  每个IF信道offset设定值不可超出SX125x分析带宽限制(前文表格)，否则会导致设定无效。

    3.  每个IF信道均可自由使能或者关闭。

4.  综合上述信息可以判定示例中的json文件选择并配置了如下信道：

    1.  CH0 868.1MHz Multi-SF

    2.  CH1 868.3MHz Multi-SF

    3.  CH2 868.5MHz Multi-SF

    4.  CH3 867.1MHz Multi-SF

    5.  CH4 867.3MHz Multi-SF

    6.  CH5 867.5MHz Multi-SF

    7.  CH6 867.7MHz Multi-SF

    8.  CH7 867.9MHz Multi-SF

    9.  CH8 868.3MHz LoRa Standard SF7/250KHz

    10.  CH9 868.8MHz FSK 50Kbps

#### 4.1.2. 配置服务器地址

编辑local_conf.json文件。更改server_address配置地址，更改serv_port_up配置上行数据端口，更改serv_port_down配置下行数据端口。

// local_conf.json 文件

```json
{
  "gateway_conf": {
    "gateway_ID": "AA555A0000000000",
    "server_address": "localhost",
    "serv_port_up": 1680,
    "serv_port_down": 1680
  }
}
```

已知服务器列表：

<table style="width:100%;">
<colgroup>
<col style="width: 27%" />
<col style="width: 14%" />
<col style="width: 16%" />
<col style="width: 13%" />
<col style="width: 14%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr class="header">
<th>Address</th>
<th><p>Uplink</p>
<p>Port</p></th>
<th><p>Downlink</p>
<p>Port</p></th>
<th><p>Packet Forward</p>
<p>Version</p></th>
<th>Supplier</th>
<th>Band</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>gateway.IoTSquare.xyz</td>
<td>1780</td>
<td>1780</td>
<td>V2</td>
<td>RisingHF</td>
<td>ALL</td>
</tr>
<tr class="even">
<td>Iot.semtech.com</td>
<td>1680</td>
<td>1680</td>
<td>V1/V2</td>
<td>Semtech</td>
<td>EU868</td>
</tr>
<tr class="odd">
<td>us01-iot.semtech.com</td>
<td>1780</td>
<td>1780</td>
<td>V1/V2</td>
<td>Semtech</td>
<td>US915</td>
</tr>
<tr class="even">
<td>cn1.loriot.io</td>
<td>1780</td>
<td>1780</td>
<td>V1/V2</td>
<td>Loriot</td>
<td>All</td>
</tr>
<tr class="odd">
<td>ap1.loriot.io</td>
<td>1780</td>
<td>1780</td>
<td>V1/V2</td>
<td>Loriot</td>
<td>All</td>
</tr>
<tr class="even">
<td>au1.loriot.io</td>
<td>1780</td>
<td>1780</td>
<td>V1/V2</td>
<td>Loriot</td>
<td>All</td>
</tr>
<tr class="odd">
<td>eu1.loriot.io</td>
<td>1780</td>
<td>1780</td>
<td>V1/V2</td>
<td>Loriot</td>
<td>All</td>
</tr>
<tr class="even">
<td>sa1.loriot.io</td>
<td>1780</td>
<td>1780</td>
<td>V1/V2</td>
<td>Loriot</td>
<td>All</td>
</tr>
<tr class="odd">
<td>us1.loriot.io</td>
<td>1780</td>
<td>1780</td>
<td>V1/V2</td>
<td>Loriot</td>
<td>All</td>
</tr>
<tr class="even">
<td>router.eu.thethings.network</td>
<td>1700</td>
<td>1700</td>
<td>V1</td>
<td>TTN</td>
<td><p>EU433</p>
<p>EU868</p></td>
</tr>
<tr class="odd">
<td>router.us.thethings.network</td>
<td>1700</td>
<td>1700</td>
<td>V1</td>
<td>TTN</td>
<td>US915</td>
</tr>
<tr class="even">
<td>router.cn.thethings.network</td>
<td>1700</td>
<td>1700</td>
<td>V1</td>
<td>TTN</td>
<td><p>CN470</p>
<p>CN780</p></td>
</tr>
<tr class="odd">
<td>router.au.thethings.network</td>
<td>1700</td>
<td>1700</td>
<td>V1</td>
<td>TTN</td>
<td>AU915</td>
</tr>
</tbody>
</table>
#### 4.1.3. 选择预配置的频率方案

使用ln命令将global_conf.json指向所需文件用于选择预设频率方案。用户也可以根据前文描述创建自定义json文件。

```sh
sudo ln -sf cfg/xxx/global_conf_xxx.json global_conf.json
```

::: warning

注意:

1.  注意替换global_conf_xxx.json为真实文件名。
2.  其他未于下表列出的文件请根据前文所述方法计算信道频点。

:::

<table>
<colgroup>
<col style="width: 8%" />
<col style="width: 15%" />
<col style="width: 15%" />
<col style="width: 16%" />
<col style="width: 13%" />
<col style="width: 13%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr class="header">
<th>CH</th>
<th>eu868</th>
<th>us915</th>
<th>eu433</th>
<th>cn780</th>
<th>as920</th>
<th>cn470</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>867.1</td>
<td>902.3</td>
<td>433.175</td>
<td>779.5</td>
<td>923.2</td>
<td>470.3</td>
</tr>
<tr class="even">
<td>1</td>
<td>867.3</td>
<td>902.5</td>
<td>433.375</td>
<td>779.7</td>
<td>923.4</td>
<td>470.5</td>
</tr>
<tr class="odd">
<td>2</td>
<td>867.5</td>
<td>902.7</td>
<td>433.575</td>
<td>779.9</td>
<td>923.6</td>
<td>470.7</td>
</tr>
<tr class="even">
<td>3</td>
<td>867.7</td>
<td>902.9</td>
<td>433.775</td>
<td>780.1</td>
<td>923.8</td>
<td>470.9</td>
</tr>
<tr class="odd">
<td>4</td>
<td>867.9</td>
<td>903.1</td>
<td>433.975</td>
<td>780.3</td>
<td>924.0</td>
<td>471.1</td>
</tr>
<tr class="even">
<td>5</td>
<td>868.1</td>
<td>903.3</td>
<td>434.175</td>
<td>780.5</td>
<td>924.2</td>
<td>471.3</td>
</tr>
<tr class="odd">
<td>6</td>
<td>868.3</td>
<td>903.5</td>
<td>434.375</td>
<td>780.7</td>
<td>924.4</td>
<td>471.5</td>
</tr>
<tr class="even">
<td>7</td>
<td>868.5</td>
<td>903.7</td>
<td>434.575</td>
<td>780.9</td>
<td>924.6</td>
<td>471.7</td>
</tr>
<tr class="odd">
<td>8</td>
<td><p>868.3</p>
<p>BW250</p>
<p>SF7</p></td>
<td><p>903.0</p>
<p>BW500</p>
<p>SF8</p></td>
<td>OFF</td>
<td>OFF</td>
<td>OFF</td>
<td>OFF</td>
</tr>
<tr class="even">
<td>9</td>
<td><p>868.8</p>
<p>FSK</p>
<p>50Kbps</p></td>
<td>OFF</td>
<td>OFF</td>
<td>OFF</td>
<td>OFF</td>
<td>OFF</td>
</tr>
</tbody>
</table>
#### 4.1.4. 启动packet forwarder服务

执行如下命令启动pktfwd服务：

```shell
sudo systemctl enable pktfwd
sudo systemctl restart pktfwd
```

#### 4.1.5. 关闭packet Forwarder服务

执行如下命令停止pktfwd服务：

```shell
sudo systemctl disable pktfwd
sudo systemctl stop pktfwd
```

### 4.2. IoTSquare服务器

IoTSquare（<https://iotsquare.xyz>） 物联网平台是由瑞兴恒方开发的专用LoRa设备管理平台，具有创建用户，注册节点，网关，以及多播组管理等功能，目前IoTSquare物联网平台仅支持lorawan1.0.2版本的LoRa设备接入，IoTSquare现支持cn470、cn470prequel、eu868、as923、us915、au915等频段。用户想使用该服务器，可以发送邮件（support@risinghf.com）申请测试账号。

在使用前，请先注意浏览[**IoTSquare物联网平台使用手册**](https://wiki.risinghf.com/zh/03/01/01/)，假设用户已经有该服务器账号，请按照以下步骤操作：

#### 4.2.1. 注册RHF2S208网关

1. 获取网关的Gateway ID

   登陆网关的web界面，进入“服务器相关->IoTSquare Bridge”菜单，页面的“网关ID”文本框就是该网关的Gateway ID。若bridge未启动，需要用户手动点击“启动”按钮启动。

   ![image-20210910180156452](https://wiki.risinghf.com/upload/img/bff0f14ae726deea8e9d4711a431c6df.png)

2.  [注册网关](https://wiki.risinghf.com/zh/03/01/01/#_5-1-添加网关)

进入IoTSquare服务器，进入“网关管理->添加网关”菜单，把刚才获取的Gateway ID填写到网关ID并点击“确认添加”进行注册，服务器添加网关的相关信息可以查阅服务器文档，本文档不逐一展开描述。

![image-20210910180231554](https://wiki.risinghf.com/upload/img/32416d62e82201b2f208bf95167c71bf.png)

3. 确认网关是否在线

   注册网关成功后，可以在“网关管理->网关列表”菜单下看到该网关显示在线。若不在线执行[5.2.2章节](#启动iotsquare服务)命令启动服务。

   ![image-20210910180256979](https://wiki.risinghf.com/upload/img/fd8ff60a415e15c50fa2f72262865bfb.png)

#### 4.2.2. 启动iotsquare服务

执行如下命令启动iotsquare服务：

```shell
sudo systemctl enable rhf-bridge
sudo systemctl restart rhf-bridge
sudo systemctl enable iotsquare-pktfwd
sudo systemctl restart iotsquare-pktfwd
```

#### 4.2.3. 关闭iotsquare服务

执行如下命令停止iotsquare服务：

```shell
sudo systemctl disable iotsquare-pktfwd
sudo systemctl stop iotsquare-pktfwd
```

#### 4.2.4. [添加应用](https://wiki.risinghf.com/zh/03/01/01/#_2-1-添加应用)

进入“应用管理->添加应用”菜单，填写相关的字段信息点击“确认添加”。如果已经添加过应用，用户可以忽略该步骤。

![image-20210910180422384](https://wiki.risinghf.com/upload/img/8efb7705ab2e08419d065fa6c5419ede.png)

#### 4.2.5. [注册节点](https://wiki.risinghf.com/zh/03/01/01/#_3-1-添加-abp-设备)

进入刚才添加的应用，点击添加设备，用户可以选择添加“添加ABP设备”、“添加OTAA设备”和“批量添加”。这里选择“添加OATT设备”举例，填写相应的节点信息，点击“确认添加”注册节点。

![image-20210910180448735](https://wiki.risinghf.com/upload/img/0e89f67b4d17850f022c2173791de6d7.png)

#### 4.2.6. 收发数据

1. 设置节点参数

   用户通过串口连接节点，发送以下命令设置节点：

   >AT+FDEFAULT
   >
   >AT+ID=DEVEUI, 8CF9572000000011
   >
   >AT+ID=APPEUI, 8CF9572000000000
   >
   >AT+KEY=APPKEY, 0123456789ABCDEF0123456789ABCDEF
   >
   >AT+MODE=LWOTAA
   >
   >AT+DR=CN470
   >
   >AT+CH=NUM,0-7
   >
   >AT+JOIN

2. 发送数据节点

   > AT+CMSG=111

   ![image-20210910180544129](https://wiki.risinghf.com/upload/img/727c76685fec5ce6610945fbccb6c0b3.png)

#### 4.2.7. 其他功能

IotSquare服务器除了最基本的LoRaWAN上下行通讯之外，还拓展了其他的一些功能。如：[网关信息管理](https://wiki.risinghf.com/zh/03/01/01/#_6-1-网关详情) 、[多播管理](https://wiki.risinghf.com/zh/03/01/01/#_7-1-添加多播组) 和IotSquare升级等功能。更多详细功能请参考IotSquare在线文档：<https://wiki.risinghf.com/zh/03/01/01/>。

### 4.3. loriot服务器

loriot（<https://www.loriot.io>）是瑞士一家提供LoRaWAN服务器的网络服务器运营商，提供免费账户供用户测试使用，用户可以自行前往注册。

在使用前,请先注意浏览loriot的在线文档<https://cn1.loriot.io/documentation>（根据所选区域不同,子域名前缀会有所不同，本文档使用cn1.loriot.io服务器地址作例子讲解）。

#### 4.3.1. 注册RHF2S208网关

1.  首先要获取设备MAC地址。设备侧面会粘贴一张带有MAC地址的标签。你也可以通过登录设备通过指令ifconfig的方式查询设备的MAC地址，或者通过连接到设备的WiFi并登录设备的内置web界面查询MAC地址信息。

rxhf@rhf2s208:\~$ ifconfig

===========================================================================

eth0: flags=4099\<UP,BROADCAST,MULTICAST> mtu 1500

ether b8:27:eb:d3:18:d9 txqueuelen 1000 (Ethernet)

RX packets 0 bytes 0 (0.0 B)

RX errors 0 dropped 0 overruns 0 frame 0

TX packets 0 bytes 0 (0.0 B)

TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0

![image-20210910180657127](https://wiki.risinghf.com/upload/img/2b246516d8d139d500f41543e91de854.png)

2. 登陆 <http://cn1.loriot.io> 注册账户，如果您已经注册账户请直接登录账户。

3. 点击Dashboard -> Networks->Name（网络名称） -> Add Gateway，选择网关型号RHF2S008/ RHF2S208。

   ![image-20210910180726502](https://wiki.risinghf.com/upload/img/cda074f5d0af76a3c23db621ba2544ec.png)

4.  注册网关时，请选择正确的射频前端：

    1. 868/915 MHz (SX1257)

    2. 434/470/780 MHz (SX1255)
    
       ![image-20210910180753335](https://wiki.risinghf.com/upload/img/f07254ecc2aaef1d6ef5579ed549dc0b.png)

5. 填入MAC地址和网关的安装位置信息。

   ![image-20210910180819248](https://wiki.risinghf.com/upload/img/0bf97619af2a3702e3d28ba52ec4cf18.png)

   ![image-20210910180856580](https://wiki.risinghf.com/upload/img/6c30b47c61e276dc9cd57de3b2597d1e.png)

6. 点击“Register RisingHF RHF2S208 gateway”完成网关的注册。

7. 点击“Gateways”列表进入网关配置界面。

   ![image-20210910180924543](https://wiki.risinghf.com/upload/img/a770c65b3ba5704a31a467464b00518d.png)

8.  根据网关型号选择正确的频段和频率计划。如果需要更多的协助请联系<support@risinghf.com> 。
    
9.  完成网关注册和配置。

10.  登录网关并开始LoRaWAN的通信测试。

#### 4.3.2. 启动loriot服务

执行如下命令启动loriot服务：

```shell
sudo systemctl enable loriot-gw
sudo systemctl restart loriot-gw
```

#### 4.3.3. 关闭loriot服务

执行如下命令停止loriot服务：

```shell
sudo systemctl disable loriot-gw
sudo systemctl stop loriot-gw
```

:::warning

注意：如果要启动loriot-gw服务，请先确认停止pktfwd服务，避免同时启动两个服务而相互冲突。

:::

#### 4.3.4. 配置网关频率

loriot网关配置项均于云端配置，打开loriot控制台找到相应网关页，可于Frequency plan处选择相应的频段。具体频率定义请参阅loriot频率定义表在线文档。

<https://cn1.loriot.io/home/documentation.html#docu/frequency-plan>

#### 4.3.5. loriot固件升级

请于网关注册页面下载loriot-risinghf-rhf2s008-xxxxxx-SPI-0-latest.bin文件，并替换/opt/loriot/loriot。

sudo su

cd /opt/loriot

wget URL -O loriot

使用从网关页面获取的连接地址替换URL。

## 5. 高级应用

### 5.1. 回传网络

#### 5.1.1. 蜂窝网络 (LTE/4G/3G)

RHF2S208设备内嵌名为lte的系统服务, 此服务随系统默认开机启动。可以使用如下指令查看lte拨号日志：

```shell
sudo journalctl -f -n 200 -u lte
```

特点:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     

- **可以对SIM卡进行自动识别并生成APN信息**

-   **支持SIM卡热插拔操作**

-   **不支持漫游功能**

使用下列命令可以对网关的网络状态做进一步分析。

- ifconfig ppp0

  网关拨号成功，系统会生成一个ppp0设备。

  ```shell
  rxhf@RHF2S208:\~$ ifconfig ppp0
  ppp0 Link encap:Point-to-Point Protocol
    inet addr:10.65.6.136 P-t-P:10.64.64.64 Mask:255.255.255.255
    UP POINTOPOINT RUNNING NOARP MULTICAST MTU:1500 Metric:1
    RX packets:5 errors:0 dropped:0 overruns:0 frame:0
    TX packets:5 errors:0 dropped:0 overruns:0 carrier:0
    collisions:0 txqueuelen:3
    RX bytes:56 (56.0 B) TX bytes:80 (80.0 B)
  ```

- sudo ltesim

  使用命令“sudo ltesim”可以核实网关是否插入SIM卡。

  ```shell
  ltesim: lte sim start
  ltesim: OK, SIM inserted
  ltesim: lte sim done
  ```

- sudo lterssi

  当LTE连接成功后，lterssi命令可用于确认4G信号质量。

  ```shell
  lterssi: lte rssi start
  lterssi: OK, RSSI: -77
  lterssi: lte rssi done
  // -77 is the signal strength
  如果 LTE 连接失败， 则日志显示错误。
  ERROR: Celluar network disconnected
  ```

- sudo lteimei

  使用“sudo lteimei”可以读取设备的IMEI码。

  ```shell
  lteimei: lte imei start
  lteimei: OK, 867012030910415
  lteimei: lte imei done
  ```

- sudo ltediagnosis

  如果想对LTE网络连接进行故障分析，可以使用命令“sudo ltediagnosis”。

  ```shell
  ltediagnosis: lte diagnosis start
  ltediagnosis: OK, usb bus normal
  ltediagnosis: OK, lte modem normal
  ltediagnosis: OK, SIM inserted
  ltediagnosis: OK, RSSI: -79
  carrier: 中国移动 (China Mobile) IoT
  ltediagnosis: OK, 460042462508259
  ltediagnosis: lte diagnosis done
  ```

- 添加APN

  设备系统内部已经包含了大多数全球主流运营商的APN配置。但用户也可以通过“addapn”命令来增加更多的APN配置信息。使用“addapn
  --help”可以获取使用该命令的帮助信息。

  ```shell
  rxhf@rhf2s208:\~ $ addapn --help
  Usage: addapn \[options\]
  
  Options:
    --help Show this help
    --carrier \<CARRIER> Set carrier name
    --mcc \<MCC> Set carrier mcc
    --mnc \<MNC> Set carrier mnc
    --apn \<APN> Set carrier apn
    --user \<USER> Set apn user
    --pwd \<PWD> Set apn pwd
    
  Examples:
    addapn --carrier CARRIER --mcc MCC --mnc MNC --apn APN --user USER --pwd PWD
    addapn --carrier CARRIER --mcc MCC --mnc MNC --apn APN
  ```

- 删除APN

  用户想要删除多余的apn时，可以使用“delapn”命令，同样的可以使用“delapn --help”获取该命令的帮助信息。

  ```shell
  rxhf@rhf2s208:\~ $ delapn --help
  Usage: delapn \[options\]
  Options:
    --help Show this help
    --carrier \<CARRIER> Delete carrier apn
    --apn \<APN> Delete apn
  Examples:
    delapn --carrier CARRIER
    delapn --carrier CARRIER --apn APN
  ```

- 查找APN

  用户可以使用“selapn”命令，根据自己的sim卡apn信息查询设备是否已经存在该卡的apn，如果没有，通过addapn添加该卡的apn，同样的可以使用“selapn --help”获取该命令的帮助信息。

  ```shell
  rxhf@rhf2s208:\~ $ selapn --help
  Usage: selapn \[options\]
  
  Options:
    --help Show this help
    --carrier \<CARRIER> Select carrier name
    --mcc \<MCC> Select carrier mcc
    --mnc \<MNC> Select carrier mnc
    --apn \<APN> Select carrier apn
    
  Examples:
    selapn
    selapn --carrier CARRIER --mcc MCC --mnc MNC --apn APN
  ```

#### 5.1.2. 10/100m以太网

当网关通过有线连接到以太网时，设备能获取eth0的端口。通过命令ifconfig可以读取设备局域网分配的ip。你可以通过命令ping来核实网络的通信质量。

![image-20210910182025547](https://wiki.risinghf.com/upload/img/5f087424ab4f66569cf782e76c74f040.png)

#### 5.1.3. 回传网络优先级选择

RHF2S208支持使用4G LTE蜂窝网络或者有线的10/100m网络连接到云服务器。默认配置为有线方式优先，你也可以在内置web
UI界面重新设置回传网络优先级。可以通过命令“route”来查看配置是否生效。

![image-20210910182100685](https://wiki.risinghf.com/upload/img/376a1a57047ab4c17949d6e359b08f5d.png)

![image-20210910182119624](https://wiki.risinghf.com/upload/img/a83d4d86479b618134434dc01955a1ad.png)

### 5.2. WiFi接入

在电脑上选择WiFi信号扫描获取网关的SSID，网关的SSID按照RHF2S208_XXXXXX命名，然后点击连接网关的WiFi，输入密码RisingHF_XXXXXX即可连接，密码后6位和网关的SSID后6位相同，均为MAC地址的末尾3byte大写字母。连接成功后，即可使用192.168.8.1登录设备或者打开内置web UI配置界面。

![image-20210910182158591](https://wiki.risinghf.com/upload/img/6a5e8af38fa866f1c72663e19dc7079f.png)

![image-20210910182210000](https://wiki.risinghf.com/upload/img/a5e4068828b146520dd25a9b1578c1cd.png)

你也可以使用命令“ifconfig”核实网关是否打开wlan0端口。

![image-20210910182230671](https://wiki.risinghf.com/upload/img/430fe28518ded632cfe6514fd9927f8b.png)

### 5.3. 使用GPS功能

RHF2S208内嵌GPS模块(MAX-7Q)，支持GPS功能, LoRaWAN Class B标配硬件。可通过**/dev/serial1**访问，默认波特率9600。

如下指令可以用来简单测试GPS模块的功能。

```shell
sudo gpstest
```

可以得到类似下面的信息：

```shell
$GPRMC,061417.00,A,2232.87469,N,11356.01189,E,0.245,,240719,,,D\*7E
$GPVTG,,T,,M,0.245,N,0.455,K,D\*21
$GPGGA,061417.00,2232.87469,N,11356.01189,E,2,05,3.67,69.1,M,-2.7,M,,0000\*7F
$GPGSA,A,3,06,02,40,12,05,,,,,,,,8.61,3.67,7.79\*00
$GPGSV,3,1,10,02,34,303,31,05,31,223,35,06,48,000,17,09,30,091,\*71
$GPGSV,3,2,10,12,23,312,33,17,58,083,,19,63,049,,23,11,056,\*79
$GPGSV,3,3,10,28,23,170,,40,20,257,29\*78
$GPGLL,2232.87469,N,11356.01189,E,061417.00,A,D\*6D
```

::: warning

注意：测试GPS模块功能时，请先关闭其他使用GPS模块的程序。一般设备的LoRa进程相关的服务会占用GPS模块。

:::

### 5.4. 温度监控

RHF2S208内部集成一个高精度的温度传感器，可以实时监控设备内部环境温度。你既可以使用命令“sudo get_temp”实时查询内部温度，也可以登录网关web界面查询。

```shell
sudo get_temp
40.25 // value return ℃
```

在网关web界面，温度参数将会每分钟刷新一次。用户也可以在日志下载页面下载历史温度日志。

![image-20210910182631776](https://wiki.risinghf.com/upload/img/a73a540025a3010029daca21532a4166.png)

![image-20210910182647886](https://wiki.risinghf.com/upload/img/e3a09c023647d7b2b9957361ff1f0e5b.png)

### 5.5. RTC

借助内部的RTC时钟，网关系统将实时与UTC时钟同步。你可以通过以下命令查询同步的时间：

```shell
sudo hwclock -r
2018-08-04 08:18:33.770069+0000 // synchronized time
```

### 																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																			5.6. 环境底噪扫描

RHF2S208内置底噪分析引擎，该引擎可帮助用户在现场进行环境底噪扫描和分析，以实现网络优化。请登录设备的内置web界面进行底噪扫描分析，详情请参照[4.2.2](\l)章节。

环境底噪是影响无线通信的一个重要指标参数。如果需要在现场架设和安装网关时，务必对现场的环境噪声做一个初步分析，以免高的噪声或者强的干扰影响通信距离和通信可靠性。我们希望环境噪声尽可能的低，但现实环境是不可能完全无干扰或者噪声的。一般建议环境噪底在-110dBm左右是比较理想的。通常也允许噪声最高不超过-100dBm，否则通信距离将严重受限。如果噪声在-95dBm以上，强烈建议更换工作频段以避开干扰噪声。																																																																																																																																																																																																																																							

### 5.7. 获取远程协助支持

RHF2S208内置名为RSSH的服务，默认处于关闭状态。此服务可以用于连接至远程服务器，使得RHF2S208设备可以从远程访问。(注意：																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																																															此功能仅限于RisingHF为客户提供远程支持时使用)

进入web界面的“网络配置->RSSH操作”菜单，点击“启动RSSH”按钮，你将获取到远程登陆的端口号。寻求远程协助支持时，请发送如下截图至support@risinghf.com，并说明问题。我们会有相关人员访问您的设备进行故障排查。

![image-20210910182835448](https://wiki.risinghf.com/upload/img/c1f59752647eff99859a261d68250ab2.png)

::: warning

注意：故障排查完成后，请用户关闭RSSH，降低设备被网络攻击的风险。

:::

## 6. 恢复出厂设置

### 6.1. 下载镜像

请联系<support@risinghf.com>或者登录<http://wiki.risinghf.com>获取镜像下载地址。

### 6.2. Bootloader模式

执行下列步骤令RHF2S208进入Bootloader模式：

1.  断开RHF2S208电源

2.  通过Micro USB线将RHF2S208连接至PC

3.  重新将 RHF2S208上电

4.  进入Bootloader模式

### 6.3. Program

查看在线文档重新烧录RHF2S208固件.[Link](https://www.raspberrypi.org/documentation/hardware/computemodule/cm-emmc-flashing.md)

## 7. 联系方式

联系 salescn@risinghf.com 获取更多订购信息。



