---
date: 2021-04-21 15:32:07
permalink: /01.api/10.iotsquare/02.IoTSquareOpenAPI/
title: IoTSquare OpenAPI
---
# IoTSquare OpenAPI

# 1. Introduction

This document is the IoTSquare advanced API documentation, including applications, devices, gateways, and multicast group management interfaces

1. Interfaces are organized in list, create, delete, update, and status. Some interfaces may only contain create or delete
2. Response data is encoded in JSON, the outermost layer is code, msg, data
   + code contains response code
   + msg contains response message
   + data contains the data body of this request

# 2. Application

## 2.1 Introduction

1. IoTSquare manages devices in the form of applications. You need to register applications and then devices. It is recommended to register devices of the same region and subnet in the same application for later maintenance.
2. When the device uplink data, IoTSquare will take the application's push link and request header to perform data push, the user can customize up to 5 HTTP request headers
3. Applications can optionally receive data using HTTP push (JSON encoding) or receive IoTSquare subscription data using MQTT (ProtocolBuffer encoding). If you have not used MQTT and ProtocolBuffer, it is recommended to use HTTP push to obtain data
4. After the push link is configured, if the device uplink data, the uplink and join sub-paths are automatically added, which are used to push the device uplink application layer data and the device join success message respectively

## 2.2 Application Interface

### 2.2.1 Application List

URL : https://cloud.iotsquare.xyz/openapi/app/list

Request Method: GET

**Request Parameter**

| Field Name | Type | Description     |
| :--------- | :--- | :-------------- |
| pageNo     | int  | number of pages |
| pageSize   | int  | paging size     |

Precautions:

+ pageNo defaults from 1 and pageSize defaults to 10
+ When pageNo is equal to 0 and pageSize is equal to 0, all applications under the username will be returned (restriction returns up to 200)

**Response Parameter**

| Field Name | Type   | Description                                           |
| :--------- | :----- | :---------------------------------------------------- |
| code       | int    | response code                                         |
| msg        | string | response message                                      |
| amount     | int    | total number of applications under username           |
| data       | []App  | data body, containing an array of application objects |

App:

| Field Name | Type   | Description                         |
| :--------- | :----- | :---------------------------------- |
| appID      | int    | application ID                      |
| appName    | string | application name                    |
| pushURL    | string | push link                           |
| enableMQTT | bool   | whether to enable MQTT              |
| deviceNums | int    | number of devices under application |
| createtime | int64  | create time in milliseconds         |
| updatetime | int64  | update time in milliseconds         |

**Sample Data**

Request Response:

```
{
	"code": 0,
	"msg": "ok",
	"amount": 4,
	"data": [{
		"appID": 89,
		"appName": "app_01",
		"pushURL": "https://iot.example.com/api/iotsquare",
		"enableMQTT": false,
		"deviceNums": 0,
		"createtime": 1556529353889,
		"updatetime": 1556529353889
	}, {
		"appID": 90,
		"appName": "app_02",
		"pushURL": "https://iot.example.com/api/iotsquare",
		"enableMQTT": false,
		"deviceNums": 0,
		"createtime": 1556529366216,
		"updatetime": 1556529366216
	}]
}
```

### 2.2.2 Application Create

URL: https://cloud.iotsquare.xyz/openapi/app/create

Request Method: POST

**Request Parameter**

| Field Name | Type   | Description            |
| ---------- | ------ | ---------------------- |
| appName    | string | application name       |
| enableMQTT | bool   | whether to enable MQTT |
| pushURL    | string | push link              |
| headers    | map    | request header         |

Precautions:

+ application name restrictions are composed of letters and underscores, and the length is no more than 20 characters
+ enableMQTT indicates whether to enable the MQTT function,  the default is false
  + If false, use HTTP push, device data is encoded in JSON format
  + If true, use ProtocolBuffer to encode device data and publish it through MQTT protocol
+ pushURL is a push link, it must be a link with a http:// or https:// prefix, assuming the configuration link is https://iot.example.com/api/iotsquare, IoTSquare will add the uplink and join paths respectively, push device uplink application layer data and device join success message, as shown below
  + https://iot.example.com/api/iotsquare/uplink
  + https://iot.example.com/api/iotsquare/join
+ headers are user-defined request headers, the default is empty, users can configure x-access-tokens, userID, etc, to add authentication or custom parameters, each request pushed to the user CS will carry this information

**Response Parameter**

| Field Name | Type   | Description      |
| ---------- | ------ | ---------------- |
| code       | int    | response code    |
| msg        | string | response message |
| appID      | int    | application ID   |

**Sample Data**

Request Parameter:

```
{
	"appName": "app_06",
	"pushURL": "https://iot.example.com/api/iotsquare",
	"enableMQTT": false,
	"headers": {
		"userID": "2333",
		"x-access-token": "6666"
	}
}
```

Request Response:

```
{
	"code": 0,
	"msg": "ok",
	"appID": 233
}
```

### 2.2.3 Application Delete

URL: https://cloud.iotsquare.xyz/openapi/app/delete

Request Method: POST

**Request Parameter**

| Field Name | Type  | Description          |
| ---------- | ----- | -------------------- |
| appIDs     | []int | application ID array |

Precautions:

+ IoTSquare supports batch deletion of applications
+ when an application is deleted, all devices under the application are deleted, and the data uplink, data downlink, and multicast group binding relationship associated with the device are deleted
+ if the application is deleted, the error message corresponding to each exception appID will be included in the data field

**Response Parameter**

| Field Name | Type             | Description                                                  |
| ---------- | ---------------- | ------------------------------------------------------------ |
| code       | int              | response code                                                |
| msg        | int              | response message                                             |
| data       | []AppDeleteError | If an error occurs, the array containing the application delete error object |

AppDeleteError:

| Field Name | Type   | Description      |
| ---------- | ------ | ---------------- |
| code       | int    | response code    |
| msg        | string | response message |
| appID      | int    | application ID   |

**Sample Data**

Request Parameter:

```
{
	"appIDs": [23, 233, 2333, 23333]
}
```

Request Response:

```
// Delete success example
{
	"code": 0,
	"msg": "ok"
}

// Delete the error example, successfully delete the last two applications, the first two errors, return the error details
{
	"code": 3003,
	"msg": "Application Batch Delete Error",
	"data": [{
			"code": 3001,
			"msg": "Application Not Exist",
			"appID": 23
		},
		{
			"code": 3001,
			"msg": "Application Not Exist",
			"appID": 233
		}]
}
```

### 2.2.4 Application Update

URL: https://cloud.iotsquare.xyz/openapi/app/update

Request Method: POST

**Request Parameter**

| Field Name | Type   | Description            |
| ---------- | ------ | ---------------------- |
| appID      | int    | application ID         |
| appName    | string | application name       |
| enableMQTT | bool   | whether to enable MQTT |
| pushURL    | string | push link              |
| headers    | map    | request header         |

Precautions:

- application name restrictions are composed of letters and underscores, and the length is no more than 20 characters
- enableMQTT indicates whether to enable the MQTT function,  the default is false
  - If false, use HTTP push, device data is encoded in JSON format
  - If true, use ProtocolBuffer to encode device data and publish it through MQTT protocol
- pushURL is a push link, it must be a link with a http:// or https:// prefix, assuming the configuration link is https://iot.example.com/api/iotsquare, IoTSquare will add the uplink and join paths respectively, push device uplink application layer data and device join success message, as shown below
  - https://iot.example.com/api/iotsquare/uplink
  - https://iot.example.com/api/iotsquare/join
- headers are user-defined request headers, the default is empty, users can configure x-access-tokens, userID, etc, to add authentication or custom parameters, each request pushed to the user CS will carry this information

**Response Parameter**

| Field Name | Type   | Description      |
| ---------- | ------ | ---------------- |
| code       | int    | response code    |
| msg        | string | response message |

**Sample Data**

Request Parameter:

```
{
	"appName": "app_06",
	"pushURL": "https://iot.example.com/api/iotsquare",
	"enableMQTT": false,
	"headers": {
		"userID": "2333",
		"x-access-token": "6666"
	}
}
```

Request Response:

```
{
	"code": 0,
	"msg": "ok"
}
```

### 2.2.5 Application Status

URL: https://cloud.iotsquare.xyz/openapi/app/status

Request Method: GET

**Request Parameter**

| Field Name | Type | Description    |
| ---------- | ---- | -------------- |
| appID      | int  | application id |

**Response Parameter**

| Field Name | Type      | Description               |
| ---------- | --------- | ------------------------- |
| code       | int       | response code             |
| msg        | string    | response message          |
| data       | AppStatus | application status object |

AppStatus:

| Field Name | Type   | Description                         |
| ---------- | ------ | ----------------------------------- |
| appID      | int    | application ID                      |
| appName    | string | application name                    |
| pushURL    | string | push link                           |
| headers    | map    | request header                      |
| enableMQTT | bool   | whether to enable MQTT              |
| deviceNums | int    | Number of devices under application |
| createtime | int64  | create time in milliseconds         |
| updatetime | int64  | update time in milliseconds         |

**Sample Data**

Request Response:

```
{
	"code": 0,
	"msg": "ok",
	"data": {
		"appID": 89,
		"appName": "app_01",
		"pushURL": "https://iot.example.com/api/iotsquare",
		"headers": {
			"userID": "2333",
			"x-access-token": "6666"
		},
		"enableMQTT": false,
		"deviceNums": 0,
		"createtime": 1556529353889,
		"updatetime": 1556532306098
	}
}
```

# 3. Device

## 3.1 Introduction

1. The IoTSquare online environment currently has the following areas and subnets preset for testing
   + cn470
     + ch_00-07
   + cn470prequel
     + ch_00-07
   + eu868
     + ch_00-07
   + as923
     + ch_00-07
   + us915
     - ch_00-07_64
   + eu433
     - ch_00-07
   + au915
     - ch_00-07_64
   + in865
     - ch_00-07
2. Each area has its own ClassA/B/C default parameters, the subnets in the same area have the same parameters except the frequency range
3. The subnet ch_00-07 indicates the channel using the number 00-07, the subnet ch_00-07_64 indicates the channel using the number 00~07 and 64, and so on
4. Some frequency bands have more channels to ensure normal communication for device, and the gateway, device and NS parameters are required to be consistent, therefore, IoTSquare presets some default frequency bands to be synchronized to each component so that users can quickly get started
5. All devices support the Class A working mode by default, after the device uplinks one frame of data, it opens two receiving windows and receives the downlink data from the server
6. Based on the Class A working mode, device can be configured to support Class B or Class C operating modes
   + Class B: The gateway is required to enable the GPS, after the device successfully switches to the ClassB, it will automatically open the Class B receiving window and receive the downlink data from the server
   + Class C: In addition to the time of the class A uplink data and the subsequent two receiving windows, the class C receiving window is kept open, and receive the server downlink data at any time

## 3.2 Device Interface

### 3.2.1 Device List

URL: https://cloud.iotsquare.xyz/openapi/device/list

Request Method: GET

**Request Parameter**

| Field Name | Type | Description     |
| ---------- | ---- | --------------- |
| appID      | int  | application id  |
| pageNo     | int  | number of pages |
| pageSize   | int  | paging size     |

Precautions:

+ appID is the application ID, it must pass
+ pageNo defaults from 1 and pageSize defaults to 10
+ When pageNo is equal to 0 and pageSize is equal to 0, all devices under the application will be returned (restriction returns up to 200)

**Response Parameter**

| Field Name | Type     | Description                                    |
| ---------- | -------- | ---------------------------------------------- |
| code       | int      | response code                                  |
| msg        | string   | response message                               |
| amount     | int      | total number of devices under application      |
| data       | []Device | data body, containing an array of node objects |

Device:

| Field Name | Type   | Description                                         |
| ---------- | ------ | --------------------------------------------------- |
| devEUI     | string | 16-byte hexadecimal string, device unique identifier |
| devName    | string | device name                                         |
| region     | string | device area                                         |
| fCnt       | int    | device upstream frame counter                       |
| fPort      | int    | device communication port                           |
| lastSeen   | int64  | last communication time in milliseconds             |

Precautions:

+ fCnt and lastSeen are taken from the latest frame device uplink data respectively
+ lastSeen is a Unix timestamp, but the precision is in milliseconds. If the device has not communicated, it will return -1
+ fPort takes the latest frame containing the uplink data of the device of Payload

**Sample Data**

Request Response:

```
{
	"code": 0,
	"msg": "ok",
	"amount": 4,
	"data": [{
		"devEUI": "b0cf5e634ec6d815",
		"devName": "device_01",
		"devAddr": "1d72ffc0",
		"region": "eu868",
		"fCnt": 3,
		"fPort": 8,
		"lastSeen": 1556532306098
	}, {
		"devEUI": "55e1032590dc5682",
		"devName": "device_02",
		"devAddr": "5d71f5cd",
		"region": "eu868",
		"fCnt": 0,
		"fPort": 0,
		"lastSeen": -1
	}]
}
```

### 3.2.2 Device Create

URL: https://cloud.iotsquare.xyz/openapi/device/create

Request Method: POST

**Request Parameter**

| Field Name    | Type   | Description                                              |
| ------------- | ------ | -------------------------------------------------------- |
| appID         | int    | application ID                                           |
| devName       | string | device name                                              |
| devEUI        | string | 16-byte hexadecimal string, device unique identifier      |
| appEUI        | string | 16-byte hexadecimal string, application unique identifier |
| region        | string | device area                                              |
| subnet        | string | Subnet to which the device belongs                       |
| supportClassB | bool   | whether the device supports Class B                      |
| supportClassC | bool   | whether the device supports Class C                      |
| authType      | string | authentication type, optional abp or otaa                |
| appKey        | string | 32-byte hexadecimal string, required for otaa join        |
| devAddr       | string | 8-byte hexadecimal string, required for abp join          |
| appSKey       | string | 32-byte hexadecimal string, required for abp join         |
| nwkSKey       | string | 32-byte hexadecimal string, required for abp join         |
| macVersion       | string | LoRaWAN protocol version，available values are 1.0.2 and 1.0.3, defaults to 1.0.2 if not set        |

Precautions:

+ Device name restrictions are composed of letters and underscores, and the length is no more than 20 characters
+ Region and subnet represent the area and subnet to which the device belongs, IoTSquare provides a default configuration for each zone, it is necessary to ensure that devices, gateways, and servers are consistent in order to communicate normally
+ All devices support Class A by default. In this case, Class B or Class C can be optionally supported, but it cannot be checked at the same time because devices cannot work in both B and C modes
  - Class A: supportClassB=false、supportClassC=false
  - Class B: supportClassB=true、supportClassC=false
  - Class C: supportClassB=false、supportClassC=true
+ authType optional abp or otaa
  + abp: The user must fill in devAddr, appSKey, nwkSKey, the device doesn't need to join, the server will verify whether the combination of devAddr+nwkSKey has duplicates
  + otaa: The user must fill in the appKey, after the device join succeeds, devAddr, appSKey, and nwkSKey will be automatically generated
+ macVersion can be selected from 1.0.2 or 1.0.3. When a device which supports 1.0.3 joins network, the JoinAccept message will carry channelMask to sync uplink channels. The standard frequency schemes including US915, AU915 and CN470 support this feature.

**Response Parameter**

| Field Name | Type   | Description      |
| ---------- | ------ | ---------------- |
| code       | int    | response code    |
| msg        | string | response message |

**Sample Data**

Request Parameter:

```
// OTAA join
{
	"appID": 89,
	"supportClassB": false,
	"supportClassC": true,
	"devEUI": "55e1032590dc5682",
	"appEUI": "fbd11efce114c519",
	"devName": "device_02",
	"region": "eu868",
	"subnet": "ch_00-07",
	"authType": "otaa",
	"appKey": "a14e7a59f879d32a47d1c0825bdcfe0b",
	"macVersion":"1.0.2"
}
// ABP join
{
	"appID": 89,
	"supportClassB": false,
	"supportClassC": true,
	"devEUI": "dafc73e93941defa",
	"appEUI": "2536e67b3ca8906d",
	"devName": "device_04",
	"region": "eu868",
	"subnet": "ch_00-07",
	"authType": "abp",
	"appSKey": "9ac5bcb434d8a4d6e67b3dec60ce5f84",
	"nwkSKey": "678211ee2b22b3bf216f28296e3eb67b",
	"devAddr": "5d71f5cd",
	"macVersion":"1.0.2"
}
```

Request Response:

```
{
	"code": 0,
	"msg": "ok"
}
```

### 3.2.3 Device Delete

URL: https://cloud.iotsquare.xyz/openapi/device/delete

Request Method: POST

**Request Parameter**

| Field Name | Type     | Description  |
| ---------- | -------- | ------------ |
| devEUIs    | []string | devEUI array |

Precautions:

+ IoTSquare supports batch deletion of devices
+ When deleting a device, delete the data uplink, data downlink, and multicast group binding relationship associated with the device at the same time
+ If an error occurs when deleting a device, the error message corresponding to each exception devEUI is included in the data field

**Response Parameter**

| Field Name | Type                | Description                                                  |
| ---------- | ------------------- | ------------------------------------------------------------ |
| code       | int                 | response code                                                |
| msg        | string              | response message                                             |
| data       | []DeviceDeleteError | If an error occurs, the array containing the node delete error object |

DeviceDeleteError:

| Field Name | Type   | Description                                         |
| :--------- | :----- | :-------------------------------------------------- |
| code       | int    | response code                                       |
| msg        | string | response message                                    |
| devEUI     | string | 16-byte hexadecimal string, device unique identifier |

**Sample Data**

Request Parameter:

```
{
	"devEUIs": ["b0cf5e634ec6d815", "55e1032590dc5682", "0f475d71f5cd2f20", "84955e634ec6d815"]
}
```

Request Response:

```
// Delete success example
{
	"code": 0,
	"msg": "ok"
}
// Delete error example, partial node deletion failed
{
    "code": 4006,
    "msg": "Device Batch Delete Error",
    "data": [
        {
            "code": 4001,
            "msg": "Device Not Exist",
            "devEUI": "0f475d71f5cd2f20"
        },
        {
            "code": 4001,
            "msg": "Device Not Exist",
            "devEUI": "84955e634ec6d815"
        }
    ]
}
```

### 3.2.4 Device Update

URL: https://cloud.iotsquare.xyz/openapi/device/update

Request Method: POST

**Request Parameter**

| Field Name | Type   | Description                                         |
| ---------- | ------ | --------------------------------------------------- |
| devEUI     | string | 16-byte hexadecimal string, device unique identifier |
| devName    | string | device name                                         |

Precautions:

+ Since the device contains a large number of parameter configurations, changing the parameters may cause the device to fail to work properly, currently, IoTSquare only supports changing the device name, if you need to change the device configuration, delete the device first, then re-enter it with the new parameters, and then verify whether the device can join or normal uplink data
+ Device name restrictions are composed of letters and underscores, and the length is no more than 20 characters

**Sample Data**

Request Parameter:

```
{
	"devEUIs": "b0cf5e634ec6d815",
	"devName": "node_2333"
}
```

Request Response:

```
{
	"code": 0,
	"msg": "ok"
}
```

### 3.2.5 Device Status

URL: https://cloud.iotsquare.xyz/openapi/device/status

Request Method: GET

**Request Parameter**

| Field Name | Type   | Description                                         |
| ---------- | ------ | --------------------------------------------------- |
| devEUI     | string | 16-byte hexadecimal string, device unique identifier |

**Response Parameter**

| Field Name | Type        | Description          |
| :--------- | :---------- | :------------------- |
| code       | int         | response code        |
| msg        | string      | response message     |
| data       | DeviceStaus | device status object |

DeviceStaus:

| Field Name    | Type   | Description                                              |
| :------------ | :----- | :------------------------------------------------------- |
| devName       | string | device name                                              |
| devEUI        | string | 16-byte hexadecimal string, device unique identifier      |
| appEUI        | string | 16-byte hexadecimal string, application unique identifier |
| region        | string | device area                                              |
| subnet        | string | Subnet to which the device belongs                       |
| supportClassB | bool   | whether the device supports Class B                      |
| supportClassC | bool   | whether the device supports Class C                      |
| authType      | string | authentication type, optional abp or otaa                |
| appKey        | string | appKey, 32-byte hexadecimal string                        |
| devAddr       | string | devAddr, 8-byte hexadecimal string                        |
| appSKey       | string | appSKey, 32-byte hexadecimal string                       |
| nwkSKey       | string | nwkSKey, 32-byte hexadecimal string                       |

**Sample Data**

Request Response:

```
{
	"code": 0,
	"msg": "ok",
	"data": {
		"devEUI": "90b96dadce96a06a",
		"appEUI": "526973696e674846",
		"devName": "device_01",
		"authType": "otaa",
		"region": "eu868",
		"subnet": "ch_00-07",
		"devAddr": "12ef4567",
		"appKey": "6b7e151628aed2a6abf7158809cf4f3c",
		"appSKey": "0bf7158809cf4f3cb7e151628aed2a6a",
		"nwkSKey": "28aed2a6abf7158809cf2b7e15164f3c",
		"supportClassB": false,
		"supportClassC": true,
		"createtime": 1556522944593
	}
}
```

# 4. Device Data Downlink

## 4.1 Introduction

1. IoTSquare uses the first-in first-out queue to store the application layer data downlink of the device. Each device corresponds to a downlink queue. When the device works in Class A/B/C, the downlink data is taken from the same queue, if Class A uplink and Class B/C active downlink occur at the same time, priority is given to Class A uplink to obtain data from the queue
   + For Class A, the downlink data will be carried when the device uplink, and the device will receive the data in the two receiving windows after sending the data
   + For Class B, in addition to the Class A uplink carrying data, the IoTSquare periodically scans the device downlink queue, and the queue data with the GPS timestamp not timed out is actively sent, and the device will receive the data in the Class B receiving window that is started periodically
   + For Class C, in addition to the Class A uplink carrying data, the IoTSquare periodically scans the device downlink queue, and actively sends the message in the case of avoiding the two receiving windows of the Class A device, and the device will receive it in the open Class C receiving window
2. Due to the structure of the queue, IoTSquare can buffer the downlink data, but for the otaa device, when the device rejoins, the device communication key is automatically changed, and the downstream queue will be cleared
3. During the communication process, the data rate of the device changes, which indirectly affects the length of the data packet that can be delivered. To ensure that the downlink data does not exceed the current rate limit length
   + For Class A, you can use the rate of the latest frame data of the device in combination with the frequency region calculation to obtain the maximum data length that can be delivered
   + For Class B and Class C, the lorawan protocol fixes the data rate, and needs to take the Class B or Class C parameters of the corresponding frequency region of the device to calculate the maximum data length that can be delivered

## 4.2 Device Data Downlink Interface

### 4.2.1 Data Downlink Create

URL: https://cloud.iotsquare.xyz/openapi/devicedl/create

Request Method: POST

**Request Parameter**

| Field Name | Type   | Description                                         |
| ---------- | ------ | --------------------------------------------------- |
| devEUI     | string | 16-byte hexadecimal string, device unique identifier |
| fPort      | int    | device communication port                           |
| data       | string | base64 encoded data string                          |
| confirmed  | bool   | confirmed or unconfirmed                            |

Precautions:

+ The value of fPort is 1~199, 201~223, and the remaining ports are reserved for the lorawan protocol
+ data is a base64 encoded numeric string, IoTSquare will decode the value in base64 and then framing it in binary format and then sending it to the device
  + If the original data is hexadecimal data, for example, 0x2333, the length is two bytes, and the base64 encoded data is "IzM="
  + If the original data is an ASCII string, such as "2333", the length is four bytes, and the base64 encoded data is "MjMzMw=="
  + Confirmed indicates whether the corresponding downlink packet is the confirmed downlink. After receiving the downlink data, the device will set the ack bit to 1 in the next uplink frame, the confirmed default is false, and the server uses the unconfirmed downlink

**Response Parameter**

| Field Name | Type   | Description                |
| ---------- | ------ | -------------------------- |
| code       | int    | response code              |
| msg        | string | response message           |
| fCnt       | int    | the downlink frame counter |

Precautions:

+ Each device maintains a pair of uplink frame counters and downlink frame counters, and calls the fCnt returned by the data downlink interface to deliver the corresponding downlink frame counter number for this data

**Sample Data**

Request Parameter:

```
// The original data is hexadecimal 0x2333 and the length is two bytes
{
	"devEUI": "b0cf5e634ec6d815",
	"fPort": 8,
	"data": "IzM=",
	"confirmed": false
}
// The original data is the ASCII string "2333" and the length is four bytes
{
	"devEUI": "b0cf5e634ec6d815",
	"fPort": 8,
	"data": "MjMzMw==",
	"confirmed": false
}
```

Request Response:

```
{
	"code": 0,
	"msg": "ok",
	"fCnt": 6666
}
```

# 5. Gateway

## 5.1 Introduction

1. IoTSquare supports gateways to connect to servers using UDP or MQTT protocols
2. When the gateway uses UDP connection, it is directly communicated with the server by pktfwd, and the online status of the gateway is also determined by the UDP connection status
3. When the gateway uses the MQTT connection, the gateway SDK communicates with the server, at this time, more advanced functions can be obtained, including the gateway network status, system status, etc. After the gateway enters the IoTSquare and successfully connects to the server, the pktfwd will be automatically configured according to the entered gateway type, Frequency plan, etc
4. Gateway availability zone Subnet reference device configuration
5. Currently available gateway models are as follows
   - rhf2s208
   - rhf2s208f
   - rhf2s024
   - rhf2s025
6. The gateway model defaults to a half-duplex gateway, and the f-suffix (such as rhf2s208f) is represented as a full-duplex gateway

## 5.2 Gateway Interface

### 5.2.1 Gateway List

URL: https://cloud.iotsquare.xyz/openapi/gateway/list

Request Method: GET

**Request Parameter**

| Field Name | Type | Description     |
| ---------- | ---- | --------------- |
| pageNo     | int  | number of pages |
| pageSize   | int  | paging size     |

Precautions:

+ pageNo defaults from 1 and pageSize defaults to 10
+ When pageNo is equal to 0 and pageSize is equal to 0, all gateways under the user name will be returned (restriction returns up to 200)

**Response Parameter**

| Field Name | Type      | Description                                       |
| :--------- | :-------- | :------------------------------------------------ |
| code       | int       | response code                                     |
| msg        | string    | response message                                  |
| amount     | int       | total number of gateways under username           |
| data       | []Gateway | data body, containing an array of gateway objects |

Gateway:

| Field Name | Type   | Description                                                  |
| :--------- | :----- | :----------------------------------------------------------- |
| gwID       | string | gateway ID，16-byte hexadecimal string, gateway unique identifier |
| gwName     | string | gateway name                                                 |
| gwType     | string | gateway type                                                 |
| region     | string | gateway area                                                 |
| online     | bool   | whether the gateway is online                                |
| createtime | int64  | create time in milliseconds                                  |
| lastSeen   | int64  | last communication time in milliseconds                      |

Precautions:

+ Gateway online status is taken from pktfwd or gateway SDK connection status
+ lastSeen is a Unix timestamp, but the precision is in milliseconds. If the gateway has not communicated, it will return -1

**Sample Data**

Request Response:

```
{
	"code": 0,
	"msg": "ok",
	"amount": 3,
	"data": [{
		"gwID": "31b977fffe398501",
		"gwName": "gateway_01",
		"gwType": "rhf2s208",
		"region": "cn470",
		"online": false,
		"createtime": 1557020283245,
		"lastSeen": -1
	}, {
		"gwID": "d58158fffe83fd51",
		"gwName": "gateway_02",
		"gwType": "rhf2s208",
		"region": "au915",
		"online": false,
		"createtime": 1557020300856,
		"lastSeen": -1
	}]
}
```

### 5.2.2 Gateway Create

URL: https://cloud.iotsquare.xyz/openapi/gateway/create

Request Method: POST

**Request Parameter**

| Field Name   | Type   | Description                                                  |
| ------------ | ------ | ------------------------------------------------------------ |
| gwID         | string | gateway ID，16-byte hexadecimal string, gateway unique identifier |
| gwName       | string | gateway name                                                 |
| gwType       | string | gateway type                                                 |
| region       | string | gateway area                                                 |
| subnet       | string | gateway subnet                                               |
| enableClassB | bool   | whether to enable Class B                                    |
| enablePFW    | bool   | whether to enable pktfwd                                     |

Precautions:

+ Gateway name restrictions are composed of letters and underscores, and the length is no more than 20 characters
+ enableClassB indicates whether ClassB support is enabled, you need to install the gateway SDK and configure the GPS gateway to support it, the default is false
  + If false, the gateway does not enable ClassB support, only as a packet time source
  + If true, the gateway enables ClassB support, and enables the Beacon broadcast of the corresponding area and subnet to synchronize the clock
+ enablePFW indicates whether pktfwd is enabled, you need to install the gateway SDK to support it, the default is true
  + If false, the gateway SDK does not enable pktfwd and only runs as a remote management tool
  + If true, the gateway SDK will enable pktfwd, maintain pktfwd operation, auto restart, configuration synchronization, etc

**Response Parameter**

| Field Name | Type   | Description      |
| ---------- | ------ | ---------------- |
| code       | int    | response code    |
| msg        | string | response message |

**Sample Data**

Request Parameter:

```
{
	"gwID": "d58158fffe83fd51",
	"gwName": "gateway_02",
	"region": "au915",
	"gwType": "rhf2s208",
	"subnet": "ch_00-07_64",
	"enableClassB": false,
	"enablePFW": true
}
```

Request Response:

```
{
	"code": 0,
	"msg": "ok"
}
```

### 5.2.3 Gateway Delete

URL: https://cloud.iotsquare.xyz/openapi/gateway/delete

Request Method: POST

**Request Parameter**

| Field Name | Type  | Description      |
| ---------- | ----- | ---------------- |
| gwIDs      | []int | gateway ID array |

Precautions:

+ IoTSquare supports batch deletion of gateways
+ When the gateway is deleted, the data uplink and data downlink information associated with the gateway are deleted at the same time, and the pktfwd program on the gateway is closed
+ If an error occurs when deleting the gateway, the error message corresponding to each exception gwID is included in the data field

**Response Parameter**

| Field Name | Type                 | Description                                                  |
| :--------- | :------------------- | :----------------------------------------------------------- |
| code       | int                  | response code                                                |
| msg        | string               | response message                                             |
| data       | []GatewayDeleteError | If an error occurs, the array containing the gateway delete error object |

GatewayDeleteError:

| Field Name | Type   | Description                                                  |
| :--------- | :----- | :----------------------------------------------------------- |
| code       | int    | response code                                                |
| msg        | string | response message                                             |
| gwID       | string | gateway ID，16-byte hexadecimal string, gateway unique identifier |

**Sample Data**

Request Parameter:

```
{
	"gwIDs": ["d58158fffe83fd51", "31b977fffe398501"]
}
```

Request Response:

```
// Successfully deleted example
{
	"code": 0,
	"msg": "ok"
}

// Delete the error example, some gateways do not exist
{
    "code": 5006,
    "msg": "Gateway Batch Delete Error",
    "data": [
        {
            "code": 5001,
            "msg": "Gateway Not Exist",
            "gwID": "d58158fffe83fd51"
        },
        {
            "code": 5001,
            "msg": "Gateway Not Exist",
            "gwID": "31b977fffe398501"
        }
    ]
}
```

### 5.2.4 Gateway Update

URL: https://cloud.iotsquare.xyz/openapi/gateway/update

Request Method: POST

**Request Parameter**

| Field Name   | Type   | Description                                                  |
| ------------ | ------ | ------------------------------------------------------------ |
| gwID         | string | gateway ID，16-byte hexadecimal string, gateway unique identifier |
| gwName       | string | gateway name                                                 |
| gwType       | string | gateway type                                                 |
| enableClassB | bool   | whether to enable Class B                                    |
| enablePFW    | bool   | whether to enable pktfwd                                     |

Precautions:

- Gateway name restrictions are composed of letters and underscores, and the length is no more than 20 characters
- enableClassB indicates whether ClassB support is enabled, you need to install the gateway SDK and configure the GPS gateway to support it, the default is false
  - If false, the gateway does not enable ClassB support, only as a packet time source
  - If true, the gateway enables ClassB support, and enables the Beacon broadcast of the corresponding area and subnet to synchronize the clock
- enablePFW indicates whether pktfwd is enabled, you need to install the gateway SDK to support it, the default is true
  - If false, the gateway SDK does not enable pktfwd and only runs as a remote management tool
  - If true, the gateway SDK will enable pktfwd, maintain pktfwd operation, auto restart, configuration synchronization, etc

**Response Parameter**

| Field Name | Type   | Description      |
| ---------- | ------ | ---------------- |
| code       | int    | response code    |
| msg        | string | response message |

**Sample Data**

Request Parameter:

```
{
	"gwID": "31b977fffe398501",
	"gwName": "gateway_01",
	"gwType": "rhf2s208",
	"enableClassB": true,
	"enablePFW": true
}
```

Request Response:

```
{
	"code": 0,
	"msg": "ok"
}
```

### 5.2.5 Gateway Status

URL: https://cloud.iotsquare.xyz/openapi/gateway/status

Request Method: GET

**Request Parameter**

| Field Name | Type   | Description                                                  |
| ---------- | ------ | ------------------------------------------------------------ |
| gwID       | string | gateway ID，16-byte hexadecimal string, gateway unique identifier |

**Response Parameter**

| Field Name | Type          | Description           |
| ---------- | ------------- | --------------------- |
| code       | int           | response code         |
| msg        | string        | response message      |
| data       | GatewayStatus | gateway status object |

GatewayStatus:

| Field Name   | Type   | Description                                                  |
| :----------- | :----- | :----------------------------------------------------------- |
| gwID         | string | gateway ID，16-byte hexadecimal string, gateway unique identifier |
| gwName       | string | gateway name                                                 |
| gwType       | string | gateway type                                                 |
| region       | string | gateway area                                                 |
| subnet       | string | gateway subnet                                               |
| online       | bool   | whether the gateway is online                                |
| enableClassB | bool   | whether to enable Class B                                    |
| enablePFW    | bool   | whether to enable pktfwd                                     |
| mqtt         | bool   | whether the gateway accesses the server in MQTT mode         |
| altitude     | float  | altitude, need a gateway with GPS                            |
| latitude     | float  | Latitude, need a gateway with GPS                            |
| longitude    | float  | Longitude, need a gateway with GPS                           |
| createtime   | int64  | create time in milliseconds                                  |

**Sample Data**

Request Response:

```
{
	"code": 0,
	"msg": "ok",
	"data": {
		"gwID": "31b977fffe398501",
		"gwName": "gateway_01",
		"gwType": "rhf2s208",
		"enableClassB": true,
		"enablePFW": true,
		"region": "cn470",
		"subnet": "ch_00-07",
		"online": false,
		"mqtt": false,
		"latitude": 0,
		"longitude": 0,
		"altitude": 0,
		"createtime": 1557020283245
	}
}
```

# 6. Multicast Group

## 6.1 Introduction

In computer networking, multicast is group communication where data transmission is addressed to a group of destination computers simultaneously.

### 6.1.1 Unicast vs Multicast vs Broadcast

In order to simplify the concept, the device data delivery operation is used to describe unicast, multicast, and broadcast, assuming that a group of devices are in the Class C state, users need to send data to them

+ Unicast: Sends data downlink to each device separately, at this time, the route from the iotsqaure to the device takes the gateway in the latest frame of data uplink, if there are N devices, it needs to be sent N times, which is less efficient
+ Broadcast: No calculation, use multicast address framing, send data to all gateways in the system online, if there are M gateways, need to send M times, the least efficiency
+ Multicast: Take the upstream gateway history of this batch of devices, and calculate the minimum number of gateways required for iotsqaure to reach all devices, and then use the multicast address framing to send data downlinks for each calculated gateway. If the devices send data through a gateway, then only one transmission is required, which is the most efficient

### 6.1.2 Unicast Address vs Multicast Address

+ Unicast Address: devAddr manually configured by abp device or devAddr assigned after otaa device join succeeds
+ Multicast Address: mcAddr manually configured with at+lw=mc or mcAddr automatically generated using multicast protocol

### 6.1.3 Manually Configure Multicast vs Auto-configure Multicast

The lorawan protocol defines a set of application layer-based multicast control protocol, which requires device and server to support at the same time. In a way similar to otaa join, a synchronization process is required to obtain dynamically allocated multicast addresses and key configuration from the server, provide multicast functionality

In addition to the standard protocol, RisingHF adds the function of manually configuring the multicast address, allowing the multicast function to be provided in the form of abp-like join, without the need to synchronize parameters from the server, directly by using the AT command to configure mcAddr, mcAppSKey, and mcNwkSKey

### 6.1.4 Multicast Extended Function

Based on the lorawan multicast protocol, RisingHF developed the multicast extended function. When the multicast group enable the automatic control and extended function at the same time, limit the maximum number of devices in the group to 253, user's multicast data delivery will be specially processed, and one or more rounds of data downlink will be performed by IoTSquare, and get the number of devices that responded successfully, after processing, use HTTP push or MQTT to release downlink result

### 6.1.5 How to use multicast groups

1. Each multicast group is only allowed to add device with the same region and subnet, currently, support the Class C device
2. The device needs to enter the application before entering the multicast group
3. Manually configure multicast to support one multicast address, auto-configure multicast to support up to four multicast addresses

## 6.2 Multicast Group Interface

### 6.2.1 Multicast Group List

URL: https://cloud.iotsquare.xyz/openapi/mcgroup/list

Request Method: GET

**Request Parameter**

| Field Name | Type | Description     |
| ---------- | ---- | --------------- |
| pageNo     | int  | number of pages |
| pageSize   | int  | paging size     |

Precautions:

+ pageNo defaults from 1 and pageSize defaults to 10
+ When pageNo is equal to 0 and pageSize is equal to 0, all multicast groups under the user name will be returned (restriction returns up to 200)

**Response Parameter**

| Field Name | Type      | Description                                               |
| :--------- | :-------- | :-------------------------------------------------------- |
| code       | int       | response code                                             |
| msg        | string    | response message                                          |
| amount     | int       | total number of multicast groups under username           |
| data       | []MCGroup | data body, containing an array of multicast group objects |

MCGroup:

| Field Name | Type   | Description                                                  |
| :--------- | :----- | :----------------------------------------------------------- |
| mcEUI      | string | 16-byte hexadecimal string, multicast group unique identifier |
| mcName     | string | multicast group name                                         |
| region     | string | multicast group area                                         |
| subnet     | string | multicast group subnet                                       |
| groupID    | string | multicast group ID                                           |
| deviceNums | int    | number of devices under multicast group                      |
| pushURL    | string | push link                                                    |
| enableMQTT | bool   | whether to enable MQTT                                       |
| createtime | int64  | create time in milliseconds                                  |

Precautions:

- Region, subnet parameter reference device introduction chapter
- If auto-configuration multicast is enabled, the groupID value is 0~3, if you use manual configuration multicast, the groupID defaults to 256

**Sample Data**

Request Response:

```
{
	"code": 0,
	"msg": "ok",
	"amount": 2,
	"data": [{
		"mcEUI": "778327e60a028072",
		"mcName": "mc_nodes_00",
		"region": "eu868",
		"subnet": "ch_00-07",
		"groupID": 0,
		"pushURL": "https://iot.example.com/api/iotsquare",
		"enableMQTT": false,
		"deviceNums": 50,
		"createtime": 1556283852576
	}, {
		"mcEUI": "e6a98ae25d7db6f8",
		"mcName": "mc_nodes_01",
		"region": "eu868",
		"subnet": "ch_00-07",
		"groupID": 256,
		"pushURL": "",
		"enableMQTT": false,
		"deviceNums": 0,
		"createtime": 1556611552899
	}]
}
```

### 6.2.2 Multicast Group Create

URL: https://cloud.iotsquare.xyz/openapi/mcgroup/create

Request Method: POST

**Request Parameter**

| Field Name     | Type   | Description                                                  |
| :------------- | :----- | :----------------------------------------------------------- |
| mcEUI          | string | 16-byte hexadecimal string, multicast group unique identifier |
| mcName         | string | multicast group name                                         |
| region         | string | multicast group area                                         |
| subnet         | string | multicast group subnet                                       |
| class          | string | the node type supported by the multicast group, currently supports Class C , the default is C (upper case) |
| enableMCRemote | bool   | whether to enable multicast auto configuration               |
| groupID        | int    | multicast ID, if multicast auto configuration is enabled, optional 0~3, multicast auto configuration is required |
| enableMCExt    | bool   | whether to enable the multicast extension function, if enabled, limit the number of node devices in the multicast group to 253 |
| timeSlotLength | int    | time slice length, optional 0~15, multicast extension function required |
| genAppKey      | string | 32-byte hexadecimal string, multicast auto-configuration required |
| mcAddr         | string | 8-byte hexadecimal string, manual configuration multicast required |
| mcAppSKey      | string | 32-byte hexadecimal string, manual configuration multicast required |
| mcNwkSKey      | string | 32-byte hexadecimal string, manual configuration multicast required |
| enableMQTT     | bool   | whether to enable MQTT, manual configuration multicast required |
| pushURL        | string | push link, multicast auto-configuration required             |
| headers        | map    | request header, multicast auto configuration optional        |

Precautions:

+ Multicast group name restrictions are composed of letters and underscores, and the length is no more than 20 characters
+ enableMCRemote indicates whether to enable multicast auto-configuration, the default is false
  + If false: The user must fill in mcAddr, mcAppSKey, mcNwkSKey, and the server will verify whether the combination of mcAddr+mcNwkSKey has duplicates
  + If true: The user must fill in genAppKey, groupID, and the device will obtain mcAddr, mcAppSKey, mcNwkSKey, groupID through the multicast protocol
+ enableMQTT indicates whether to enable the MQTT function, the default is false
  + If false, use HTTP push, device data is encoded in JSON format
  + If true, use ProtocolBuffer to encode device data and publish it through MQTT protocol
+ pushURL is a push link. After the extended function is enabled, IoTSquare pushes each data downlink result of the user, assuming the configuration link is https://iot.example.com/api/iotsquare, IoTSquare will add a multicast path for pushing the downlink result, as follows
  + https://iot.example.com/api/iotsquare/multicast
+ Headers are user-defined request headers, the default is empty, users can configure x-access-tokens, userID, etc, to add authentication or custom parameters, each request push to the user CS will carry this information

**Response Parameter**

| Field Name | Type   | Description      |
| ---------- | ------ | ---------------- |
| code       | int    | response code    |
| msg        | string | response message |

**Sample Data**

Request Parameter:

```
// Enable multicast auto-configuration and enable multicast extensions
{
	"mcName": "mc_group_00",
	"mcEUI": "f7d96c075a6d0154",
	"region": "eu868",
	"subnet": "ch_00-07",
	"class": "C",
	"enableMCRemote": true,
	"groupID": 0,
	"genAppKey": "504e83e6dd1a457af1bf93f99d362e89",
	"enableMCExt": true,
	"timeSlotLength": 3,
	"enableMQTT": false,
	"pushURL": "https://test.example.com/api/iotsquare",
	"headers": {
		"userID": "2333",
		"x-access-token": "6666"
	}
}
// Manually configure multicast
{
	"mcName": "mc_group_02",
	"mcEUI": "0abe5ddf92cff537",
	"region": "eu868",
	"subnet": "ch_00-07",
	"class": "C",
	"enableMCRemote": false,
	"mcAddr": "45c325ce",
	"mcAppSKey": "a1ef710bb888c7f0d1a296a442203fb8",
	"mcNwkSKey": "868d85d136e7006619c6910aaf3e488e"
}
```

Request Response:

```
{
	"code": 0,
	"msg": "ok"
}
```

### 6.2.3 Multicast Group Delete

URL: https://cloud.iotsquare.xyz/openapi/mcgroup/delete

Request Method: POST

**Request Parameter**

| Field Name | Type     | Description |
| ---------- | -------- | ----------- |
| mcEUIs     | []string | mcEUI array |

Precautions:

+ IoTSquare supports batch deletion of multicast groups
+ When a multicast group is deleted, unbind all devices under the multicast group
+ If an error occurs in deleting the multicast group, the error message corresponding to each abnormal mcEUI is included in the data field

**Response Parameter**

| Field Name | type                 | Description                                                  |
| :--------- | :------------------- | :----------------------------------------------------------- |
| code       | int                  | response code                                                |
| msg        | string               | response message                                             |
| data       | []MCGroupDeleteError | if an error occurs, the array containing the multicast group delete error object |

MCGroupDeleteError:

| Field Name | Type   | Description                                                  |
| :--------- | :----- | :----------------------------------------------------------- |
| code       | int    | response code                                                |
| msg        | string | response message                                             |
| mcEUI      | string | 16-byte hexadecimal string, multicast group unique identifier |

**Sample Data**

Request Parameter:

```
{
	"mcEUIs": ["ec6d815b0cf5e634", "32590dc55e105682", "75d71f50f4cd2f20", "5e634ec6d8495815"]
}
```

Request Response:

```
// Successfully deleted example
{
	"code": 0,
	"msg": "ok"
}
// Delete error example, some multicast group deletion failed
{
    "code": 14007,
    "msg": "MCGroup Batch Delete Error",
    "data": [
        {
            "code": 14001,
            "msg": "MCGroup Not Exist",
            "mcEUI": "32590dc55e105682"
        },
        {
            "code": 14001,
            "msg": "MCGroup Not Exist",
            "mcEUI": "75d71f50f4cd2f20"
        }
    ]
}
```

### 6.2.4 Multicast Group Update

URL: https://cloud.iotsquare.xyz/openapi/mcgroup/update

Request Method: POST

**Request Parameter**

| Field Name     | Type   | Description                                                  |
| -------------- | ------ | ------------------------------------------------------------ |
| mcEUI          | string | 16-byte hexadecimal string, multicast group unique identifier |
| mcName         | string | multicast name                                               |
| timeSlotLength | int    | time slice length, optional 0~15, multicast extended function required |
| mcAddr         | string | 8-byte hexadecimal string, manual configuration multicast required |
| mcAppSKey      | string | 32-byte hexadecimal string, manual configuration multicast required |
| mcNwkSKey      | string | 32-byte hexadecimal string, manual configuration multicast required |
| enableMQTT     | bool   | whether to enable MQTT, manual configuration multicast required |
| pushURL        | string | push link, multicast auto-configuration required             |
| headers        | map    | request header, multicast auto configuration optional        |

Precautions:

+ Multicast group name restrictions are composed of letters and underscores, and the length is no more than 20 characters
+ If multicast automatic configuration is disabled, the user can update mcAddr, mcAppSKey, mcNwkSKey, and the server will verify whether the combination of mcAddr+mcNwkSKey has duplicates
+ Users can update timeSlotLength if multicast auto-configuration and extended function is enabled
+ enableMQTT indicates whether to enable the MQTT function, the default is false
  + If false, use HTTP push, node data is encoded in JSON format
  + If true, use ProtocolBuffer to encode node data and publish it through MQTT protocol
+ pushURL is a push link. After the extended function is enabled, IoTSquare pushes each data downlink result of the user, assuming the configuration link is https://iot.example.com/api/iotsquare, IoTSquare will add a multicast path for pushing the downlink result, as follows
  - https://iot.example.com/api/iotsquare/multicast
+ Headers are user-defined request headers, the default is empty, users can configure x-access-tokens, userID, etc, to add authentication or custom parameters, each request push to the user CS will carry this information

**Response Parameter**

| Field Name | Type   | Description      |
| ---------- | ------ | ---------------- |
| code       | int    | response code    |
| msg        | string | response message |

**Sample Data**

Request Parameter:

```
// Enable multicast auto configuration and enable Extended function
{
	"mcEUI": "ef9a560aba9c3d7d",
	"mcName": "mc_group_02",
	"pushURL": "https://test.example.com/api/iotsquare",
	"enableMQTT": false,
	"headers": {
		"x-access-token": "6666",
		"userID": "2333"
	},
	"timeSlotLength": 3
}
// Manually configure multicast
{
	"mcEUI": "a0891ce817397ee8",
	"mcName": "mc_group_03",
	"mcAddr": "75bacecd",
	"mcAppSKey": "a32da0c03d3ab55e5be1dcc60f777481",
	"mcNwkSKey": "c013d964a16c9ee761cfd295614acf17"
}
```

Request Response:

```
{
	"code": 0,
	"msg": "ok"
}
```

### 6.2.5 Multicast Group Status

URL: https://cloud.iotsquare.xyz/openapi/mcgroup/status

Request Method: GET

**Request Parameter**

| Field Name | Type   | Description                                                  |
| ---------- | ------ | ------------------------------------------------------------ |
| mcEUI      | string | 16-byte hexadecimal string, multicast group unique identifier |

**Response Parameter**

| Field Name | Type         | Description                   |
| ---------- | ------------ | ----------------------------- |
| code       | int          | response code                 |
| msg        | string       | response message              |
| data       | MCGroupStaus | multicast group status object |

MCGroupStaus:

| Field Name       | Type   | Description                                                         |
| :------------- | :----- | :----------------------------------------------------------- |
| mcEUI          | string | 16-byte hexadecimal string, multicast group unique identifier |
| mcName         | string | multicast group name                                         |
| region         | string | multicast group area                                         |
| subnet         | string | multicast group subnet                                       |
| class          | string | node type supported by the multicast group                   |
| enableMCRemote | bool   | whether to enable multicast auto configuration               |
| groupID        | int    | multicast group ID                                           |
| enableMCExt    | bool   | whether to enable multicast extended function                |
| timeSlotLength | int    | time slice length                                            |
| genAppKey      | string | 32-byte hexadecimal string                                    |
| mcAddr         | string | 8-byte hexadecimal string                                     |
| mcAppSKey      | string | 32-byte hexadecimal string                                    |
| mcNwkSKey      | string | 32-byte hexadecimal string                                    |
| deviceSetup    | int    | number of devices synchronized under the multicast group     |
| deviceNums     | int    | number of devices under the multicast group                  |
| pushURL        | string | push link                                                    |
| enableMQTT     | bool   | whether to enable MQTT                                       |
| updatetime     | int64  | update time in milliseconds                                  |
| createtime     | int64  | create time in milliseconds                                  |

**Sample Data**

Request Response:

```
// Enable multicast auto configuration and enable Extended function
{
	"code": 0,
	"msg": "ok",
	"data": {
		"mcEUI": "6f655b6ffe9c25ca",
		"mcName": "mc_group_01",
		"region": "eu868",
		"subnet": "ch_00-07",
		"class": "C",
		"pingSlotPeriod": 0,
		"enableMCRemote": true,
		"groupID": 3,
		"genAppKey": "c6a1f7c9c9db0f4536be3de8327ef57b",
		"enableMCExt": false,
		"timeSlotLength": 3,
		"mcAddr": "0096ccb5",
		"mcAppSKey": "3c1d2407297e4e5584d06caacdf53c5e",
		"mcNwkSKey": "02dbedc3349b3eeaa1d66f022530a7c2",
		"enableMQTT": false,
		"pushURL": "https://test.example.com/api/iotsquare",
		"headers": {
			"userID": "2333",
			"x-access-token": "6666"
		},
		"deviceSetup": 10,
		"deviceNums": 20,
		"updatetime": 1556617761768,
		"createtime": 1556617761768
	}
}
// Manually configure multicast
{
	"code": 0,
	"msg": "ok",
	"data": {
		"mcEUI": "a0891ce817397ee8",
		"mcName": "mc_group_03",
		"region": "eu868",
		"subnet": "ch_00-07",
		"class": "C",
		"enableMCRemote": false,
		"groupID": 256,
		"mcAddr": "75bacecd",
		"mcAppSKey": "a32da0c03d3ab55e5be1dcc60f777481",
		"mcNwkSKey": "c013d964a16c9ee761cfd295614acf17",
		"deviceSetup": 10,
		"deviceNums": 10,
		"updatetime": 1556618089163,
		"createtime": 1556618082203
	}
}
```

# 7. Multicast Group Node

## 7.1 Introduction

1. IoTSquare currently supports Class C device to join multicast group
2. Device in the same multicast group have the same region and subnet
3. If the multicast group enable the multicast auto-configuration and extended function, the device needs to obtain the configuration parameters from the IoTSquare. If not, the pre-configured parameters are used for multicast communication

## 7.2 Multicast Group Node Interface

### 7.2.1 Multicast Group Node List

URL: https://cloud.iotsquare.xyz/openapi/mcdevice/list

Request Method: GET

**Request Parameter**

| Field Name | Type   | Description                                                  |
| ---------- | ------ | ------------------------------------------------------------ |
| mcEUI      | string | 16-byte hexadecimal string, multicast group unique identifier |
| pageNo     | int    | number of pages                                              |
| pageSize   | int    | paging size                                                  |

Precautions:

+ pageNo defaults from 1 and pageSize defaults to 10
+ when pageNo is equal to 0 and pageSize is equal to 0, all nodes under the multicast group will be returned (restriction returns up to 200)

**Response Parameter**

| Field Name | Type       | Description                                           |
| :--------- | :--------- | :---------------------------------------------------- |
| code       | int        | response code                                         |
| msg        | string     | response message                                      |
| amount     | int        | total number of devices under multicast group         |
| data       | []MCDevice | data body, an array containing multicast group device |

MCDevice:

| Field Name | Type   | Description                                                  |
| :--------- | :----- | :----------------------------------------------------------- |
| devEUI     | string | 16-byte hexadecimal string, multicast group unique identifier |
| devName    | string | device name                                                  |
| joined     | bool   | whether the device has synchronized multicast group configuration |
| createtime | int64  | create time in milliseconds                                  |

Precautions:

+ Joined indicates whether the multicast group configuration has been synchronized
  + If you use manual configuration multicast, the default is true, the user ensures that the key is synchronized, and the default device is synchronized
  + If auto-configuration multicast is used, the default is false, when the device successfully receives the multicast group configuration and the server receives the device response, it is set to true
+ Createtime indicates when the device is added to the multicast group

**Sample Data**

Request Response:

```
{
	"code": 0,
	"msg": "ok",
	"amount": 50,
	"data": [{
		"devEUI": "476a2da3004b0039",
		"devName": "mc_node_00",
		"joined": true,
		"createtime": 1556324372803
	}, {
		"devEUI": "472b253300190039",
		"devName": "mc_node_01",
		"joined": true,
		"createtime": 1556324372848
	}, {
		"devEUI": "47ab2da30027002e",
		"devName": "mc_node_02",
		"joined": true,
		"createtime": 1556324372875
	}]
}
```

### 7.2.2 Multicast Group Node Create

URL: https://cloud.iotsquare.xyz/openapi/mcdevice/create

Request Method: POST

**Request Parameter**

| Field Name | Type     | Description                                         |
| ---------- | -------- | --------------------------------------------------- |
| mcEUI      | string   | 16-byte hexadecimal string, device unique identifier |
| devEUIs    | []string | devEUI array                                        |

Precautions:

+ IoTSquare supports batch addition of multicast group devices
+ If the multicast group enable the auto-configuration and extended function, after adding node, the IoTSquare will attempt to deliver the multicast group configuration information based on the device's uplink history
+ If an error occurs in creating a multicast device, the error message corresponding to each exception devEUI will be included in the data field

**Response Parameter**

| Field Name | Type   | Description      |
| ---------- | ------ | ---------------- |
| code       | int    | response code    |
| msg        | string | response message |

**Sample Data**

Request Parameter:

```
{
	"mcEUI":"a1cf5e687656d815",
	"devEUIs": ["b0cf5e634ec6d815", "55e1032590dc5682", "472b253300190039","476a2da3004b0039", "55e1032590dc5682"]
}
```

Request Response:

```
// Binding success example
{
	"code": 0,
	"msg": "ok"
}
// Binding error, partial node binding failed
{
    "code": 14008,
    "msg": "MCDevice Batch Bind Error",
    "data": [
        {
            "code": 4001,
            "msg": "Device Not Exist",
            "devEUI": "55e1032590dc5682"
        },
        {
            "code": 14010,
            "msg": "MCDevice Already Bind Current Group",
            "devEUI": "472b253300190039"
        },
        {
            "code": 14011,
            "msg": "MCDevice Already Bind Other Group",
            "devEUI": "476a2da3004b0039"
        }
    ]
}
```

### 7.2.3 Multicast Group Node Delete

URL: https://cloud.iotsquare.xyz/openapi/mcdevice/delete

Request Method: POST

**Request Parameter**

| Field Name | Type     | Description                                         |
| ---------- | -------- | --------------------------------------------------- |
| mcEUI      | string   | 16-byte hexadecimal string, device unique identifier |
| devEUIs    | []string | devEUI array                                        |

Precautions:

+ IoTSquare supports batch deletion of multicast group devices
+ When deleting a multicast group device, at the same time, the device and multicast group binding relationship is released.
+ If an error occurs in deleting the multicast device, the error message corresponding to each exception devEUI is included in the data field

**Response Parameter**

| Field Name | Type   | Description      |
| ---------- | ------ | ---------------- |
| code       | int    | response code    |
| msg        | string | response message |

**Sample Data**

Request Parameter:

```
{
	"mcEUI": "a1cf5e687656d815",
	"devEUIs": ["b0cf5e634ec6d815", "55e1032590dc5682", "0f475d71f5cd2f20", "84955e634ec6d815"]
}
```

Request Response:

```
// Successful unbinding example
{
	"code": 0,
	"msg": "ok"
}
// Unbind error, partial unbind failed
{
    "code": 14009,
    "msg": "MCDevice Batch Unbind Error",
    "data": [
        {
            "code": 14013,
            "msg": "MCDevice Not Exist",
            "devEUI": "476a2da3004b0039"
        },
        {
            "code": 14013,
            "msg": "MCDevice Not Exist",
            "devEUI": "55e1032590dc5682"
        }
    ]
}
```

# 8. Multicast Group Downlink

## 8.1 Introduction

1. IoTSquare uses the first-in first-out queue to store the application layer data downlink of the multicast group, and each multicast group corresponds to one downlink queue
2. Since the multicast group uses Class B or Class C in the downlink, the lorawan protocol fixes the data rate, the user needs to take Class B or Class C parameters of the corresponding frequency region of the device to calculate the maximum data length that can be delivered
3. If the user enables the multicast extended protocol, IoTSquare will take over the downlink scheduling, the downlink of the multicast group sent by one user may be delivered corresponding to multiple actual data, IoTSquare will ensure that as many intra-group devices receive multicast downlink data
4. If the user doesn't enable the multicast extended protocol, the IoTSquare will transparently transmit the user's multicast group downlink, and no task scheduling will be performed, the user needs to implement the confirmation reply of the multicast group downlink at the application layer

## 8.2 Multicast Group Downlink Interface

### 8.2.1 Multicast Group Downlink Create

URL: https://cloud.iotsquare.xyz/openapi/mcdownlink/create

Request Method: POST

**Request Parameter**

| Field Name | Type   | Description                                                  |
| ---------- | ------ | ------------------------------------------------------------ |
| mcEUI      | string | 16-byte hexadecimal string, multicast group unique identifier |
| fPort      | int    | node communication port                                      |
| data       | string | base64 encoded data string                                   |

Precautions:

+ The value of fPort is 1~199, 201~223, and the remaining ports are reserved for the lorawan protocol
+ Data is a base64 encoded numeric string, IoTSquare will decode the value in base64 and then framing it in binary format and then sending it to the node
  + If the original data is hexadecimal data, for example, 0x2333, the length is two bytes, and the base64 encoded data is "IzM="
  + If the original data is an ASCII string, such as "2333", the length is four bytes, and the base64 encoded data is "MjMzMw=="

**Response Parameter**

| Field Name | Type   | Description                                                  |
| ---------- | ------ | ------------------------------------------------------------ |
| code       | int    | response code                                                |
| msg        | string | response message                                             |
| fCnt       | int    | this data is delivered to the corresponding multicast group downlink frame counter |

Precautions:

+ Each multicast group maintains a downlink frame counter, and calls the fCnt returned by the data downlink interface to deliver the corresponding downlink frame counter number for this data downlink

**Sample Data**

Request Parameter:

```
// The original data is hexadecimal 0x2333 and the length is two bytes
{
	"mcEUI": "b0cf5e634ec6d815",
	"fPort": 8,
	"data": "IzM="
}
// The original data is the ASCII string "2333" and the length is four bytes
{
	"mcEUI": "b0cf5e634ec6d815",
	"fPort": 8,
	"data": "MjMzMw=="
}
```

Request Response:

```
{
	"code": 0,
	"msg": "ok",
	"fCnt": 6666
}
```

## 9. Multicast file transfer

### 9.1 Create file transfer

**URL：**`https://cloud.iotsquare.xyz/openapi/fuota/create`

Request Method: POST

**Request Parameter：**

| Field Name |Type|Description|
|:---|:---|:---|
|mcEUI|string| 16-byte hexadecimal string, multicast group unique identifier|
|firmwareName|string| file data name |
|redundancyPercent|float64|redundancy rate|
|payload|string| base64 encoded data string     |

Precautions:

+ redundancyPercent Value range is 0.1-1 

+ payload is a base64 encoded numeric string, IoTSquare will decode the value in base64 and then framing it in binary format and then sending it to the node
  + If the original data is hexadecimal data, for example, 0x2333, the length is two bytes, and the base64 encoded data is "IzM="
  + If the original data is an ASCII string, such as "2333", the length is four bytes, and the base64 encoded data is "MjMzMw=="


**Response Parameter：**

| Field Name |Type|Description|
|:---|:---|:---|
|code|int| response code|
|msg|string|response message|

**Sample Data：**

**Request Parameter：**
```json
//  The original data is hexadecimal 0x2333 and the length is two bytes
{
    "mcEUI":"cc3e92cea33ac62a",
    "firmwareName":"test",
    "payload":"IzM=",
    "redundancyPercent":0.3
}
// The original data is the ASCII string "2333" and the length is four bytes
{
    "mcEUI":"cc3e92cea33ac62a",
    "firmwareName":"test",
    "payload":"MjMzMw==",
    "redundancyPercent":0.3,
}
```

**Request Response：**

```json
{
	"code": 0,
	"msg": "ok"
}
```


### 9.2 File transfer task list

**URL：**`https://cloud.iotsquare.xyz/openapi/fuota/list`

Request Method: GET

**Request Parameter：**

| Field Name |Type|Description|
|:---|:---|:---|
|mcEUI|string| 16-byte hexadecimal string, multicast group unique identifier|
|pageNo|int| number of pages|
|pageSize|int| paging size|


**Response Parameter：**

| Field Name |Type|Description|
|:---|:---|:---|
|code|int| response code|
|msg|string|response message|
|amount|int|Total number of transfer tasks|
|data|[]FuotaDeploymentSummary|The body of the data, which contains an array of File Data transfer tasks|

**FuotaDeploymentSummary：**

| Field Name |Type|Description|
|:---|:---|:---|
|fdID|int|file dataID|
|firmwareName|string|file data Transfer task name|
|payloadSize|int|file data size|
|createtime|int| create time in milliseconds|
|updatetime|int|update time in milliseconds|
|state|string|status：Created;SendFragSessSetup;EnqueueFragment;SendFragSessStatus;SendFragSessDel;Cleanup;Done;Unknown|
|nextStepTime|int|The next phase starts the task in milliseconds|

**Sample Data：**

**Request Response：**

```json
{
"code":0,
"msg":"ok",
"amount":2,
"data":[{"fdID":16,
"firmwareName":"test_2",
"payloadSize":13737,
"createtime":1608886853707,
"updatetime":1608886880433,
"state":"EnqueueFragment",
"nextStepTime":1608889984433},
{"fdID":14,
"firmwareName":"test_1",
"payloadSize":13737,
"createtime":1608877117472,
"updatetime":1608880297634,
"state":"Done",
"nextStepTime":-1}]
}
```

### 9.3 File transfer task status

**URL：**`https://cloud.iotsquare.xyz/openapi/fuota/status`

Request Method: GET

**Request Parameter：**

| Field Name |Type|Description|
|:---|:---|:---|
|mcEUI|string| 16-byte hexadecimal string, multicast group unique identifier|
|fdID|int| file dataID|


**Response Parameter：**

| Field Name |Type|Description|
|:---|:---|:---|
|code|int| response code|
|msg|string|response message|
|data|FuotaDeploymentStatus|The data body, which contains the data for the File Data transfer task|

**FuotaDeploymentStatus：**

| Field Name |Type|Description|
|:---|:---|:---|
|fdID|int|file data ID|
|firmwareName|string|file data Transfer task name|
|payloadSize|int|file data size|
|createtime|int| create time in milliseconds|
|updatetime|int|update time in milliseconds|
|state|string|状态：Created;SendFragSessSetup;EnqueueFragment;SendFragSessStatus;SendFragSessDel;Cleanup;Done;Unknown|
|nextStepTime|int|The next phase starts the task in milliseconds|
|fragSize|int|Fragmentation size|
|padding|int|Number of filled bytes|
|redundancy|int|Number of redundant slices|
|descriptor|string|describe |
|nbFrag|int|Subdivision number|

**Sample Data：**

**Request Response：**

```json
{"code":0,
"msg":"ok",
"data":{"fdID":16,
"firmwareName":"test_1",
"nbFrag":287,
"fragSize":48,
"padding":39,
"redundancy":86,
"payloadSize":13737,
"descriptor":"VXTy8g==",
"createtime":1608886853707,
"updatetime":1608886880433,
"state":"EnqueueFragment",
"nextStepTime":1608889984433}
}
```

### 9.4 File transfer task device list

**URL：**`https://cloud.iotsquare.xyz/openapi/fuota/device/list`

Request Method: GET

**Request Parameter：**

| Field Name |Type|Description|
|:---|:---|:---|
|mcEUI|string| 16-byte hexadecimal string, multicast group unique identifier|
|fdID|int| file dataID|
|pageNo|int| number of pages|
|pageSize|int| paging size|

**Response Parameter：**

| Field Name |Type|Description|
|:---|:---|:---|
|code|int| response code|
|msg|string|response message|
|amount|int|Total number of transfer task devices|
|data|[]FuotaDeploymentDevice|Body of data, contained  file data Transfer an array of task devices|

**FuotaDeploymentDevice：**

| Field Name |Type|Description|
|:---|:---|:---|
|devEUI|string|16-byte hexadecimal string, device unique identifier|
|fdID|int|file data ID|
|nbFragReceived|string|The total number of slices received by the device|
|nbFragMissing|int|Total number of devices missing sharding|
|createtime|int| create time in milliseconds|
|updatetime|int|update time in milliseconds|
|state|string|status：MC Not Joined;MC Joined;FragSessionSetupAns;FragSessStatusAns;FragSessDelAns;Done;Unknown|
|error_message|int|Error message prompt|

**Sample Data：**

**Request Response：**

```json
{"code":0,
"msg":"ok",
"amount":1,
"data":[{"devEUI":"8cf9573000000067",
"fdID":16,
"nbFragReceived":0,
"nbFragMissing":0,
"createtime":1608886853721,
"updatetime":1608886853721,
"state":"MC Not Joined",
"error_message":""}]
}
```

### 9.5 Terminate file transfer upgrade task

**URL：**`https://cloud.iotsquare.xyz/openapi/fuota/abort`

Request Method: POST

**Request Parameter：**

| Field Name |Type|Description|
|:---|:---|:---|
|mcEUI|string| 16-byte hexadecimal string, multicast group unique identifier|
|fdID|int| file dataID|

**Response Parameter：**

| Field Name |Type|Description|
|:---|:---|:---|
|code|int| response code|
|msg|string|response message|

**Sample Data：**

**Request Response：**

```json
{
"code":0,
"msg":"ok"
}
```

# 10. Appendix

## 10.1 Response Code

### System

```
	0:    "ok",
	1001: "System Busy",

	1003: "No Token, Please log in again",
	1004: "Invalid Token, Please log in again",

	1006: "Empty Param",
	1007: "Param Error",
	1008: "Query Error",
	1009: "Network Busy",
	1010: "Permission Denied",

	1011: "Region Subnet Not Exist",
	1012: "Region Subnet Already Exist",

	1013: "Extend Proto Not Exist",
	1014: "Extend Proto Already Exist",
	1015: "Platform Conf Not Exist",
	1016: "Extend Proto Already Associate App",
	1017: "Region Subnet Not Support",
	1018: "Region Subnet Already Sync",
```

### User

```
	2001: "Invalid Account",
	2002: "Account Not Exist",
	2003: "Account Already Exist",
	2004: "Account or Passwd Error",
```

### Application

```
	3001: "Application Not Exist",
	3002: "Application Already Exist",
	3003: "Application Batch Delete Error",
```

### Device

```
	4001: "Device Not Exist",
	4002: "Device Already Exist",
	4003: "Device Update Error",
	4004: "Device Duplicate DevAddr And NwkSKey",
	4005: "Device Count Exceeds Limit",
	4006: "Device Batch Delete Error",
```

### Gateway

```
	5001: "Gateway Not Exist",
	5002: "Gateway Already Exist",
	5003: "GatewayID Already Exist",
	5004: "GatewayName Already Exist",
	5005: "Gateway Count Exceeds Limit",
	5006: "Gateway Batch Delete Error",
```

### Multicast Group

```
	14001: "MCGroup Not Exist",
	14002: "MCGroup Already Exist",
	14003: "MCGroup Duplicate DevAddr And NwkSKey",
	14004: "MCGroup Device Count Exceeds Limit",
	14005: "MCGroup Name Already Exist",
	14006: "MCGroup GenAppKey Error",
	14007: "MCGroup Batch Delete Error",
	14008: "MCDevice Batch Bind Error",
	14009: "MCDevice Batch Unbind Error",
	14010: "MCDevice Already Bind Current Group",
	14011: "MCDevice Already Bind Other Group",
	14012: "MCDevice Incompatible With Group",
	14013: "MCDevice Not Exist",
	14014: "MCGroup Not Enable MCRemote",
	14015: "MCGateway Batch Bind Error",
	14016: "MCGateway Batch Unbind Error",
	14017: "MCGateway Already Bind Current Group",
	14018: "MCGateway Incompatible With Group",
	14019: "MCGateway Not Exist",
	14020: "MCDownlink Already Exist",
	14021: "MCDownlink Not Exist",
	14022: "MCGroup Create Error",
	14023: "MCGroup invalid create",
```

### Multicast file transfer
```
16001: "Fuota Deployment Already Exist"
```
