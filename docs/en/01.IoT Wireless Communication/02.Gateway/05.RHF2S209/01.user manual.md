---
title: user manual
date: 2023-02-08 10:10:10
permalink: /01/02/05/01/
---
# RHF2S209 User Manual

## 1 preface

RHF2S209 is independently developed and designed by Ruixing Hengfang Network (Shenzhen) Co., Ltd. It is an IoT LoRaWAN gateway that meets the requirements of the carrier. The gateway integrates LoRa, GPS, Ethernet, LTE, WiFi and backup lithium battery (optional).

## 2 Get to know about your gateway

The RisingHF RHF2S209 LoRaWAN gateway integrates a high-performance and high-reliability core ARM cortex A7, and is equipped with a SX1302 LoRa core processing chip, a GPS module, an Ethernet network port, an LTE module, and a WiFi Module, temperature sensor, RTC, backup lithium battery (optional) and stable and reliable power management unit. RHF2S209 is divided into RHF2S209Exx and RHF2S209Bxx series according to different functional component configurations. Among them, RHF2S209Exx is a series without backup power, and RHF2S209Bxx is a series with a built-in 3200mAh battery. RHF2S209Bxx series gateways support 8hr standby. In addition to logging into the gateway’s built-in Linux system and using commands to operate the gateway, users can also use the built-in web control interface to operate the device more intuitively and conveniently.

The gateway has a total of 4 antenna ports, 1 external power access port, and 1 RJ45 port.

- ANT1: LoRa antenna port.
- ANT2: GPS antenna port.
- ANT3: LTE antenna port.
- ANT4: WiFi antenna port.
- Power: External power input interface, the power input range is DC12V to 28V.
- RJ45: RJ45 network port.

### 2.1 Establish gateway connection

Connect the gateway as shown in the figure below.

![image-20230220171755868](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/548c9458f6dce64d712b29864702d1f0.png)

### 2.2 power supply

RHF2S209 uses the standard AC/DC industrial power supply for power supply. RHF2S209 is equipped with a high-reliability industrial-grade IP67 waterproof AC/DC power supply. In addition, for RHF2S209Bxx series gateways, a 3200mAh lithium iron phosphate rechargeable battery is built in as a backup power supply. All power sources can be connected to the device, and the device itself can intelligently select the working power source according to the priority order of AC/DC industrial power supply > backup battery.

### 2.3 backhaul network

RHF2S209 supports multiple backhaul network methods, such as LTE, Ethernet and WiFi.

LTE: Please open the upper cover of the device, insert the SIM card, and then power on and start the system again.

Ethernet: Use a network cable to connect the RJ45 port of the gateway to the LAN port of the router at the upper level to realize 10/100m Ethernet connection to the server.

WiFi: Open the built-in web interface, select [Network] -> [WiFi Station] menu, and enter the correct WiFi name and password through [WiFi Station Setting] to connect to the upper-level router. **Note: The stability of WiFi network backhaul cannot be guaranteed. It is recommended not to use WiFi backhaul in the production environment. **

You can log in to the built-in web interface to configure the priority of the backhaul network.

### 2.4 debug interface

RHF2S209 provides various debugging interfaces.

- web interface

- Serial debugging
- SSH login

This document mainly introduces the debugging interface used by the web interface.

## 3 Built-in web interface

Use the built-in web configuration interface to configure and manage the gateway quickly and easily.

### 3.1 get ip

- Open web interface via LAN

Connect the device to the LAN through a network cable, and use the DHCP service of the upper-level router to query the IP address of the device in the LAN. After obtaining the IP address of the device, open the IP through a browser to enter the built-in web interface of the device.

- Open the web interface via WiFi

Scan the WiFi signal on the computer, find the device whose SSID is RHF2S209_XXXXXX and connect it. After the computer is connected to the device, the default IP is 192.168.8.1. After getting the IP address of the device, open 192.168.8.1 through the browser to enter the built-in web interface of the device. WiFi default SSID and password:

SSID: RHF2S209_XXXXXX

password: RisingHF_XXXXXX

Note: "XXXXXX" ends with the last 3 bytes of the device's MAC address, and if there are letters, use uppercase letters.

### 3.2 login page

#### 3.2.1 Log in

Enter the IP of the device in the browser to open the built-in web interface, and only need to enter the password to log in.

Default password: risinghf

![image-20230228162847366](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/f74ff0f7e7218e01a22fb3ef1d971c87.png)

#### 3.2.2 change Password

Enter the original password, then enter the new password and confirm the new password to change to the new password. Next time you log in, you need to log in with the new password.

![image-20230228162918196](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/83b40abebef8e0aba10c271a7a4f81e2.png)

### 3.3 Device

#### 3.3.1 Device Information

Device information displays the basic information of the device, such as device model, system time, MAC, version number and other information.

#### 3.3.2 Hardware information

The hardware information displays the current status of the key hardware of the device, and the user can quickly confirm the hardware status of the device through this column.

- External Power: When the external power supply is not connected, it will prompt "Not connected"; when the external power supply is connected, it will prompt "Connected".
- Battery: For RHF2S209Exx series devices, the display does not support. For the RHF2S209Bxx series devices, when the lithium battery is connected, the battery power percentage is displayed; when the lithium battery is not connected, it prompts "Exception".
- Ethernet: When the network cable is not connected, it will prompt "Not connected"; when the network cable is connected, it will prompt "Connected network cable".
- LTE: When the dial-up is not successful, it will prompt "Not used"; when the dial-up is successful, it will prompt the signal quality of the current network.
- GPS: Whether the GPS module is recognized normally.
- WiFi: Whether the WiFi module is recognized normally.
- Temperature: Display the current temperature inside the device box.
- LoRa0: When the LoRa related service is not started, it will prompt "Not used"; when the LoRa related service is started, it will prompt "Normal".

![image-20230209150442863](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/6ad1aa6fc0a5c70c4785d198d1840ec5.png)

### 3.4 Server

Server configuration is a LoRa-related service, including environmental noise scanning and configuration of connecting to servers of various manufacturers. **Note: LoRa service can only start one service at a time. If the user has started one of the services and starts another server, the device will shut down the original service and start the new service. **

#### 3.4.1  Ambient Noise Scan

The device has a built-in noise floor analysis engine, which can help users scan and analyze the environmental floor noise on site, and customers can find interference signals and noises in advance when deploying on site. In order to realize network optimization and avoid channel frequencies with strong interference.

The noise floor scanning function is very easy to operate, just fill in the start frequency point and stop frequency point, and then click "Start Scan". If you only input the start frequency, the default sweep bandwidth is 2MHz, and the default step is 200kHz. The wider the bandwidth of the scan, the longer it will take. It is generally recommended to scan only 2MHz or 5MHz to cover the target working frequency band. **Note: Due to hardware reasons, RHF2S209xxx-470 series can only scan 470~490Mhz, RHF2S209xxx-868 series can only scan 862~876Mhz, RHF2S209xxx-915 series can only scan 902~928Mhz. **

![image-20230209154219507](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/eb4e29d5d27a33119b96dc0969244813.png)

When the noise floor scan is completed, the configuration interface will display the scan results in two forms: the thermal distribution map of the noise floor shows the transient noise distribution, and the average noise distribution map shows the average noise level obtained during the scan for this frequency point.

![image-20230209154247673](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/6b9627bef9f6381798397cb0cba2a8a5.png)

![image-20230209154310637](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/8e21c5ba37e8c387798a4b1343defe6a.png)

Environmental noise floor is an important index parameter affecting wireless communication. If you need to erect and install the gateway on site, be sure to do a preliminary analysis of the environmental noise on site, so as not to affect the communication distance and reliability due to high noise or strong interference. We hope that the environmental noise is as low as possible, but the real environment cannot be completely free of interference or noise. It is generally recommended that the ambient noise floor is around -110dBm, which is ideal. Usually the maximum noise is allowed not to exceed -100dBm, otherwise the communication distance will be severely limited. If the noise is above -95dBm, it is strongly recommended to change the working frequency band to avoid interference noise.

#### 3.4.2 Packet Forwarder Link

Supports the standard Packet Forwarder to use dup to connect to the server. Generally, servers that conform to the LoRaWAN standard support this method of connection.

Running Status: The service is not started by default, and it prompts "Not running". When the user clicks to start, it prompts "Running", and the LoRa module also starts to work at this time.

Gateway ID: Fill in the gateway ID (note that different servers use different gateway ID naming rules). RHF2S209 defaults to inserting FFFE into the middle of the Ethernet MAC address as the gateway ID, and users can modify it according to their needs.

Server Address: Fill in the target server address.

Uplink Port: The uplink port number of the target server.

Downlink Port: The downlink port number of the target server.

Frequency Config: Select a frequency profile supported by the gateway. Users specify the corresponding frequency plan according to their needs.

Start/Reboot: Start the LoRa service. If the device starts other LoRa-related services, the system will shut down other LoRa services and start this service.

Close: close the LoRa service.

![image-20230209155604215](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/f4ba1b63139767fe6ab2c2e3de1a6cdc.png)

#### 3.4.3 IoTSquare

IoTSquare ([https://cloud.iotsquare.xyz](https://cloud.iotsquare.xyz/)) is a program for connecting to IoTSquare server. It mainly consists of two parts, one is bridge and the other is Packet Forwarder.

The bridge is the core program used to connect to the IoTSquare server, and the Packet Forwarder is used to send and receive LoRaWAN data. When the Packet Forwarder is not started, it is only used for the server to remotely manage the device. When the Packet Forwarder is started, it can be used for remote management of the device by the server and for receiving LoRaWAN data. The device only starts bridge by default. IoTSquare does not need to be used to configure the frequency plan on the gateway. Users can select the corresponding frequency plan when registering the gateway on the IoTSquare server, and then start the Packet Forwarder component.

![image-20230209161004622](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/13c24de683d4f71808a2d61017b08ecf.png)

Bridge Running Status: The service is started by default, and it prompts "Running". At this time, you only need to register with the server to remotely manage the device. If you do not want the server to manage the device, the user can close it, and it will prompt "Not running".

Gateway ID: Fill in the gateway ID. By default, IoTSquare uses the Ethernet MAC address with FFFE inserted in the middle as the gateway ID, and users can modify it according to their own needs.

MQTT Server Address: fill in the target server MQTT address and port number.

HTTP Server Address: fill in the target server HTTP address and port number.

Start/Reboot: start bridge

Close: close the bridge, if the Packet Forwarder is also started, it will be closed together with the Packet Forwarder.

![image-20230209161442466](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/a575b343bf8cbd35c7db81441e63a3b6.png)

Rhf Pktfwd Running Status: the service is not started by default, prompting "Closed". When the user clicks to start, it prompts "Start", at this time the LoRa module also starts to work.

Start: Start the LoRa service, if the bridge is closed, start it together with the bridge. If the device starts other LoRa-related services, the system will shut down other LoRa services and start this service.

Closed: close the LoRa service.

![image-20230209162810097](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/6d3455a360310dce3546df4f89a5698c.png)

#### 3.4.4 LoraServer

It is used to connect to the open source LoraServer. This LoRa service requires users to upload their own configuration files to the /opt/loraserver directory to replace the lora-gateway-bridge.toml configuration file.

Running status: The service is not started by default, and it prompts "Not running". When the user clicks to start, it prompts "Running", and the LoRa module also starts to work at this time.

Gateway ID: Fill in the gateway ID (note that different servers use different gateway ID naming rules). RHF2S209 defaults to inserting FFFE into the middle of the Ethernet MAC address as the gateway ID, and users can modify it according to their own needs.

Server Address: The default is 127.0.0.1.

Uplink Port: 1700 by default.

Downlink Port: 1700 by default.

Frequency Config: Select a frequency profile supported by the gateway. Users specify the corresponding frequency plan according to their needs.

Start/Reboot: Start the LoRa service. If the device starts other LoRa-related services, the system will shut down other LoRa services and start this service.

Close: close the LoRa service.

### 3.5 Network

#### 3.5.1 WiFi

This is mainly for the network configuration of the WiFi of the gateway device. Users can modify the default ip address, SSID username, password and hide SSID.

![image-20230209172202516](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/20103a7c3118ad54c9c44d02e949efda.png)

#### 3.5.2 WiFi Station

The device provides WiFi Station mode, which is used to wirelessly connect to the upper-level router. The user scans or fills in the WiFi name and password of the upper-level router to connect to the upper-level router to access the Internet.

![image-20230209172245718](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/01f2a7e2d4a9339b431ec5c5a0bc1ed4.png)

#### 3.5.3 IP Config

When the device is connected to the network cable, it obtains the IP address dynamically assigned by the upper-level router through DHCP by default. If the user needs to set a static IP, then select "Protocol" as "Static IP", and then fill in "IP Address", "Default Gateway" and "DNS".

![image-20230209173801027](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/5843e8e95e37f7c9d9ec19da364e6e2d.png)

#### 3.5.4 LTE

Detailed status of 4G modules. When the dial is successful, the status of the dialing system and cell information will be displayed.

![image-20230209181212950](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/a143a33e75e9aaf8d4dd984bce42169f.png)

Configure the LTE dial-up service.

Automatically select network: the system starts by default. When dialing, it will automatically identify the operator's network dialing; if the dialing is unstable, the user can turn off the option of automatically selecting the network, then the system will dial from high to low according to the signal quality of the operator's network.

Dial-up Service: Enabled by default. When the close button is clicked, the dial-up service will be closed.

![image-20230209181223145](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/3641129a25337ff4e843bab4cb9c4e38.png)

#### 3.5.5 APN Config

This page is used to query, add and delete the APN of the gateway LTE dial-up. If the sim card used by the user cannot dial-up normally, you can use this page to query or add the APN corresponding to the sim card.

![image-20230209173945862](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/22fc8e16656e0d81f509327e3739c480.png)

#### 3.5.6 RSSH

This page is the port number for remote debugging of the management gateway. When the user gateway needs remote assistance, the RSSH function can be enabled, and the port number can be sent to the technical support of the company to log in to the gateway remotely. Remember to close RSSH after debugging. After all, enabling the remote debugging function will increase security risks.

![image-20230209174017108](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/0dc9b2860a018f64958a29790707d88a.png)

#### 3.5.7 Ping

This page is used to check whether the device can access the Internet normally, and to test whether the gateway can directly connect to the gw.risinghf.com server. Users can customize their own server addresses.

![image-20230209174129966](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/7e05d0436a9691f48e49d358d10c7e7c.png)

#### 3.5.8 Traceroute

This page is used to check whether the device can access the Internet normally, and to test the route through which the gateway connects to gw.risinghf.com. Users can customize their own server addresses.

![image-20230209174307878](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/0287e6979ba61ab79cf0d4312823cb12.png)

#### 3.5.9 Host

This page is used to detect whether the device can access the Internet normally, and to test the DNS server used by the gateway. Users can customize their own server address.

![image-20230209174338385](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/777e454834d9a0fca35aea4fc3af6e74.png)

### 3.6 System

#### 3.6.1 Time Zone

The system uses the UTC timezone by default, which may have a time difference with the user. Users can select the corresponding local timezone on this page.

![image-20230209183046332](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/3cc7cb6061d718c7538fa12e37a0520a.png)

#### 3.6.2 NTP

Set NTP server, users manage their own NTP server on this page. There can only be up to 5 NTP servers at the same time.

![image-20230209183139558](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/fd579c9da5704d447214dbf5d878babb.png)

### 3.7 LOG

On the log download page, users can view and download various logs related to the operation of the gateway.

#### 3.7.1 System Log

The system log records the log of the operation of the gateway kernel, including the status information of the kernel operation, and the user can use it to analyze the operation status of the gateway system.

![image-20230209175342668](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/d230699376c0478b8fc0a737bde6974d.png)

#### 3.7.2 LTE Log

/var/rlog/lte.log, record all logs of LTE dialup.

##### 3.7.2.1 Example of successful dialing

When the log prompts "dial success", it means the dialing is successful.

```
[2020-09-20 10:44:17+00:00]->[ltestart: start dial]
[2023-02-13 10:42:00+00:00]->[ltestart: OK, SIM inserted]
[2023-02-13 10:42:00+00:00]->[ltestart: OK, 89860619050022383540]
[2023-02-13 10:42:00+00:00]->[automatically operators mode]
[2023-02-13 10:42:01+00:00]->[ltestart: APN information: �联�通�物�联�网 (China Unicom) IoT,460,06,unim2m.bjm2mapn,,] // Dial APN Details
timeout set to 15 seconds
abort on (DELAYED)
abort on (BUSY)
abort on (ERROR)
abort on (NO DIALTONE)
abort on (NO CARRIER)
send (AT^M)
expect (OK)
AT^M^M
OK
 -- got it

send (AT+CREG?^M)
expect (OK)
^M
AT+CREG?^M^M
+CREG: 0,1^M
^M
OK
 -- got it

send (AT+COPS?^M)
expect (OK)
^M
AT+COPS?^M^M
+COPS: 0,0,"CHN-UNICOM",7^M
^M
OK
 -- got it

send (AT+CGDCONT=1,"IP","unim2m.bjm2mapn"^M) // unim2m.bjm2mapn is dial-up APN
expect (OK)
^M
AT+CGDCONT=1,"IP","unim2m.bjm2mapn"^M^M
OK
 -- got it

send (ATD*99#^M)
expect (CONNECT)
^M
ATD*99#^M^M
CONNECT
 -- got it

send (^M)
Serial connection established.
Using interface ppp0
Connect: ppp0 <--> /dev/ltemodem
Could not determine remote IP address: defaulting to 10.64.64.64
not replacing default route to eth0 [192.168.0.1]
local  IP address 10.212.96.167 // Obtaining the operator's IP means that the dial-up is successful, and the IP is not fixed
remote IP address 10.64.64.64
primary   DNS address 210.22.70.3
secondary DNS address 210.22.84.3
[2023-02-13 10:42:07+00:00]->[ltestart: dial success] // Prompt that dialing is successful
[2023-02-13 10:42:08+00:00]->[ltestart: CHN-UNICOM's 7 rssi is -57] // The signal quality of the current network
```

##### 3.7.2.2 Dial without sim card

```
[2023-02-16 08:36:19+00:00]->[ltestart: start dial]
[2023-02-16 08:37:20+00:00]->[ltestart: start dial]
[2023-02-16 08:38:20+00:00]->[ltestart: start dial]
[2023-02-16 08:39:21+00:00]->[ltestart: start dial]
[2023-02-16 08:40:21+00:00]->[ltestart: start dial] // Periodic round robin start dialing
```

##### 3.7.2.3 APN not found

```
[2023-02-16 09:17:29+00:00]->[ltestart: start dial]
[2023-02-16 09:17:30+00:00]->[ltestart: OK, SIM inserted]
[2023-02-16 09:17:30+00:00]->[ltestart: OK, 89860619050022383540]
[2023-02-16 09:17:30+00:00]->[automatically operators mode]
[2023-02-16 09:17:31+00:00]->[ltestart: NG, unsupport 2 bits mnc sim card, 460, 06] // APN not found
[2023-02-16 09:17:31+00:00]->[ltestart: NG, unsupport 3 bits mnc sim card, 460, 061] 
```

##### 3.7.2.4 There is no fee for the sim card/the wrong APN is used/the location of the device has no operator network/the sim card has a binding function

```
[2023-02-16 08:58:41+00:00]->[ltestart: start dial]
[2023-02-16 08:58:43+00:00]->[ltestart: OK, SIM inserted]
[2023-02-16 08:58:44+00:00]->[ltestart: OK, 89860619050022383540]
[2023-02-16 08:58:44+00:00]->[automatically operators mode]
[2023-02-16 08:58:45+00:00]->[ltestart: APN information: �联�通�物�联�网 (China Unicom) IoT,460,06,unim2m.bjm2mapn,,]
timeout set to 15 seconds
abort on (DELAYED)
abort on (BUSY)
abort on (ERROR)
abort on (NO DIALTONE)
abort on (NO CARRIER)
send (AT^M)
expect (OK)
AT^M^M
OK
 -- got it

send (AT+CREG?^M)
expect (OK)
^M
AT+CREG?^M^M
+CREG: 0,1^M
^M
OK
 -- got it

send (AT+COPS?^M)
expect (OK)
^M
AT+COPS?^M^M
+COPS: 0^M
^M
OK
 -- got it

send (AT+CGDCONT=1,"IP","unim2m.bjm2mapn"^M)
expect (OK)
^M
AT+CGDCONT=1,"IP","unim2m.bjm2mapn"^M^M
OK
 -- got it

send (ATD*99#^M)
expect (CONNECT)
^M
ATD*99#^M^M
CONNECT
 -- got it

send (^M)
Serial connection established.
Using interface ppp0
Connect: ppp0 <--> /dev/ltemodem
Modem hangup
Connection terminated. // The first dial-up failed
[2023-02-16 08:58:50+00:00]->[ltestart: modem hangup]
[2023-02-16 08:58:51+00:00]->[ltestart: Retry [0] pppd return 16]
timeout set to 15 seconds
abort on (DELAYED)
abort on (BUSY)
abort on (ERROR)
abort on (NO DIALTONE)
abort on (NO CARRIER)
send (AT^M)
expect (OK)
AT^M^M
OK
 -- got it

send (AT+CREG?^M)
expect (OK)
^M
AT+CREG?^M^M
+CREG: 0,1^M
^M
OK
 -- got it

send (AT+COPS?^M)
expect (OK)
^M
AT+COPS?^M^M
+COPS: 0^M
^M
OK
 -- got it

send (AT+CGDCONT=1,"IP","unim2m.bjm2mapn"^M)
expect (OK)
^M
AT+CGDCONT=1,"IP","unim2m.bjm2mapn"^M^M
OK
 -- got it

send (ATD*99#^M)
expect (CONNECT)
^M
ATD*99#^M^M
CONNECT
 -- got it

send (^M)
Serial connection established.
Using interface ppp0
Connect: ppp0 <--> /dev/ltemodem
Modem hangup
Connection terminated. // The second dial-up failed
[2023-02-16 08:58:56+00:00]->[ltestart: modem hangup]
[2023-02-16 08:58:56+00:00]->[ltestart: Retry [1] pppd return 16]
timeout set to 15 seconds
abort on (DELAYED)
abort on (BUSY)
abort on (ERROR)
abort on (NO DIALTONE)
abort on (NO CARRIER)
send (AT^M)
expect (OK)
AT^M^M
OK
 -- got it

send (AT+CREG?^M)
expect (OK)
^M
AT+CREG?^M^M
+CREG: 0,1^M
^M
OK
 -- got it

send (AT+COPS?^M)
expect (OK)
^M
AT+COPS?^M^M
+COPS: 0^M
^M
OK
 -- got it

send (AT+CGDCONT=1,"IP","unim2m.bjm2mapn"^M)
expect (OK)
^M
AT+CGDCONT=1,"IP","unim2m.bjm2mapn"^M^M
OK
 -- got it

send (ATD*99#^M)
expect (CONNECT)
^M
ATD*99#^M^M
CONNECT
 -- got it

send (^M)
Serial connection established.
Using interface ppp0
Connect: ppp0 <--> /dev/ltemodem
Modem hangup
Connection terminated.  // The third dial-up failed
[2023-02-16 08:59:00+00:00]->[ltestart: modem hangup]
[2023-02-16 08:59:00+00:00]->[ltestart: Retry [2] pppd return 16]
[2023-02-16 08:59:00+00:00]->[ltestart: APN dial failure] // Each APN has three dial-up opportunities, and the next APN will be selected after three failures
```

##### 3.7.2.5 Signal quality

When the dial-up is successful, record the signal quality of the current network every 15 minutes.

```
[2023-02-16 05:24:28+00:00]->[ltestart: dial success]
[2023-02-16 05:24:28+00:00]->[ltestart: CHN-UNICOM's 7 rssi is -53]
[2023-02-16 05:39:29+00:00]->[ltestart: CHN-UNICOM's 7 rssi is -53]
[2023-02-16 05:54:29+00:00]->[ltestart: CHN-UNICOM's 7 rssi is -53]
[2023-02-16 06:09:29+00:00]->[ltestart: CHN-UNICOM's 7 rssi is -53]
[2023-02-16 06:24:29+00:00]->[ltestart: CHN-UNICOM's 7 rssi is -53]
[2023-02-16 06:39:29+00:00]->[ltestart: CHN-UNICOM's 7 rssi is -53]
[2023-02-16 06:54:29+00:00]->[ltestart: CHN-UNICOM's 7 rssi is -53]
[2023-02-16 07:09:29+00:00]->[ltestart: CHN-UNICOM's 7 rssi is -53]
[2023-02-16 07:24:30+00:00]->[ltestart: CHN-UNICOM's 7 rssi is -53]
[2023-02-16 07:39:30+00:00]->[ltestart: CHN-UNICOM's 7 rssi is -53] // The current network signal quality is -53dbm
```

#### 3.7.3 ETH Log

When the network status of the three network components of Ethernet, 4G and WiFi changes, the system will generate a line of logs to record the network status of the three components at that time.

![image-20230209175416816](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/60f7e5b05570279f1b1be180547dba67.png)

#### 3.7.4 Runtime Log

Record the boot time of the device and the total running time of this boot, and refresh the "Runtime" every 5 minutes, so the error is 0~-5min.

![image-20230209175457939](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/2bf9735ceb0298d6025b7c4e7b9b55c9.png)

#### 3.7.5 LoRa/LoRaWAN Log

Record the log of LoRa (if pktfwd does not open the log or the process is not started, the log may not exist). **Note: Logs are not recorded in real time. **

##### 9.1.3.1 stat package

The following logs belong to the pktfwd stat package, and pktfwd will report the stat package periodically.

```
7 2022-11-15T00:00:17.264461Z   PKTFWD:929    time 49354473, frame PUSH_DATA, 02, 4026, 00, 8CF957FFFE6017E5, {"stat":{"time":"2022-11-15 00:00:17 GMT","lati":0,"long":0,"alti":0,"rxnb":6,"rxok":6,"rxfw":6,"ackr":100,"dwnb":6,"txnb":6,"gtss":2}} // uplink a stat package
6 2022-11-15T00:00:17.266221Z   PKTFWD:402    PUSH_ACK (4026) received in 2 ms
7 2022-11-15T00:00:17.266294Z   PKTFWD:945    time 49354475, frame PUSH_ACK, 02, 4026, 01
```

The stat json object contains the status of the gateway and has the following fields:

![image-20230216181442321](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/aa9b249081aff5c47e2dfce5a3939f7d.png)

##### 9.1.3.2 LoRaWAN uplink and downlink data packets

The following logs belong to LoRaWAN uplink and downlink data. Among them, the rxpk json package belongs to the uplink data package, and data belongs to the data obtained by encrypting and base64 encoding the node application data. Users mainly care about the tmst, freq, rssi and lsnr fields. The txpk json packet belongs to the downlink data packet. Users can judge the downlink data sent by the server corresponding to the uplink data according to the tmst (unit: ms) field, because uplink tmst+1s=downlink tmst, such as: rxpk and txpk belong to a pair Uplink and downlink data, because 2105654642+1000000=2106654642. Users mainly care about the tmst and freq fields.

```
7 2022-11-15T00:00:14.949014Z   PKTFWD:929    time 49352158, frame PUSH_DATA, 02, 4025, 00, 8CF957FFFE6017E5, {"rxpk":[{"jver":1,"time":"2022-11-15T00:00:14.877267Z","tmst":2105654642,"rfch":0,"chan":5,"freq":484.9,"mid":8,"stat":1,"modu":"LORA","datr":"SF7BW125","codr":"4/5","rssic":-49,"foff":-315,"rssi":-49,"lsnr":13.5,"size":14,"data":"gMuKxwCAZ/oIkAM5Q+I="}]} // LoRaWAN uplink data packet received
6 2022-11-15T00:00:14.951076Z   PKTFWD:402    PUSH_ACK (4025) received in 2 ms
7 2022-11-15T00:00:14.951147Z   PKTFWD:945    time 49352160, frame PUSH_ACK, 02, 4025, 01
7 2022-11-15T00:00:15.297317Z   PKTFWD:1057   PULL_RESP (4A39) push ok
7 2022-11-15T00:00:15.297470Z   PKTFWD:945    time 49352506, frame PULL_RESP, 02, 4A39, 03, {"txpk":{"imme":false,"tmst":2106654642,"freq":505.3,"rfch":0,"powe":20,"modu":"LORA","datr":"SF7BW125","codr":"4/5","ipol":true,"size":12,"ncrc":true,"data":"YMuKxwCgtvgKimii","brd":0,"ant":0,"nhdr":false}}
7 2022-11-15T00:00:15.297914Z     JITQ:776    enqueue: pkt 2106654642, pre 31500, post 41000, type 0, now 2106075279, delta 579363, qos 5
7 2022-11-15T00:00:15.297990Z     JITQ:799    jit queue packets 1 (beacons: 0, ceacons: 0, downlinks: 1)
7 2022-11-15T00:00:15.298069Z   PKTFWD:929    time 49352507, frame TX_ACK, 02, 4A39, 05, 8CF957FFFE6017E5, {"txpk_ack":{"error":"NONE","jiterr":"NONE"}}
7 2022-11-15T00:00:15.856316Z     JITQ:789    dequeue: pkt 2106654642, pre 31500, post 41000, type 0, now 2106629201, delta 25441, qos 5
7 2022-11-15T00:00:15.856414Z     JITQ:799    jit queue packets 0 (beacons: 0, ceacons: 0, downlinks: 0)
7 2022-11-15T00:00:15.856450Z       RF:1202   LoRa0: lgw_send, enter 2106629201, exit 2106633681, packet 2106654642, cost 4480, diff 20961, api 4460us, lock 4463us, peek 1us, deq 5us, gps 3us, poll 5047, dly 5039
```

The rxpk json object contains the upstream data of the gateway and has the following fields:

![image-20230216182016162](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/9eb8e912bfdb30efcc7deea9f5924da3.png)

The txpk json object contains the downstream data of the gateway and has the following fields:

![image-20230216182058738](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/4874761c2b27350f95bb7d7e7590e385.png)

#### 3.7.6 Temperature Log

Record the temperature in the device box. The disconnection of the curve means that the device has been restarted. The temperature is collected every 15 minutes.

![image-20230209175621026](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/7a961b8108f385ac34170b8677fd9425.png)

#### 3.7.7 Power Log

When the external power supply and backup lithium battery are inserted or pulled out, a line of operation logs will be recorded.

Because the backup lithium battery uses polling to capture status changes, a log will be generated every time it is turned on, and if the time interval for changing the status is short, the status record may be lost. The external power supply uses interrupts to capture state changes, so there is no such thing as a lithium battery.

![image-20230209175634774](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/ce87bcd5964d005dd31bbd54c57a247a.png)

### 3.8 System Operation

#### 3.8.1 Diagnosis

Use diagnosis to quickly check device hardware failures. On-site construction personnel can use this function shortcut key to quickly diagnose the equipment to ensure that the equipment is installed correctly. Please follow the steps below for device diagnosis:

1. Click the "Diagnosis" button, and the interface pops up "Whether to diagnose the device?".

2. Click "OK" to start the diagnosis, and the interface displays the diagnosis progress bar.

3. The diagnosis is completed, and the interface displays the diagnosis result.

Projects that have been diagnosed successfully are shown in **green**, and projects that have failed to be diagnosed are displayed in **red**.

**Note: After the diagnosis is completed, the system will automatically restart.**

![image-20230213092430597](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/84cbda48e334a6b974ffac4e12c97b41.png)

![image-20230213092445664](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/772fa5d453edf276c840eb458822e314.png)

![image-20230213175224373](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/3f1cb9f52c8955df424a4b902f3f6ad8.png)

#### 3.8.2 Reboot System

When the "Reboot" button is clicked, the interface will pop up a "Whether to reboot system?" prompt. Click OK, the system will start to restart, and a system restart progress bar will pop up on the interface. After the system restarts, the original WiFi connection will be lost. Please reconnect your computer to the device's WiFi and log in to the device.

![image-20230210154445395](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/79d4f983f106ae332295a0ffef67e65e.png)

![image-20230210154457828](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/f087524862a99a2b9d7485c3df7822e8.png)

#### 3.8.3 Backhaul Network

By configuring the backhaul network priority, 10/100m Ethernet, LTE 4G and WiFi priority network methods can be selected as the backhaul network. The default gateway takes Ethernet as the priority network. When users use Ethernet and 4G at the same time, when the Ethernet cable is pulled out, it will automatically switch to 4G. When the user changes the priority of the gateway backhaul network to 4G priority, but the 4G is disconnected, the gateway will automatically switch to the wired network.

![image-20230210155226494](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/a54eb5955191e6642395c99df34f31e8.png)

### 3.9 Logout

Click the "Logout" button, and the page will return to the login interface.

### 3.10 Internationalization

There are internationalization buttons in the upper right corner of the login page and the main page, which is convenient for switching between Chinese and English.

![image-20230208170845620](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/f5fc21acc1978861fe2da0e47c18d03a.png)

## 4 Get started quickly

We use an example to let users quickly understand how the gateway is used.

### 4.1 Start the gateway LoRa service

Open the gateway web interface [Server]->[IoTSquare] menu, start Packet Forwarder, and save the "Gateway ID".

![image-20230213110220389](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/1a1708cd9a24db2511bb51d3993e0b3e.png)

### 4.2 login server

Visit the https://cloud.iotsquare.xyz/ server and log in to your account. If you do not have an account, please communicate with our company to help you register an account.

### 4.3 register gateway

Select [GATEWAYS] -> [Add Gateway] menu to register your gateway. "Gateway Name" please write the gateway ID saved in the gateway web, "Gateway Type" is RHF2S209, "Region/Subnet" users choose according to their own hardware model and frequency plan, and other parameters please refer to the user manual of the server https://wiki.risinghf.com/en/03/01/01/#_6-gateway-management.

![image-20230213093233636](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/d83498e29ee50109ea54b0616eb31547.png)

![image-20230213093655332](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/ce50dcca8a9c220e9a9fad9a88927d50.png)

![image-20230213094040757](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/3c2307b7d5c47a5d1eeef9ba8dc15857.png)

### 4.4 register node

The user queries the DevAddr, DevEUI, and AppEUI of the node through the AT command to register the server, and at the same time customizes the AppSKey, NwkSKey, and AppKey, and registers the three keys to the node and the server. For more information on server node settings, please refer to  https://wiki.risinghf.com/en/03/01/01/#_3-1-add-application. Since the node commands of different manufacturers may be different, how to query node information and set keys will not be explained here one by one. For specific AT commands, refer to the user manual of the node manufacturer.

### 4.5 send and receive data

When the gateway nodes are registered to the server. Confirm whether the gateway is online; whether the AppSKey, NwkSKey and AppKey of the node are consistent with the server; whether the registration frequency of the gateway node and the server is consistent. After the above three information are confirmed to be ok, all the steps have been completed.

Next, you can send data to the gateway through `AT+CMSG=testmsg`, and wait for the gateway to reply. Since the node commands of different manufacturers may be different, they will not be explained here one by one. For specific AT commands, refer to the user manual of the node manufacturer.

For a more detailed understanding of the use of the server, please refer to https://wiki.risinghf.com/en/03/01/01/ document.

**The RHF2S209 gateway is not only suitable for IoTSquare servers, but also for standard LoRaWAN servers. Here I just use IoTSquare as an example to explain. Other LoRaWAN servers are similar, so I won’t give examples here. **

## 5 LED indicator

The device has 6 LED lights indicating the working status of the device, but it is not connected to the case, and the user needs to open the cover to see the indication.

<table>
	<tr>
		<th>LED</th>
		<th>state</th>
		<th>describe</th>
	</tr>
    <tr>
        <td>LED1</td>
        <td>on</td>
        <td>19V AC/DC industrial power supply</td>
    </tr>
    <tr>
        <td rowspan="2">LED2</td>
        <td>slow flash</td>
        <td>4G module standby</td>
    </tr>
    <tr>
        <td>quick flash</td>
        <td>Dial successful</td>
    </tr>
    <tr>
        <td rowspan="2">LED3</td>
        <td>off</td>
        <td>LoRa module standby</td>
    </tr>
    <tr>
        <td>on</td>
        <td>LoRa module work</td>
    </tr>
    <tr>
        <td rowspan="2">LED4</td>
        <td>off</td>
        <td>Lithium battery is not charged. The lithium battery may not be connected, or it may be fully charged</td>
    </tr>
    <tr>
        <td>on</td>
        <td>Lithium battery is charging</td>
    </tr>
    <tr>
        <td rowspan="2">LED5</td>
        <td>off</td>
        <td>The network is not connected</td>
    </tr>
    <tr>
        <td>on</td>
        <td>Unobstructed network</td>
    </tr>
    <tr>
        <td rowspan="2">RJ45-LED</td>
        <td>off</td>
        <td>Network cable not connected</td>
    </tr>
    <tr>
        <td>flash</td>
        <td>Network cable connected</td>
    </tr>
</table>


## 6 Button Function

The device has 2 buttons for reset and restart functions, but they are not connected to the case, and the user needs to open the cover to operate.

| Button          | operate                 | Function                                                     |
| --------------- | ----------------------- | ------------------------------------------------------------ |
| Function-button | Long press for 1 second | Reset configuration. Such as: reset login password and WiFi password |
| RESET-button    | press                   | Hardware reboot device                                       |

## 7 firmware upgrade

Please refer to the "[Instructions for using the gateway offline upgrade tool](https://wiki.risinghf.com/en/01/02/05/03/)" document.

## 8 FAQs

Q1: The system time is incorrect, and there is a time difference with the local time.

A1: The system uses the UTC time zone by default, so there is a time difference with the user's local time. The time zone corresponding to the local area can be selected through the web interface [System]->[Time Zone] menu.



Q2: The battery power supply shows "Exception".

A2: If the device model is RHF2S209Bxx, but the backup lithium battery is not connected, it is normal to display "Exception". If the backup lithium battery is connected, "Exception" is still displayed, please contact the manufacturer in time.



Q3: The LoRa component shows "Not used".

A3: When the unused device leaves the factory, the LoRa module does not work by default, so it is normal to display "Not used". When the user starts LoRa-related services, the LoRa component displays "Normal". If the LoRa component displays "Exception", please contact the manufacturer in time.



Q4: Can multiple LoRaWAN servers be connected at the same time?

A4: No, the LoRa module in the gateway is an exclusive resource, and only one LoRa-related service can be started at a time.



Q5: The LoRaWAN data of the node cannot be received during the environmental noise floor scanning process.

A5: Environmental noise floor scanning is also one of the LoRa services. Only one LoRa-related service can be started at the same time in the gateway. Therefore, when scanning in the background noise of the environment, the LoRa service connected to the server will be closed, and then restarted after scanning.



Q6: Why is the diagnosis successful, but still unable to receive the LoRaWAN data of the node.

A6: Diagnosis is only to diagnose the hardware related to the LoRa service. A successful diagnosis only means that the hardware is OK. However, receiving LoRaWAN data is also related to the configuration of servers, gateways and nodes. It is recommended that users check whether the frequency configuration and registration information of servers, gateways and nodes are correct.



Q7: The gateway has been registered to the LoRaWAN server, but the server does not see the gateway online.

A7: Please follow the steps below to troubleshoot the problem:

1. Check whether the network backhaul is normal.
- If you use cable, please check whether the LED of RJ45 is blinking. The blinking means it is connected normally. If it is not blinking, please check whether the hardware such as network cable or RJ45 interface is normal.

- If you use 4G, please check whether LED2 is blinking. Blinking means that the 4G dial-up is successful. If it is not blinking, please check whether the 4G antenna is connected, whether the SIM card is inserted, whether the SIM is in arrears, whether the SIM card will be bound to the device, etc.

- If you use WiFi, please check whether the WiFi has been connected to the online router, and please check whether it is connected in the web interface [Network]->[WiFi Station]->[Connect Router]. If it is not connected, please check whether the WiFi antenna is connected properly, and whether the "WiFi Name" and "WiFi Password" connected to the superior router are correct.

2. Whether the server address and port number are filled in normally. Generally, you can obtain this information by consulting the user manual of the server or contacting the technical support of the server manufacturer.
3. Check whether the network of the device can access the server normally. Fill in the server ip address in the [Network]->[Ping] function. If the ping fails, please contact the network operator or server manufacturer to confirm whether the access is inaccessible due to a firewall problem. If you use 4G dial-up, confirm whether the operator has an IP whitelist mechanism.



Q8：The 4G dial-up disconnected and re-dialed every few minutes.

A8：1. Please check with the network operator whether the dialed-up APN is correct. If it is incorrect, use [Network] -> [APN Config] menu to delete the incorrect APN and fill in the correct APN.

2. Whether the operator has an IP whitelist mechanism. If there is an IP whitelist mechanism, please add [Server]->[IoTSquare]->[MQTT Server Address] (eg `cloud.iotsquare.xyz`) to the whitelist.

