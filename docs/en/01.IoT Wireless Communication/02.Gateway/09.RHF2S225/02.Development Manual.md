---
title: Development Manual
date: 2025-06-17 10:10:10
permalink: /01/02/09/02/
---

# Development Manual

## Introduction

RHF2S225 allows users to perform development. RHF2S225 software is developed based on the open source embedded operating system OpenWRT. On this basis, we have developed a variety of easy-to-use software interfaces. In addition, we also provide support for users to integrate third-party LoRa services. 

This article will not only introduce these software interfaces and how to use them, but also guide you how to help you integrate third-party LoRa services faster through some of our support. 

## Hardware resources

The hardware resources of the RHF2S225 baseboard are as follows:

* 1 USB interface
* 1 SD card expansion bit
* 1 Ethernet interface
* 1 SX1302 LoRa module
* 1 guanghetong 4G module
* 1 GPS module
* 1 SIM card slot
* 1 reset button
* 1 reserved button
* 1 USB indicator light
* 2 LoRa indicator lights
* 2 WiFi lights
* 1 system indicator light
* 1 power indicator
* 1 LTE indicator light
* 1 serial port for development
  

The SOC used by RHF2S225 is the HLK-7628N of helinko, and its hardware resources are as follows:

* Main chip: MT7628N
  
    * Arch: MIPS24KEc
      
    * Main frequency: 580MHz
      
    * Memory: DDR 2 128MB
      
    * Flash: 32M
* Wireless rate: 300M

BAND supported by 4G module:

- NL688-CN 4G module (China, RHF2S225xxx-470):

LTE FDD: Band 1, Band 3, Band 5, Band 8, all bands with diversity 

LTE TDD: Band 34, Band 38, Band 39, Band 40, Band 41, all bands with diversity 

WCDMA: Band 1, Band 8, all bands with diversity 

TD-SCDMA: Band 34, Band 39 

GSM/GPRS/EDGE: 900 MHz/1800 MHz 

- NL688-EU 4G module (Europe, RHF2S225xxx-868):

LTE FDD: Band 1, Band 3, Band 5, Band 7, Band 8, Band 20, all bands with diversity 

WCDMA: Band 1, Band 5, Band 8, all bands with diversity 

GSM/GPRS/EDGE: 850 MHz/900 MHz/1800 MHz

- NL668-AM 4G module (North America, RHF2S225xxx-915):

LTE FDD: Band 2, Band 4, Band 5, Band 12, Band 13, Band 17, Band 66, Band 71, all bands with diversity 

WCDMA: Band 2, Band 4, Band 5, all bands with diversity 

## Software resources

- Based on Linux kernel 5.15.181;
- SPI driver;
- USB Host/Device driver;
- LoRaWAN module driver;
- 4G modem driver, supporting WCDMA/TD-LTE/GPRS/EDGE data transmission;
- GPS driver, supporting GPS precise timing;
- Ethernet driver;
- WiFi driver;
- DMA driver;
- Key Drive;
- LED drive;
- Power Management drive;
- Internal temperature sensor acquisition;
- Internal hardware watchdog
- Bootloader;
- Supports Image burning;

## Debug interface

RHF2S225 provides multiple debugging methods:

* web interface
* Serial port debugging
* SSH logon

Whether using serial port or SSH to log on to the device, **the default username and password** are as follows:

Username: root

Password: risinghf

### Serial port debugging

Before connecting your device and computer, install the driver FTDT USB to UART. Open the cover of the device and use a USB to serial port tool to connect the serial port of the device to the USB port of the computer. Then you will find a COM port on your computer. Select "Serial" on the ExtraPutty and fill in the correct COM port number and baud rate 57600 to successfully connect to the device. 

![image-20230216184550055](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/9f07832acf3a9318caa97060a4fd69d5.png)

Then enter the user "root" and password "risinghf" to log on to the device. 

![image-20230216184624937](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/9c6d9b693e790da58aa560bae29ce5d8.png)

### SSH login

#### Use the IP address of Lan DHCP to log on

Connect the device to the LAN through the network cable, and use the DHCP service of the superior router to query the IP address of the device in the LAN. After obtaining the IP address of the device, use the Putty tool to log on to the command terminal. 

![image-20230216185227760](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/0f68889ea38831c99268da6a50140eb9.png)

#### Use WiFi IP to log in

Scan the WiFi signal on the computer, find the device whose SSID is RHF2S225_XXXXXX and connect it. After the computer is connected to the device, the default IP address is 192.168.100.1. After obtaining the IP address of the device, use the Putty tool to log on to the command terminal. Default SSID and password for WiFi:

SSID: RHF2S225_XXXXXX

Password: RisingHF_XXXXXX

Note: "XXXXXX" ends with 3bytes after the MAC address of the device. If there are letters, use uppercase letters. 

![image-20230216185103177](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/fbee7ae126865e43e506a0205f2c455c.png)

## Build a cross-compilation environment

Clone OpenWRT source code:

    git clone git@github.com:openwrt/openwrt.git

After cloning to the local, switch the branch to the openwrt-23.05, and then compile the OpenWRT firmware according to the instructions in the README.md document OpenWRT the project. 

![image](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/RHF2S025B/user_manual/b3b4e4b8-4bdd-42b3-82e2-658caeab7eaf.png)

It is worth mentioning that before running make to compile firmware, you need to run the `make menuconfig` to configure the firmware:

![image](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/RHF2S025B/user_manual/93c4f5e5-f47d-4cdb-a339-b203a793d041.png)

Target System, Subtarget, and Target Profile are selected as shown in the preceding figure. After saving and exiting, run `make` to start compilation. 

After the compilation is completed (the first compilation takes a long time), the `toolchain-mipsel_24kc_gcc-12.3.0_musl` in the `staging_dir` directory is the cross-compilation tool chain:

![image-20250617120306054](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/image-20250617120306054.png)

Copy the cross-compilation tool chain to the `/opt` directory (or other directories), set environment variables, open the `~/.bashrc` file, and set environment variables for the current user:

    vi ~/.bashrc

Copy the following command to import environment variables to the end of the. bashrc file:

    export PATH=/opt/toolchain-mipsel_24kc_gcc-12.3.0_musl/bin:$PATH
    export ARCH=mipsel
    export CROSS_COMPILE=mipsel-openwrt-linux-
    export STAGING_DIR=/opt/toolchain-mipsel_24kc_gcc-12.3.0_musl

Save and exit. Run the following command:

    source ~/.bashrc

Of course, you don't have to copy the toolchain to another directory and then set environment variables. You can also directly develop your own applications in OpenWRT projects without configuring the environment. Usually, we add our own applications to the package directory. 

## Integrate the new LoRa service

This chapter will use the official Packet Forwarder as a new LoRa service example to demonstrate step by step how to integrate it into the RHF2S225 system starting with compiling the source code of the Packet Forwarder. 

Procedure:

1. Compile the official Packet Forwarder
   
2. Install lora\_pkt\_fwd
   
3. Use lora\_service to manage new LoRa services
   

### Compile the official Packet Forwarder

Clone Source code:

    git clone git@github.com:Lora-net/sx1302_hal.git

Packet Forwarder source code has been included in the sx1302 driver library, and the baseband chip used by the LoRa module of RHF2S225 is exactly sx1302. 

Go to the sx1302_hal source directory:

    cd sx1302_hal

Because the cross-compilation environment has been built, you can directly run the make command on the terminal to compile:

    make

After compilation, you can see that the corresponding executable file already exists in the Packet Forwarder and the util\_XXX directory. The following figure shows the Packet Forwarder executable file -- lora\_pkt\_fwd. 

![image](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/RHF2S025B/user_manual/2518db8f-3d44-4d3f-ab40-0c917e76e268.png)

### Install lora\_pkt_fwd?

The installation of LoRa service program should comply with the Directory Specification of the Gateway system. The existing LoRa service program is installed in the /root directory, so the newly added LoRa service is also installed in this directory:

    mkdir -p /root/my_loraserver

Upload the required configuration file and the cross-compiled lora\_pkt\_fwd file in the packet\_forwarder directory to the /root/my\_loraserver Directory of the Gateway, 

![image-20250617163704977](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/image-20250617163704977.png)

Note that global\_conf. json is the global\_conf. json.sx1250.US915 in the sx1302\_hal/packet\_forwarder Directory. The configuration file you select depends on the frequency band supported by the LoRa module of the Gateway. 

Currently, lora\_pkt\_fwd cannot be started. You need to modify three parts:

1. Modify com\_path and spi\_path of global\_conf. json. The following figure shows the modification. 
   

![image-20250617163756745](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/image-20250617163756745.png)

Cause: The LoRa module of RHF2S225 is mounted on SPI bus 1. 

2. Copy the reset\_lgw.sh file to the directory where lora\_pkt\_fwd is located. Otherwise, an error will be reported that the file cannot be found when running:
   
   ```
    cp /usr/local/lora/reset_lgw.sh /root/my_loraserver/
   ```
   
3. If you use the LoRa module that comes with RHF2S225, before compiling lora\_pkt\_fwd, you need to comment out the code related to the temperature sensor, because there is no temperature sensor inside it:
   

![image](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/RHF2S025B/user_manual/0760635f-7985-4e44-84cf-1870aa92e609.png)

After compilation, upload lora\_pkt\_fwd to the /root/my\_loraserver Directory of the Gateway. 

At this point, lora\_pkt\_fwd can run normally, and the effect after running is shown in the following figure:

![image](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/RHF2S025B/user_manual/6dfad5a2-c902-4d3c-9a85-4dd102768095.png)

### Connect to your server?

Packet Forwarder is a Packet forwarding application, which is a bridge between nodes and servers. On the one hand, it receives LoRa protocol data sent by nodes and processes the data, including data parsing, checksum and Format Conversion. On the other hand, it uses network connections to transmit processed data packets to servers, for example, lora\_pkt\_fwd, which is compiled using the official source code, transmits data packets to the server through the UDP network protocol. Therefore, we need to specify the IP address of the server Packet Forwarder want to communicate. 

Assume that the IP address of your server is 192.168.0.12, you need to modify the global\_conf. json configuration file as shown in the following figure:

![image](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/RHF2S025B/user_manual/71a69f98-d7d4-48d6-a860-3676ebc5ee90.png)

Of course, you can also create a local\_conf. json and add the server\_address configuration item to overwrite the same configuration item in global\_conf. json:

![image](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/RHF2S025B/user_manual/8c7f7297-0c29-4955-8dc1-bff7c16d9b37.png)

Other configuration items are changed according to the actual situation, such as the unique number gateway_ID that identifies the gateway, and the port numbers ser\_port\_up and ser\_port\_down of the uplink and downlink processes on the server. 

### Use lora\_service to manage LoRa services

In the previous section, we used the official Packet Forwarder to connect to a specified server and run it successfully. This section describes how to use lora\_service to more easily manage newly added LoRa services. 

RHF2S225 supports multiple LoRa services, such as RisingHF deep development based on Packet Forwarder, customized UDP protocol, direct connection Packet Forwarder Link, and on this basis, the IoTSquare of connecting to MQTT Server through bridge, and lora\_service is the application used to manage these LoRa services. We recommend that you register the newly added LoRa service with lora\_service for unified management. 

Of course, you may not use it. 

#### Register LoRa service

Run the following command to register the LoRa service with the lora\_service manager. 

    lora_service --cmd "add" --name "my_loraserver" \
        --menu "my_loraserver" --index "15" \
        --start "/root/my_loraserver/start-loraserver.sh" \
        --stop "/root/my_loraserver/stop-loraserver.sh" \
        --configs "/root/my_loraserver/global_conf.json /root/my_loraserver/local_conf.json"

Implement the start/stop script of the packet forwarder, that is, the script specified by -- start and -- stop in the preceding command. 

The implementation of the start-loraserver.sh is as follows:

    #!/bin/sh
    
    SRC_DIR=$(readlink -f $0)
    SRC_DIR=$(dirname $SRC_DIR)
    PIDFILE="/var/run/my_loraserver.pid"
    
    if [ -d "$SRC_DIR" ]; then
        # Switch to working directory
        cd "$SRC_DIR"
        # Reset lora module and reset_lgw.sh
        /usr/local/sbin/gwrst
        # Use start-stop-daemon to start lora_pkt_fwd as a daemon for easy management.
    	start-stop-daemon -S -q -b -p "$PIDFILE" -m -x "$SRC_DIR/lora_pkt_fwd"
    fi
    exit "$?"

Stop script "stop-loraserver.sh" is implemented as follows:

    #!/bin/sh
    
    PIDFILE="/var/run/my_loraserver.pid"
    
    start-stop-daemon -K -q -p "$PIDFILE" 2> /dev/null
    rm "$PIDFILE" 2> /dev/null
    exit 0

#### Set lora service to start after startup

Run the following command to start the LoRa service:

    lora_service --cmd use --name my_loraserver

After the command is executed, my\_loraserver is started immediately, and the LoRa service is automatically started when RHF2S225 is turned on and enters the system. 

#### Stop lora service

    lora_service --cmd stop

#### Start lora service

    lora_service --cmd start

#### Turn off boot self-starting

    lora_service --cmd unuse

#### Query the LoRa service currently in use

    lora_service --cmd query

For more commands about lora\_service, see the help tips:

    lora_service -h

**Note: When lora\_service is executed, the Command failed may be reported: Not found, please ignore**

## Software Interface

### Obtain the basic information of the Gateway

The Gateway provides some commands to obtain the basic information of the device, which is convenient for users to integrate. 

#### Obtain the Gateway model

```
root@rhf2s225:~# get_model
RHF2S225BH8-915
```

#### Obtain the firmware version

```
root@rhf2s225:~# get_fw_ver 
1.0.0
```

#### Obtain the firmware production date

```
root@rhf2s225:~# get_fw_date
2025-06-16
```

#### Obtain the hardware version

```
root@rhf2s225:~# get_hw_ver
1.0
```

#### Obtain the number of LoRa channels

Currently, there are 8 channels

```
root@rhf2s225:~# get_lora_channel_num 
8
```

#### Does the access gateway support full duplex?

yes indicates that full duplex is supported, and no indicates that only half duplex is supported.

```
root@rhf2s225:~# get_lora_full 
no
```

#### Obtain battery capacity

no indicates that the battery is not supported.

```
root@rhf2s225:~# get_battery 
no
```

#### Obtain the Linux kernel version

```
root@rhf2s225:~# uname -r
5.15.181
```

#### Obtain the running duration of the system

```
root@rhf2s225:~# cat /proc/uptime
12119.90 11695.11
```

The first character indicates the current running duration of the Gateway. Unit: seconds. As shown above: indicates that the Gateway has been running for 12119.90 seconds. 

#### Obtain the current time zone and time

```
root@rhf2s225:~# date
Tue Jun 17 06:12:49 UTC 2025

// For more detailed time zone information, you can use uci to view the settings related to the /etc/config/system file
root@rhf2s225:~# uci show system | grep zone
system.@system[0].zonename='Asia/Shanghai'
system.@system[0].timezone='CST-8'
```

#### Obtain the Ethernet IP address

```
root@rhf2s225:~# ifconfig br-wan
br-wan    Link encap:Ethernet  HWaddr E4:38:19:1C:D9:0D
          inet addr:192.168.0.117  Bcast:192.168.0.255  Mask:255.255.255.0
          inet6 addr: fe80::e638:19ff:fe1c:d90d/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
          RX packets:86452 errors:0 dropped:0 overruns:0 frame:0
          TX packets:6947 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:1000
          RX bytes:13697031 (13.0 MiB)  TX bytes:555727 (542.7 KiB)
```

The Ethernet interface of RHF2S225 is br-wan. 

#### Obtain the current callback network interface

```
root@rhf2s225:~# netpriority 
eth
```

#### Obtain version revision records

```
root@rhf2s225:~# get_changelog 
## 1.0.0
- Initial version
```

### Set the priority of the return network

RHF2S225 supports ethernet, WiFi, and LTE (three kinds of backhaul networks, their priority is: Ethernet> WiFi > LTE, the Ethernet with the highest priority is used as the backhaul network by default, of course, use the netpriority command to manually set. 

netpriority command parameters:

1. eth: set the return network mode to Ethernet
   
2. wifi: set the return network mode to WiFi
   
3. lte: set the return network mode to LTE
   
4. No parameters (query the current callback network type)
   

#### Set backhul network

```
root@rhf2s225:~# netpriority wifi
```

After running this command, if the wifi is in the networked state, the system changes the type of the return network to WiFi. Otherwise, the network type with the highest priority and in the networked state is used. 

#### View the current network type

```
root@rhf2s225:~# netpriority // query without parameters
wifi
```

### Set static IP

When the device is connected to the network cable, the IP address dynamically assigned by the superior router is obtained through DHCP by default. If you need to set a static IP address, use the setip command to set a static IP address. 

The following is a help manual for setip:

    root@rhf2s225:~# setip -h
    Usage: setip [options]
    
    Options:
      --help                  Show this help
      --mode      <MODE>      IP mode(dhcp, static)
      --addr      <ADDR>      IP addr
      --gateway   <GATEWAY>   IP gateway
      --dns0      <DNS0>      nameserver0
      --dns1      <DNS1>      nameserver1
    
    Examples:
      setip
      setip --mode dhcp
      setip --mode static --addr ADDR --gateway GATEWAY --dns0 DNS0 --dns1 DNS1

### Set up an ntp server

Set up an NTP server. You can use the setntp command to manage your own NTP server. A maximum of five NTP servers can be created at the same time. 

The following is a help manual for setntp:

    root@rhf2s225:~# setntp -h
    Usage: setntp [options] server
    
    Options:
      --help                  Show this help
      --top     <TOPSERVER>   Top server
    
    Examples:
      setntp SERVER
      setntp --top TOPSERVER
      setntp --top TOPSERVER SERVER

\--top: sets the NTP server to the top. This NTP server has the highest priority. 

### LTE

RHF2S225 supports connecting to the Internet through LTE modules. As one of the system services of RHF2S225, it has the following characteristics:

1. The SIM card can be automatically identified and APN information can be generated
   
2. Support SIM card Hot Plug operation
   
3. Support roaming
   

In addition, we have developed a variety of software interfaces to facilitate developers to operate it. 

#### View LTE dial logs

```
root@rhf2s225:~# cat /root/rlog/lte.log
```

For more information about log analysis, see [LTE Dial log]. 

#### Confirm whether the dialing is successful?

```
root@rhf2s225:~# ifconfig 3g-ppp0
3g-ppp0   Link encap:Point-to-Point Protocol
          inet addr:10.63.161.248  P-t-P:10.64.64.64  Mask:255.255.255.255
          UP POINTOPOINT RUNNING NOARP MULTICAST  MTU:1500  Metric:1
          RX packets:4 errors:0 dropped:0 overruns:0 frame:0
          TX packets:16 errors:0 dropped:0 overruns:0 carrier:0
          collisions:0 txqueuelen:3
          RX bytes:52 (52.0 B)  TX bytes:350 (350.0 B)
```

If the preceding log is returned, the dialing is successful.

#### Reset 4G module

```
root@rhf2s225:~# lterst
```

After the 4G module is reset, it takes about 20 seconds to work properly. 

#### Verify whether the SIM card is inserted?

```
root@rhf2s225:~# ltesim
ltesim: lte sim start
ltesim: OK, SIM inserted
ltesim: lte sim done
```

#### Obtain the current network signal quality

```
root@rhf2s225:~# lterssi
lterssi: lte rssi start
lterssi: OK, -51
lterssi: lte rssi done
```

#### Obtain the IMEI code of the device

```
root@rhf2s225:~# lteimei
lteimei: lte imei start
lteimei: OK, 869816052168183
lteimei: lte imei done
```

#### Obtain SIM card IMSI

```
root@rhf2s225:~# lteimsi
lteimsi: lte imsi start
carrier: 中国移动 (China Mobile) IoT
lteimsi: OK, 460240460795732
lteimsi: lte imsi done
```

#### Obtain the SIM card iccid

```
root@rhf2s225:~# lteiccid
lteiccid: lte iccid start
lteiccid: OK, 89860856112490245732
lteiccid: lte iccid done
```

#### Diagnosis LTE

```
root@rhf2s225:~# ltediagnosis
ltediagnosis: lte diagnosis start
ltediagnosis: OK, lte modem normal
ltediagnosis: OK, usb bus normal
ltediagnosis: OK, lte modem responding
ltediagnosis: OK, SIM inserted
ltediagnosis: OK, rssi is -51
carrier: 中国移动 (China Mobile) IoT
ltediagnosis: OK, imsi is 460240460795732
ltediagnosis: lte diagnosis done
```

#### Open lte service

```
root@rhf2s225:~# /etc/init.d/lte enable && /etc/init.d/lte restart
```

#### Disable lte service

```
root@rhf2s225:~# /etc/init.d/lte disable && /etc/init.d/lte stop
```

#### Find APN

You can use the selapn command to check whether the APN of the card already exists in the device based on the APN information of your SIM card. If not, add the APN of the card through addapn and use `selapn --help` to obtain the help information of the command. 

    root@rhf2s225:~# selapn --help
    Usage: selapn [options]
    
    Options:
      --help                  Show this help
      --carrier <CARRIER>     Select carrier name
      --mcc <MCC>             Select carrier mcc
      --mnc <MNC>             Select carrier mnc
      --apn <APN>             Select carrier apn
    
    Examples:
      selapn
      selapn --carrier CARRIER --mcc MCC --mnc MNC --apn APN

#### Add APN

The device system already contains the APN configurations of most global mainstream operators. However, you can also use the addapn command to add more APN configuration information. Use `addapn --help` to obtain help information about using this command. 

    root@rhf2s225:~# addapn --help
    Usage: addapn [options]
    
    Options:
      --help                  Show this help
      --carrier <CARRIER>     Set carrier name
      --mcc <MCC>             Set carrier mcc
      --mnc <MNC>             Set carrier mnc
      --apn <APN>             Set carrier apn
      --user <USER>           Set apn user
      --pwd <PWD>             Set apn pwd
    
    Examples:
      addapn --carrier CARRIER --mcc MCC --mnc MNC --apn APN --user USER --pwd PWD
      addapn --carrier CARRIER --mcc MCC --mnc MNC --apn APN

#### Delete APN

If you want to delete an extra APN, you can use the delapn command and `delapn --help` to obtain the help information of the command. 

    root@rhf2s225:~# delapn --help
    Usage: delapn [options]
    
    Options:
      --help                  Show this help
      --carrier <CARRIER>     Delete carrier apn
      --mcc <MCC>             Delete carrier mcc
      --mnc <MNC>             Delete carrier mnc
      --apn <APN>             Delete apn
    
    Examples:
      delapn --carrier CARRIER
      delapn --carrier CARRIER --mcc MCC --mnc MNC
      delapn --carrier CARRIER --apn APN

### LoRa

#### Reset LoRa

The device provides hardware reset LoRa commands. We recommend that you use hardware reset before using LoRa to avoid problems such as program execution failure. 

    root@rhf2s225:~# gwrst

#### Start LoRa

Use `/etc/init.d/pktfwd` to control LoRa, provided that the LoRa service is registered in the lora\_service manager. 

    // Query the LoRa service in use first.
    root@rhf2s225:~# lora_service --cmd query
    
    // If no LoRa service is currently used, select one of the LoRa services such as pktfwd and iotsquare.
    root@rhf2s225:~# lora_service --cmd use --name iotsquare
    // Or select pkfwd (directly connected to the Packet Forwarder of the server without passing through the bridge)
    root@rhf2s225:~# lora_service --cmd use --name pktfwd

Next, we can use/etc/init.d/pktfwd to control the Packet Forwarder. 

    // Start the Packet Forwarder.
    root@rhf2s225:~# /etc/init.d/pktfwd start
    // Restart the Pacet Forwarder.
    root@rhf2s225:~# /etc/init.d/pktfwd restart

However, we do not need to manually call `/etc/init.d/pktfwd start` to start the LoRa service, because the `lora_service --cmd use --name pktfwd` has been called when it is executed, unless we manually stop the Packet Forwarder. 

#### Stop LoRa

That is, manually stop the Packet Forwarder. 

    root@rhf2s225:~# /etc/init.d/pktfwd stop

### Bottom noise scanning

The equipment has a built-in bottom noise analysis engine, which can help users scan and analyze the bottom noise of the environment on site, and detect interference signals and noises in advance when customers deploy on site. In order to realize network optimization and avoid strong interference channel frequency. **Note: Before using bottom noise scanning, you must turn off the LoRa service. **

The bottom noise scanning function is easy to operate. You only need to enter the start and end frequency points in the command parameters. The default step is 200000HZ, the sampling times are 2000, the rssi_offset RHF2S225xxx-470 series Gateway compensation is -32dB, the RHF2S225xxx-868 series Gateway compensation is -24dB, and the RHF2S225xxx-915 series Gateway compensation is -26dB. The wider the scan bandwidth, the longer it takes. It is generally recommended to scan only 2MHz or 5MHz to cover the target operating frequency band. **Note: hardware causes that the RHF2S225xxx-470 series can only scan 470~490Mhz, the RHF2S225xxx-868 series can only scan 862~876Mhz, and the RHF2S225xxx-915 series can only scan 902~928Mhz. **

```
root@rhf2s225:~# cd /usr/local/lora/ && ./spectral_scan -f 920 -F 921
==
== Spectral Scan: start_freq_hz=920000000Hz, end_freq_hz=921000000HZ, step_hz=200000HZ, nb_channels=6, nb_scan=2000, rssi_offset=-26dB
==
Opening SPI communication interface
Note: chip version is 0x10 (v1.0)
INFO: using legacy timestamp
ARB: dual demodulation disabled for all SF
SX1261: PRAM version: SX1261 V2D 2D06
SX1261: PRAM version: SX1261 V2D 2D06
920000000: 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 123 1790 87 0 0 0 0 0 0 0 0 0 0 0 0 0
920200000: 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1810 156 34 0 0 0 0 0 0 0 0 0 0 0 0
920400000: 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1674 326 0 0 0 0 0 0 0 0 0 0 0 0 0
920600000: 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 17 1759 224 0 0 0 0 0 0 0 0 0 0 0 0 0
920800000: 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1793 207 0 0 0 0 0 0 0 0 0 0 0 0 0
921000000: 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1840 160 0 0 0 0 0 0 0 0 0 0 0 0 0
Closing SPI communication interface
```

The result of scanning shows a horizontal peak wave, and the bottom noise of the point with high peak wave is relatively high. First, the number in the first column of each row to': 'is the scanning frequency point. Starting from ':', each column of numbers represents the RSSI where the bottom noise is scanned. There are 33 groups in total. The first value is the rssi_offset compensation value -26dB, and the difference between each group is 4dB. The RSSI of the last two groups is the same. As shown below, due to space problems, some meaningless values are deleted in the middle. 

```
# freq    -26 -30 -34 -38 -42 ... -90 -94 -98 -102 -106 -110 -114 ... -142 -146 -150 -150
920000000: 0   0   0   0   0       0   123 1790 87   0    0    0        0    0    0    0 # 920000000 the bottom noise of the frequency point is concentrated in-98dB
920200000: 0   0   0   0   0       0   0   1810 156  34   0    0        0    0    0    0
920400000: 0   0   0   0   0       0   0   1674 326  0    0    0        0    0    0    0
920600000: 0   0   0   0   0       0   17  1759 224  0    0    0        0    0    0    0
920800000: 0   0   0   0   0       0   0   1793 207  0    0    0        0    0    0    0
921000000: 0   0   0   0   0       0   0   1840 160  0    0    0        0    0    0    0 # 920000000~921000000 the average bottom noise of frequency points is-98dB
```

For more configuration parameters of bottom noise scanning, see the help manual `./spectral_scan -h`

```
root@rhf2s225:/usr/local/lora# ./spectral_scan -h
Library version information: Version: 1.0.0;
Available options:
 -h         Print this help
 -f <float> Scan start frequency, in MHz
 -F <float> Scan end frequency, in MHz
 -e <float> frequency step, in KHz
 -n <uint>  Number of channels to scan
 -s <uint>  Number of scan points per frequency step [1..65535]
 -o <int>   RSSI Offset of the sx1261 path, in dB [-127..128]
 -l <char>  Log file name
```

Ambient noise is an important index parameter that affects wireless communication. If you need to set up and install the Gateway on site, make a preliminary analysis of the environmental noise on site to avoid high noise or strong interference affecting the communication distance and reliability. We hope that the environmental noise will be as low as possible, but the real environment cannot be completely free of interference or noise. It is generally recommended that the ambient noise bottom be around -110dBm, which is ideal. Generally, the maximum noise is allowed to not exceed -100dBm, otherwise the communication distance will be severely limited. If the noise is above -95dBm, it is strongly recommended to change the working frequency band to avoid interference noise. 

### Temperature sensor

You can run the get\_temp command to query the temperature of the Gateway in real time. If you need to integrate it into your personal program, try to control the collection cycle within more than 15 minutes, because multiple monitoring processes in the system use this command, frequent use will lead to high CPU utilization. 

    root@rhf2s225:~# get_temp
    32.81

### Modify the time zone

#### Query the time zone supported by the system

```
root@rhf2s225:~# zonelist
```

#### Obtain the currently set time zone

```
root@rhf2s225:~# zoneget
UTC
```

#### Modify the time zone

```
zoneset Asia/Shanghai CST-8
```

For example, change the time zone to `Asia/Shanghai`

### WiFi

WiFi AP service is mainly used for near-field wireless debugging. 

#### Open WiFi AP service

WiFi AP service is enabled by default. 

    root@rhf2s225:~# openap

#### Disable WiFi AP service

If the user does not want to connect to the WiFi AP for security reasons, you can use the `closeap` command to close it. 

    root@rhf2s225:~# closeap

#### Configure WiFi AP

```
root@rhf2s225:~# confap -h
Usage: confap [options]

Options:
  --help                  Show this help
  --gateway <GATEWAY>     The gateway of the wifi you are connected to
  --ssid    <SSID>        The SSID of the wifi you are connected to
  --key     <KEY>         The password of the wifi you are connected to
  --hidden  <HIDE>        Where the SSID is hidden. 1 or 0

Examples:
  confap --ssid SSID --key KEY --hidden 0
  confap --gateway GATEWAY --ssid SSID --key KEY --hidden 0
```

#### View SSID and Key

```
root@rhf2s225:~# uci show wireless
```

### web Interface Service

web interface service is a built-in web interface of a device. Use the IP address of the device to open the web interface through a browser. For more information, see [built-in web interface] in the user manual. 

##### Open a web service

web services are enabled by default. 

```
root@rhf2s225:~# openweb
```

##### Close the web service

If you do not want to log on to the web interface for security reasons, you can use the `closeweb` command to close it. 

```
root@rhf2s225:~# closeweb
```

### Debug serial port

##### Open the debugging serial port

The debugging serial port is opened by default. 

```
root@rhf2s225:~# openserial
```

##### Close the debugging serial port

If the user does not want to log on to the command terminal by debugging the serial port for security reasons, you can use the `closeserial` command to close it. 

```
root@rhf2s225:~# closeserial
```

### ssh management

#### Open ssh

ssh is enabled by default. 

    root@rhf2s225:~# openssh

#### Disable ssh

If you do not want to log on to the command terminal through ssh for security reasons, you can use the `closessh` command to close the command. 

    root@rhf2s225:~# closessh

### The system is started only once.

The script in the `/etc/initonce.d/` directory is run only once. If the command is executed successfully (the command returns 0), the system deletes the command and will not execute the command next time it is turned on. If the execution fails (the command returns a non-zero value), the system will still run again next time it starts. It is suitable for users to run the configuration only once after starting up. 

### Interface for reporting network status

When the route path of the return network changes, the system executes all commands in the `/etc/route-call.d` directory. Two variables, `ROUTE_BEFOR` and `ROUTE_CURR`, are exposed, respectively representing the previous route path and the current route path. It is suitable for users to monitor whether the network routing path has changed. 

## Device logs

RHF2S225 has two log output directories: /var/log and /root/rlog. The difference between the two log directories is whether the logs are cleared after the device is restarted. The /var/log directory mainly stores system logs. After the device is restarted, the logs are cleared, commonly known as non-persistent logs. Logs that are not particularly important and have a large number of output logs are stored. The /root/rlog directory mainly stores logs related to key processes. The restart of the device is not affected. It is commonly known as persistent logs. It stores logs with few output logs and is particularly important. It is convenient to view the status of the device in the future. 

### /var/log (non-persistent log)

Non-persistent logs can be stored for a maximum of 40MB. When they are larger than 40MB, logs cannot be written, but the program usage is not affected. Of course, the device regularly cuts logs to ensure that the device's non-persistent logs are not larger than 40MB. 

#### lastlog logs

/var/log/lastlog, which records the latest logon information of each user. 

#### wtmp log

/var/log/wtmp is used to record logon, logout, and system startup events in the system. 

#### lighttpd logs

/var/log/lighttpd, lighttpd is a directory. The error.log file contains the error log of the lighttpd process. 

#### pktfwd log

/var/log/pktfwd.log, record LoRa logs (if pktfwd is not enabled or the process is not started, the logs may not exist). **Note: logs are not recorded in real time. **

##### stat package

The following logs belong to the pktfwd stat package. pktfwd reports the stat package regularly. You can use the gateway_conf.stat_interval option of the global_conf.json or local_conf.json file to modify the reporting cycle of the stat package. 

```
7 2022-11-15T00:00:17.264461Z   PKTFWD:929    time 49354473, frame PUSH_DATA, 02, 4026, 00, 8CF957FFFE6017E5, {"stat":{"time":"2022-11-15 00:00:17 GMT","lati":0,"long":0,"alti":0,"rxnb":6,"rxok":6,"rxfw":6,"ackr":100,"dwnb":6,"txnb":6,"gtss":2}} // report an stat package
6 2022-11-15T00:00:17.266221Z   PKTFWD:402    PUSH_ACK (4026) received in 2 ms
7 2022-11-15T00:00:17.266294Z   PKTFWD:945    time 49354475, frame PUSH_ACK, 02, 4026, 01
```

stat json object contains the status of the Gateway and has the following fields:

![image-20230216181442321](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/aa9b249081aff5c47e2dfce5a3939f7d.png)

##### LoRaWAN uplink and downlink data packets

The following logs belong to LoRaWAN uplink and downlink data. rxpk json packets belong to uplink data packets, and data belongs to the data obtained from node application data encryption and base64 encoding. Users are mainly concerned with tmst, freq, rssi, and lsnr fields. txpk json packet belongs to the downstream data packet. You can determine the downstream data sent by the server corresponding to the upstream data based on the tmst (unit: ms) field, because the upstream tmst +1s = the downstream tmst. For example, rxpk and txpk belong to a pair of upstream data, because 2105654642+1000000=2106654642. Users are mainly concerned with tmst and freq fields. 

```
7 2022-11-15T00:00:14.949014Z   PKTFWD:929    time 49352158, frame PUSH_DATA, 02, 4025, 00, 8CF957FFFE6017E5, {"rxpk":[{"jver":1,"time":"2022-11-15T00:00:14.877267Z","tmst":2105654642,"rfch":0,"chan":5,"freq":484.9,"mid":8,"stat":1,"modu":"LORA","datr":"SF7BW125","codr":"4/5","rssic":-49,"foff":-315,"rssi":-49,"lsnr":13.5,"size":14,"data":"gMuKxwCAZ/oIkAM5Q+I="}]} // LoRaWAN received uplink packets
6 2022-11-15T00:00:14.951076Z   PKTFWD:402    PUSH_ACK (4025) received in 2 ms
7 2022-11-15T00:00:14.951147Z   PKTFWD:945    time 49352160, frame PUSH_ACK, 02, 4025, 01
7 2022-11-15T00:00:15.297317Z   PKTFWD:1057   PULL_RESP (4A39) push ok
7 2022-11-15T00:00:15.297470Z   PKTFWD:945    time 49352506, frame PULL_RESP, 02, 4A39, 03, {"txpk":{"imme":false,"tmst":2106654642,"freq":505.3,"rfch":0,"powe":20,"modu":"LORA","datr":"SF7BW125","codr":"4/5","ipol":true,"size":12,"ncrc":true,"data":"YMuKxwCgtvgKimii","brd":0,"ant":0,"nhdr":false}}
7 2022-11-15T00:00:15.297914Z     JITQ:776    enqueue: pkt 2106654642, pre 31500, post 41000, type 0, now 2106075279, delta 579363, qos 5
7 2022-11-15T00:00:15.297990Z     JITQ:799    jit queue packets 1 (beacons: 0, ceacons: 0, downlinks: 1)
7 2022-11-15T00:00:15.298069Z   PKTFWD:929    time 49352507, frame TX_ACK, 02, 4A39, 05, 8CF957FFFE6017E5, {"txpk_ack":{"error":"NONE","jiterr":"NONE"}}
7 2022-11-15T00:00:15.856316Z     JITQ:789    dequeue: pkt 2106654642, pre 31500, post 41000, type 0, now 2106629201, delta 25441, qos 5
7 2022-11-15T00:00:15.856414Z     JITQ:799    jit queue packets 0 (beacons: 0, ceacons: 0, downlinks: 0)
7 2022-11-15T00:00:15.856450Z       RF:1202   LoRa0: lgw_send, enter 2106629201, exit 2106633681, packet 2106654642, cost 4480, diff 20961, api 4460us, lock 4463us, peek 1us, deq 5us, gps 3us, poll 5047, dly 5039
```

The rxpk json object contains the upstream data of the Gateway and has the following fields:

![image-20230216182016162](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/9eb8e912bfdb30efcc7deea9f5924da3.png)

The txpk json object contains the downstream data of the Gateway and has the following fields:

![image-20230216182058738](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/4874761c2b27350f95bb7d7e7590e385.png)

#### rhf-bridge logs

/var/log/bridge.log, which records the rhf-birdge log. If the log is not enabled for the rhf-birdge or the process is not started, the log may not exist. 

### /root/rlog (persistent log)

The storage size of persistent logs is the same as the remaining space of flash. Generally, the storage size can be 10MB. However, if the remaining space of flash is insufficient, the normal use of the program will be affected. Therefore, you should be cautious when saving persistent logs. Of course, the device regularly cuts logs to ensure that persistent logs do not consume too much flash. 

#### Ethernet logs

/root/rlog/eth.log. When the network status of the br-wan (Ethernet), 3g-ppp0(LTE), and apcli0(WiFi) network components changes, the system generates a row of logs. 

```
[2025-06-16 07:21:42]->[br-wan: connected]
[2025-06-16 07:21:42]->[3g-ppp0: disconnected]
[2025-06-16 07:34:06]->[3g-ppp0: connected]
[2025-06-16 07:35:06]->[3g-ppp0: disconnected]
[2025-06-16 07:35:14]->[br-wan: connected]
[2025-06-16 07:36:40]->[3g-ppp0: connected]
[2025-06-17 02:03:32]->[3g-ppp0: disconnected]
[2025-06-17 02:03:40]->[br-wan: connected]
[2025-06-17 02:48:09]->[3g-ppp0: connected]
[2025-06-17 02:48:35]->[3g-ppp0: disconnected]
[2025-06-17 02:48:43]->[br-wan: connected]
[2025-06-17 02:51:09]->[3g-ppp0: connected]
[2025-06-17 06:55:22]->[3g-ppp0: disconnected]
[2025-06-17 06:55:29]->[3g-ppp0: connected]
[2025-06-17 07:01:33]->[3g-ppp0: disconnected]
[2025-06-17 07:01:53]->[3g-ppp0: connected]
```

#### LTE Dial Log

/root/rlog/lte.log to record all LTE dialing logs. 

##### Example of successful dialing

When the log prompts "dial success", The dialing is successful. 

    [2025-06-16 06:11:13]->[ltestart: OK, SIM inserted]
    [2025-06-16 06:11:13]->[ltestart: OK, 89860856112490245732]
    [2025-06-16 06:11:13]->[automatically operators mode]
    [2025-06-16 06:11:14]->[ltestart: APN information: 中国移动 (China Mobile) IoT,460,24,CMMTMXAFN.HE,,]
    Calling UMTS/GPRS
    chat:  Jun 16 06:11:19 CONNECT 150000000
    Serial connection established.
    Renamed interface ppp0 to 3g-ppp0
    Using interface 3g-ppp0
    Connect: 3g-ppp0 <--> /dev/ttyUSB2
    Could not determine remote IP address: defaulting to 10.64.64.64
    local  IP address 10.195.119.174 // obtain the IP address of the carrier, indicating that the dialing is successful. The IP address is not fixed.
    remote IP address 10.64.64.64
    primary   DNS address 120.196.165.7
    secondary DNS address 221.179.38.7
    [2025-06-16 06:11:22]->[ltestart: dial success] // prompt dialing successful
    [2025-06-16 06:11:23]->[ltestart: CHINA MOBILE's 7 rssi is -51] // signal quality of current network
    IPV6CP: timeout sending Config-Requests
    [2025-06-16 06:26:23]->[ltestart: CHINA MOBILE's 7 rssi is -51]
    [2025-06-16 06:41:23]->[ltestart: CHINA MOBILE's 7 rssi is -51]

##### Dial without SIM card

    [2025-06-16 08:36:19+00:00]->[ltestart: start dial]
    [2025-06-16 08:37:20+00:00]->[ltestart: start dial]
    [2025-06-16 08:38:20+00:00]->[ltestart: start dial]
    [2025-06-16 08:39:21+00:00]->[ltestart: start dial]
    [2025-06-16 08:40:21+00:00]->[ltestart: start dial] // regular round-robin start dialing

##### APN not found

    [2025-06-16 09:17:29+00:00]->[ltestart: start dial]
    [2025-06-16 09:17:30+00:00]->[ltestart: OK, SIM inserted]
    [2025-06-16 09:17:30+00:00]->[ltestart: OK, 89860619050022383540]
    [2025-06-16 09:17:30+00:00]->[automatically operators mode]
    [2025-06-16 09:17:31+00:00]->[ltestart: NG, unsupport 2 bits mnc sim card, 460, 06] // APN not found
    [2025-06-16 09:17:31+00:00]->[ltestart: NG, unsupport 3 bits mnc sim card, 460, 061] 

##### SIM card no fee/incorrect use APN/device location no carrier network/SIM card binding function

    [2025-06-16 10:37:37]->[ltestart: OK, SIM inserted]
    [2025-06-16 10:37:37]->[ltestart: OK, 8931088517079072357F]
    [2025-06-16 10:37:37]->[automatically operators mode]
    [2025-06-16 10:37:37]->[ltestart: APN information: KPN-M2M,204,08,intelligence.m2m,,]
    [2025-06-16 10:37:55]->[ltestart: dial timeout]
    [2025-06-16 10:37:55]->[ltestart: APN dial failure]
    [2025-06-16 10:37:55]->[ltestart: APN information: Rabo Mobiel MMS,204,08,rabo,,]
    [2025-06-16 10:38:12]->[ltestart: dial timeout]
    [2025-06-16 10:38:12]->[ltestart: APN dial failure]
    [2025-06-16 10:38:12]->[ltestart: APN information: Rabo Mobiel Int.,204,08,rabo,,]
    [2025-06-16 10:38:28]->[ltestart: dial timeout]
    [2025-06-16 10:38:28]->[ltestart: APN dial failure]
    [2025-06-16 10:38:28]->[ltestart: APN information: MVNO NL,204,08,internet.mvno.mobi,mvno,mvno]
    [2025-06-16 10:38:46]->[ltestart: dial timeout]
    [2025-06-16 10:38:46]->[ltestart: APN dial failure]
    [2025-06-16 10:38:46]->[ltestart: APN information: KPN/Hi Mobiel Internet,204,08,portalmmm.nl,,]
    [2025-06-16 10:39:03]->[ltestart: dial timeout]
    [2025-06-16 10:39:03]->[ltestart: APN dial failure]
    [2025-06-16 10:39:03]->[ltestart: APN information: KPN/Hi 4G LTE Mobiel internet,204,08,KPN4G.nl,,]
    [2025-06-16 10:39:20]->[ltestart: dial timeout]
    [2025-06-16 10:39:20]->[ltestart: APN dial failure]
    [2025-06-16 10:39:20]->[ltestart: NG, 2 bits mnc dial failure, 204, 08]
    [2025-06-16 10:39:20]->[ltestart: NG, unsupport 3 bits mnc sim card, 204, 080]

##### Signal quality

After the dialing is successful, the signal quality of the current network is recorded every 15 minutes. 

    [2025-06-16 05:24:28+00:00]->[ltestart: dial success]
    [2025-06-16 05:24:28+00:00]->[ltestart: CHN-UNICOM's 7 rssi is -53]
    [2025-06-16 05:39:29+00:00]->[ltestart: CHN-UNICOM's 7 rssi is -53]
    [2025-06-16 05:54:29+00:00]->[ltestart: CHN-UNICOM's 7 rssi is -53]
    [2025-06-16 06:09:29+00:00]->[ltestart: CHN-UNICOM's 7 rssi is -53]
    [2025-06-16 06:24:29+00:00]->[ltestart: CHN-UNICOM's 7 rssi is -53]
    [2025-06-16 06:39:29+00:00]->[ltestart: CHN-UNICOM's 7 rssi is -53]
    [2025-06-16 06:54:29+00:00]->[ltestart: CHN-UNICOM's 7 rssi is -53]
    [2025-06-16 07:09:29+00:00]->[ltestart: CHN-UNICOM's 7 rssi is -53]
    [2025-06-16 07:24:30+00:00]->[ltestart: CHN-UNICOM's 7 rssi is -53]
    [2025-06-16 07:39:30+00:00]->[ltestart: CHN-UNICOM's 7 rssi is -53] // The current network signal quality is -53dbm

#### System logs

/root/rlog/messages, which records the kernel running logs, including the kernel running status information, user app and other system logs, and can be used to analyze the running status of the device system. 

#### Run logs

/root/rlog/runtime.log, record the device boot time and the total running time of this boot. The log format it saves is `[boot time]->[system running duration (unit: Seconds)]`, which refreshes the "system running duration" every 5 minutes, so the error is 0 ~-5min. 

```
[2025-06-13 10:43:45+00:00]->[157.87] // This log records that the device was turned on at about 10:43:45+00:00 on 2025-06-13 and shut down after 157.87 seconds of operation.
[2025-06-13 10:46:46+00:00]->[247848.18] // if the log is the last line of the file, it means that the current device started up at about 10:46:46+00:00 on 2025-06-13 and has been running for 247848.18 seconds. The value will be refreshed in the next 5 minutes.
```

#### Temperature log

/root/rlog/temp.log, record the temperature in the device box, and collect the temperature every 15 minutes. 

```
[2025-06-13 10:43:46+00:00]->[null] // The first temperature collection value after the device is started is "null", which is mainly used to divide the temperature collected from the last start and the temperature collected from this start.
[2025-06-13 10:43:46+00:00]->[28.19]
[2025-06-13 10:46:47+00:00]->[null]
[2025-06-13 10:46:47+00:00]->[28.62]
[2025-06-13 11:01:48+00:00]->[29.69]
[2025-06-13 11:16:48+00:00]->[29.69]
[2025-06-13 11:31:49+00:00]->[29.56]
[2025-06-13 11:46:50+00:00]->[29.38]
```

**Note: Generally, the temperature in the box is about 8°C higher than the current ambient temperature. **

#### Check logs

/root/rlog/det.log, Exception detection log (if no exception has occurred on the device, the log may not exist). When the device detects an exception, it records a row of logs and performs corresponding exception handling. 

```
[2025-06-16 07:59:00+00:00]->[The 3g-ppp0 cannot ping the server, re-establish] // if The 4G dialing is successful, but the specified server is tried 10 times, but The ping fails once, the dialing will be repeated. It is common that IoT Nic has the whitelist function. You need to add the mqtt_server of /root/rhf-bridge/sdk_conf.json to the whitelist. 
[2025-06-16 08:04:11+00:00]->[The 3g-ppp0 cannot ping the server, system ready reboot] // when The SIM card is inserted but the dialing fails all The time, the device will be restarted when The dialing fails 1000 times. It is common that the SIM card has no charge/the location of the device has no carrier network/the SIM card has binding function. 
[2025-06-18 08:07:23+00:00]->[dhcp failed, system ready reboot] // The IP address cannot be obtained correctly after the network cable is connected. 
```

## Troubleshooting

### LoRa service process conflicts

The LoRa module is an exclusive resource, and the Gateway can only be occupied by one program. If multiple programs use the LoRa module at the same time, unexpected problems will occur in the LoRa module of the Gateway. Therefore, no matter when using or testing, make sure that the LoRa service module is run by only one program. 

Currently, the Gateway system integrates the following programs to start the LoRa service:

- packet_forwarder
- iotsquare
- loraserver
- LoRa test program
- Bottom noise scanning

#### ps

Run the `ps-w | grep-E 'lora_pkt_fwd | pktfwd | loragw | spectral_scan` command to check whether the system has LoRa service-related programs. 

- lora_pkt_fwd is the keyword of the packet_forwarder process.
- pktfwd is a keyword for iotsquare, loraserver processes.
- loragw is the keyword of the LoRa test process.
- spectral_scan is the process keyword for bottom noise scanning.

If the LoRa module is occupied, two or more records (one of which is the record of its own command) are returned. The user determines which process is being executed by the system based on the returned process keywords. As shown in the following figure, the LoRa module is being occupied by the iotsquare service. For more information about how to disable the service, see the user manual of the device. 

![image-20250617163231200](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/image-20250617163231200.png)

#### Independently developed pktfwd

When the self-developed pktfwd is started, it checks whether the LoRa module has been used. If used, an error is returned and exited. Therefore, it can be used to check whether the LoRa module has been used. 
Run the command: `/root/packet_forwarder/lora_pkt_fwd --log-stdout 1`
If the LoRa module is occupied, the error shown in the following figure is output, where (PID xxxx) is that the LoRa module is occupied by the xxxx process. Use `kill -9 xxxx` to kill a process. If the process is started using the init.d service, you must shut down the LoRa service. For more information about how to shut down the service, see the user manual of the device. Otherwise, it will be occupied again after a period of time. 

![image-20250617163346394](https://risinghf-wiki.oss-cn-shenzhen.aliyuncs.com/upload/img/image-20250617163346394.png)

#### lora_service

The Gateway customizes the lora_service command to host the LoRa service process of the Gateway. You can ensure that only one LoRa service process is run at a time. You can also use this command to query and close running LoRa processes. 
query command: `lora_service --cmd query`
Disable command: `lora_service --cmd stop`
For more options, see the help Manual: `lora_service -h`.
**Note: this command cannot query whether the LoRa service process hosted by non-lora_service is running, for example, the LoRa test process. **

### LoRa module cannot start normally

When lora_pkt_fwd/pktfwd is started, the following error is displayed. Then check whether the LoRa module hardware is normal. 

```
    _/_/_/    _/_/_/    _/_/_/  _/_/_/  _/      _/    _/_/_/  _/    _/  _/_/_/
   _/    _/    _/    _/          _/    _/_/    _/  _/        _/    _/  _/     
  _/_/_/      _/      _/_/      _/    _/  _/  _/  _/  _/_/  _/_/_/_/  _/_/_/  
 _/    _/    _/          _/    _/    _/    _/_/  _/    _/  _/    _/  _/       
_/    _/  _/_/_/  _/_/_/    _/_/_/  _/      _/    _/_/_/  _/    _/  _/        
Create pid file successfully
Search directory /opt/rhf-bridge
Read configuration file /opt/rhf-bridge/global_conf.json
Read configuration file /opt/rhf-bridge/local_conf.json
Read configuration file /opt/rhf-bridge/cal_conf.json
6 2025-06-16T09:46:50.655577Z   PKTFWD:200    tx timeout 100ms, pull data period 30s, keep alive timeout 150s
6 2025-06-16T09:46:50.665383Z       RF:339    LoRa0: Concentrator starting...
7 2025-06-16T09:46:50.665431Z       RF:349    LoRa0: Radio A, 485000000
7 2025-06-16T09:46:50.665463Z       RF:349    LoRa0: Radio B, 485800000
6 2025-06-16T09:46:50.665493Z       RF:359    LoRa0: CH 0, 485500000, -300000
6 2025-06-16T09:46:50.665523Z       RF:359    LoRa0: CH 1, 485700000, -100000
6 2025-06-16T09:46:50.665553Z       RF:359    LoRa0: CH 2, 485900000, 100000
6 2025-06-16T09:46:50.665582Z       RF:359    LoRa0: CH 3, 486100000, 300000
6 2025-06-16T09:46:50.665611Z       RF:359    LoRa0: CH 4, 484700000, -300000
6 2025-06-16T09:46:50.665640Z       RF:359    LoRa0: CH 5, 484900000, -100000
6 2025-06-16T09:46:50.665669Z       RF:359    LoRa0: CH 6, 485100000, 100000
6 2025-06-16T09:46:50.665697Z       RF:359    LoRa0: CH 7, 485300000, 300000
3 2025-06-16T09:46:51.793205Z       RF:369    LoRa0: Concentrator error
2 2025-06-16T09:46:51.793407Z    APPPF:84     rf start failed // unable to start LoRa module
```

**Note: before testing the LoRa module hardware, shut down the LoRa service. **

#### Test spi (master control and LoRa module master control related hardware)

Run the `cd /usr/local/lora/ & ./test_loragw_com` command. If the following prompt is printed, the communication between the master and the LoRa module master is normal. 

```
root@rhf2s225:~# cd /usr/local/lora/ && ./test_loragw_com
Beginning of test for loragw_com.c
Opening SPI communication interface
SX1302 version: 0x10
Cycle 0> did a 175-byte R/W on a data buffer with no error
Cycle 1> did a 1-byte R/W on a data buffer with no error
Cycle 2> did a 498-byte bulk R/W on a data buffer with no error
Cycle 3> did a 764-byte R/W on a data buffer with no error
Cycle 4> did a 1-byte R/W on a data buffer with no error
Cycle 5> did a 480-byte bulk R/W on a data buffer with no error
Cycle 6> did a 545-byte R/W on a data buffer with no error
Cycle 7> did a 1-byte R/W on a data buffer with no error
Cycle 8> did a 301-byte bulk R/W on a data buffer with no error
Cycle 9> did a 763-byte R/W on a data buffer with no error
Cycle 10> did a 1-byte R/W on a data buffer with no error
```

#### Test SX1250 chip (LoRa RF front-end hardware)

Run the `cd /usr/local/lora/ & ./test_loragw_com_sx1250` command. If the following prompt is printed, the communication between SX1250 and SX1302 chips is normal. 

```
root@rhf2s225:~# cd /usr/local/lora/ && ./test_loragw_com_sx1250 
Opening SPI communication interface
Note: chip version is 0x10 (v1.0)
Radio0: get_status: 0xB2
Radio1: get_status: 0xB2
Cycle 0 > did a 4-byte R/W on a register with no error
Cycle 1 > did a 4-byte R/W on a register with no error
Cycle 2 > did a 4-byte R/W on a register with no error
Cycle 3 > did a 4-byte R/W on a register with no error
Cycle 4 > did a 4-byte R/W on a register with no error
Cycle 5 > did a 4-byte R/W on a register with no error
Cycle 6 > did a 4-byte R/W on a register with no error
Cycle 7 > did a 4-byte R/W on a register with no error
```

#### Test SX1261 chip (bottom noise scanning hardware)

Run the `cd /usr/local/lora/ & ./test_loragw_com_sx1261` command. If the following prompt is printed all the time, the communication between the master and the SX1261 chip is normal. 

```
root@rhf2s225:~# cd /usr/local/lora/ && ./test_loragw_com_sx1261 
Opening SPI communication interface
Note: chip version is 0x10 (v1.0)
SX1261: get_status: 0xA2
Cycle 0 > did a 4-byte R/W on a register with no error
Cycle 1 > did a 4-byte R/W on a register with no error
Cycle 2 > did a 4-byte R/W on a register with no error
Cycle 3 > did a 4-byte R/W on a register with no error
Cycle 4 > did a 4-byte R/W on a register with no error
Cycle 5 > did a 4-byte R/W on a register with no error
Cycle 6 > did a 4-byte R/W on a register with no error
Cycle 7 > did a 4-byte R/W on a register with no error
Cycle 8 > did a 4-byte R/W on a register with no error
Cycle 9 > did a 4-byte R/W on a register with no error
Cycle 10 > did a 4-byte R/W on a register with no error
```

#### Test SX1302(LoRa module master control)

Run the `cd /usr/local/lora/ & ./test_loragw_reg` command. If the following prompt is printed, the SX1302 chip is normal. 

```
root@rhf2s225:~# cd /usr/local/lora/ && ./test_loragw_reg
Opening SPI communication interface
Note: chip version is 0x10 (v1.0)
## TEST#1: read all registers and check default value for non-read-only registers
------------------
 TEST#1 PASSED
------------------

## TEST#2: read/write test on all non-read-only, non-pulse, non-w0clr, non-w1clr registers
------------------
 TEST#2 PASSED
------------------

Closing SPI communication interface
```

**If all the above tests pass, the LoRa module hardware is normal. **

### Test GPS

The packet_forwarder beacon is enabled, but the node cannot switch to the class B mode. At this time, it is necessary to confirm whether the GPS signal quality is poor. 

**Note: Before testing GPS, the LoRa service must be shut down. **

#### Test GPS module

Execute `gps-t` and return OK to indicate that the communication between the master control and the GPS module is normal, and NG to indicate that there is a hardware problem. 

```
root@rhf2s225:~# gps -t
OK
```

**Note: If the user does not shut down the LoRa service and the LoRa service is using the GPS module, NG may be returned. **

#### GPS to obtain geographical location

```
root@rhf2s225:~# gps --gl 1
22.547961,N,113.936117,E
```

#### GPS obtains timing and satellite numbers

```
root@rhf2s225:~# gps -v
b5620120100048946207d03e0500ca08120732000000a6f2
GSP INFO: [atomic time:1360923901], [utc time:2025-06-10T10:24:42], [latitude:22.547981], [longitude:113.936074], [altitude:36.7], [svnum:6]
$GPRMC,102443.00,A,2232.87874,N,11356.16432,E,0.855,,200223,,,A*7E
$GPVTG,,T,,M,0.855,N,1.584,K,A*23
$GPGGA,102443.00,2232.87874,N,11356.16432,E,1,06,1.26,36.6,M,-2.7,M,,*73
$GPGSA,A,3,19,17,30,03,14,06,,,,,,,2.78,1.26,2.48*09
$GPGSV,3,1,12,01,17,038,,03,42,068,18,04,00,120,,06,45,255,18*7D
$GPGSV,3,2,12,07,05,173,,09,03,151,,11,10,235,,14,86,099,20*7F
$GPGSV,3,3,12,17,47,352,22,19,32,314,22,30,25,205,16,40,20,257,*76
$GPGLL,2232.87874,N,11356.16432,E,102443.00,A,A*6E
```

If you want to use the packet_forwarder beacon function normally, `svnum` must have at least 5 stars or more. 

**If all the tests above pass, the GPS module of the Gateway is normal and the GPS signal quality is good. **

## Precautions

1. After the Gateway is powered on, when the USB-to-serial debugger is inserted at a certain moment from the start of the system to the early stage of uboot, the system may be stuck. At this time, you only need to unplug the connection between the serial debugger and the gateway and power up again. The chip manufacturer's technical support explained that this was caused by the reverse current from TX of the serial debugger to RX of the chip. 

